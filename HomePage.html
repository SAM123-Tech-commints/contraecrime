<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contra E-Crime</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/Dccn8pc.png">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/typesense@1.14.0/dist/typesense.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/compromise@14.10.0/builds/compromise.min.js"></script>
    <style>
* {
    box-sizing: border-box;
}

body, html {
    height: 100%;
    margin: 0;
    padding: 0;
    font-family: 'Montserrat', sans-serif;
    background-color: #f7f7f7;
    transition: background-color 0.3s ease;
}

.loader-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
}

.loader-overlay.active {
    opacity: 1;
    pointer-events: all;
}

.loader {
    width: 48px;
    height: 48px;
    border: 5px solid #FFF;
    border-bottom-color: transparent;
    border-radius: 50%;
    display: inline-block;
    box-sizing: border-box;
    animation: rotation 1s linear infinite;
}

@keyframes rotation {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}

.dark-theme .loader {
    border-color: #d7b15c;
    border-bottom-color: transparent;
}

.avatar-loading {
    position: absolute;
    top: 0;
    left: 0;
    width: 50px;
    height: 50px;
    background-color: rgba(0, 0, 0, 0.5);
    border-radius: 50%;
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 101;
}

.avatar-loading.active {
    display: flex;
}

.avatar-loading .loader {
    width: 24px;
    height: 24px;
    border-width: 3px;
}

.container {
    display: flex;
    min-height: 100vh;
    flex-direction: column;
}

.sidebar {
    width: 290px;
    background-image: url('https://i.imgur.com/bNRxAhZ.png');
    background-size: cover;
    background-position: center;
    color: white;
    padding: 20px;
    height: 100vh;
    position: fixed;
    transition: transform 0.3s ease;
}

.sidebar h1 {
    text-align: center;
    margin-bottom: 30px;
    font-size: 24px;
}

.sidebar ul {
    list-style-type: none;
    padding: 0;
}

.sidebar ul li {
    margin: 50px 0;
}

.sidebar ul li a {
    color: white;
    text-decoration: none;
    font-size: 18px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.sidebar ul li a:not(.dark-theme-label a) {
    transition: all 0.3s ease;
    position: relative;
}

.sidebar ul li a:not(.dark-theme-label a):hover {
    color: #d7b15c;
    transform: translateX(5px);
}

.sidebar ul li a:not(.dark-theme-label a)::after {
    content: '';
    position: absolute;
    width: 0;
    height: 2px;
    bottom: -10px;
    left: 0;
    background-color: #d7b15c;
    transition: width 0.3s ease;
}

.sidebar ul li a:not(.dark-theme-label a):hover::after {
    width: 95%;
}

.dark-theme .sidebar ul li a:not(.dark-theme-label a):hover {
    color: #d7b15c;
}

.sidebar ul li a img {
    width: 30px;
    height: 30px;
}

.dark-theme-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 20px;
}

.dark-theme-label {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 18px;
}

.dark-theme-label img {
    width: 30px;
    height: 30px;
    border-radius: 50%;
}

.toggle-switch {
    position: relative;
    width: 60px;
    height: 30px;
}

.switch-label {
    position: absolute;
    width: 100%;
    height: 100%;
    background-color: #28292c;
    border-radius: 25px;
    cursor: pointer;
    border: 3px solid #28292c;
}

.checkbox {
    position: absolute;
    display: none;
}

.slider {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 25px;
    transition: 0.3s;
}

.checkbox:checked ~ .slider {
    background-color: #d8dbe0;
}

.slider::before {
    content: "";
    position: absolute;
    top: 3px;
    left: 3px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    box-shadow: inset 8px -3px 0px 0px #d8dbe0;
    background-color: #28292c;
    transition: 0.3s;
}

.checkbox:checked ~ .slider::before {
    transform: translateX(30px);
    background-color: #28292c;
    box-shadow: none;
}

.content {
    flex: 1;
    padding: 20px;
    margin-left: 290px;
    overflow-y: auto;
    transition: background-color 0.3s ease, margin-left 0.3s ease;
}

.header {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 30px;
    position: relative;
}

.account-customization {
    position: fixed;
    top: 10px;
    right: 20px;
    z-index: 1000;
}

.user-details {
    display: none;
}

.avatar-container {
    position: relative;
    display: inline-block;
}

.avatar-container .profile-pic {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background-color: #ccc;
    display: flex;
    justify-content: center;
    align-items: center;
    object-fit: cover;
    border: 2px solid #000;
    cursor: pointer;
    color: transparent;
    font-size: 0;
}

.customization-options {
    position: absolute;
    top: 50px;
    right: 0;
    background-color: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    display: none;
    flex-direction: column;
    padding: 8px;
    z-index: 100;
    align-items: flex-start;
    width: 300px;
}

.customization-options.active {
    display: flex;
}

.customization-options .user-info {
    margin-bottom: 10px;
    width: 100%;
    padding: 10px;
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #d32f2f 100%);
    border-radius: 5px;
    position: relative;
    overflow: hidden;
}

.customization-options .user-info::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('https://www.transparenttextures.com/patterns/circuit.png');
    opacity: 0.1;
    z-index: 0;
}

.customization-options .user-info p {
    margin: 5px 0;
    font-size: 12px;
    color: #ffffff;
    position: relative;
    z-index: 1;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    font-weight: 500;
    overflow-wrap: break-word;
}

.customization-options .user-info p::before {
    content: attr(data-label);
    font-weight: 700;
    color: #ff3333;
    margin-right: 5px;
}

.customization-options label {
    font-size: 12px;
    color: #333;
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px 8px;
    transition: background-color 0.3s ease;
    width: 100%;
    text-align: left;
}

.customization-options label:hover {
    background-color: #f0f0f0;
    border-radius: 5px;
}

.customization-options input[type="color"] {
    width: 100%;
    height: 25px;
    padding: 0;
    border: none;
    cursor: pointer;
    background: none;
}

.customization-options select {
    font-size: 12px;
    padding: 4px;
    border-radius: 5px;
    border: 1px solid #ccc;
    cursor: pointer;
    width: 100%;
}

.customization-options input[type="file"] {
    display: none;
}

.customization-options .file-input-label {
    font-size: 12px;
    color: #333;
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px 8px;
    transition: background-color 0.3s ease;
    width: 100%;
    text-align: left;
}

.customization-options .file-input-label:hover {
    background-color: #f0f0f0;
    border-radius: 5px;
}

.dark-theme .customization-options {
    background-color: #3a3b3c;
    border-color: #555;
}

.dark-theme .customization-options .user-info {
    background: linear-gradient(135deg, #5a6268 0%, #454b50 50%, #2f3539 100%);
    color: #e0e0e0;
}

.dark-theme .customization-options .user-info p {
    color: #e0e0e0;
}

.dark-theme .customization-options .user-info p::before {
    color: #ffeb3b;
}

.dark-theme .customization-options label,
.dark-theme .customization-options .file-input-label {
    color: #e0e0e0;
}

.dark-theme .customization-options label:hover,
.dark-theme .customization-options .file-input-label:hover {
    background-color: #4a4b4c;
}

.dark-theme .customization-options select {
    background-color: #3a3b3c;
    color: #e0e0e0;
    border-color: #555;
}

.fingerprint-container {
    position: relative;
    width: 150px;
    height: 150px;
    margin-bottom: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    perspective: 1000px;
}

.fingerprint-icon {
    width: 100%;
    height: 100%;
    background: url('https://static.thenounproject.com/png/1238269-200.png') no-repeat center center;
    background-size: contain;
    position: relative;
    transition: transform 0.5s ease;
}

.fingerprint-icon::before {
    content: "";
    position: absolute;
    margin-right: 4px;
    margin-top: 4px;
    width: 138px;
    height: 140px;
    border: 3px solid;
    border-radius: 50%;
    z-index: 0;
    color: #000000;
    transition: border-color 0.3s ease;
}

.dark-theme .fingerprint-icon {
    filter: brightness(0) invert(1);
}

.dark-theme .fingerprint-icon::before {
    border-color: #ffffff;
}

.fingerprint-icon.scanning {
    animation: glow 2s infinite ease-in-out, rotate3D 5s infinite linear;
}

.fingerprint-icon.scanning::after {
    content: "";
    position: absolute;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(255, 0, 0, 0.3) 0%, transparent 70%);
    opacity: 0;
    animation: ripple 2s infinite ease-in-out;
    z-index: -1;
}

.fingerprint-icon .scan-line {
    position: absolute;
    width: 100%;
    height: 2px;
    background: linear-gradient(to right, transparent, #ff0000, transparent);
    top: 50%;
    left: 0;
    opacity: 0;
    z-index: 1;
}

.fingerprint-icon.scanning .scan-line {
    animation: scanVertical 1.5s infinite linear;
}

.fingerprint-icon .scan-line:nth-child(2) {
    width: 2px;
    height: 100%;
    background: linear-gradient(to bottom, transparent, #ff0000, transparent);
    top: 0;
    left: 50%;
}

.fingerprint-icon.scanning .scan-line:nth-child(2) {
    animation: scanHorizontal 1.5s infinite linear;
}

.fingerprint-icon .particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: #ff0000;
    border-radius: 50%;
    opacity: 0;
    z-index: 2;
}

.fingerprint-icon.scanning .particle {
    animation: particleMove 3s infinite ease-in-out;
}

.fingerprint-icon .particle:nth-child(3) { top: 10%; left: 20%; animation-delay: 0s; }
.fingerprint-icon .particle:nth-child(4) { top: 80%; left: 30%; animation-delay: 0.5s; }
.fingerprint-icon .particle:nth-child(5) { top: 40%; left: 70%; animation-delay: 1s; }
.fingerprint-icon .particle:nth-child(6) { top: 60%; left: 10%; animation-delay: 1.5s; }

@keyframes glow {
    0%, 100% { filter: brightness(1) drop-shadow(0 0 5px rgba(255, 0, 0, 0.5)); }
    50% { filter: brightness(1.2) drop-shadow(0 0 15px rgba(255, 0, 0, 0.8)); }
}

@keyframes rotate3D {
    0% { transform: rotateY(0deg) rotateX(0deg); }
    50% { transform: rotateY(10deg) rotateX(5deg); }
    100% { transform: rotateY(0deg) rotateX(0deg); }
}

@keyframes ripple {
    0% { opacity: 0; transform: scale(0.5); }
    50% { opacity: 0.5; }
    100% { opacity: 0; transform: scale(1.5); }
}

@keyframes scanVertical {
    0% { transform: translateY(-60px); opacity: 0; }
    50% { opacity: 1; }
    100% { transform: translateY(60px); opacity: 0; }
}

@keyframes scanHorizontal {
    0% { transform: translateX(-60px); opacity: 0; }
    50% { opacity: 1; }
    100% { transform: translateX(60px); opacity: 0; }
}

@keyframes particleMove {
    0% { opacity: 0; transform: translate(0, 0); }
    50% { opacity: 1; transform: translate(10px, -10px); }
    100% { opacity: 0; transform: translate(-10px, 10px); }
}

.dark-theme .fingerprint-icon.scanning::after {
    background: radial-gradient(circle, rgba(215, 177, 92, 0.3) 0%, transparent 70%);
}

.dark-theme .fingerprint-icon .scan-line {
    background: linear-gradient(to right, transparent, #d7b15c, transparent);
}

.dark-theme .fingerprint-icon .scan-line:nth-child(2) {
    background: linear-gradient(to bottom, transparent, #d7b15c, transparent);
}

.dark-theme .fingerprint-icon .particle {
    background: #d7b15c;
}

.dark-theme .fingerprint-icon.scanning {
    animation: glowDark 2s infinite ease-in-out, rotate3D 5s infinite linear;
}

@keyframes glowDark {
    0%, 100% { filter: brightness(0) invert(1) drop-shadow(0 0 5px rgba(215, 177, 92, 0.5)); }
    50% { filter: brightness(0) invert(1) drop-shadow(0 0 15px rgba(215, 177, 92, 0.8)); }
}

.search-container {
    width: 40%;
    position: relative;
    margin-bottom: 20px;
    background: linear-gradient(145deg, #ffffff, #e6e6e6);
    border-radius: 10px;
    box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.1), -5px -5px 15px rgba(255, 255, 255, 0.7);
    padding: 5px;
    transition: all 0.3s ease;
}

.search-container:hover {
    box-shadow: 5px 5px 20px rgba(0, 0, 0, 0.15), -5px -5px 20px rgba(255, 255, 255, 0.9);
}

.search-icon {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    transition: transform 0.3s ease;
    cursor: pointer; 
}

.search-input {
    width: 100%;
    height: 50px;
    padding: 10px 40px 10px 15px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    letter-spacing: 1px;
    background: transparent;
    color: #333;
    box-shadow: inset 2px 2px 5px rgba(0, 0, 0, 0.1), inset -2px -2px 5px rgba(255, 255, 255, 0.5);
    transition: all 0.3s ease;
}

.search-input:focus {
    outline: none;
    box-shadow: inset 3px 3px 8px rgba(0, 0, 0, 0.15), inset -3px -3px 8px rgba(255, 255, 255, 0.7);
}

.search-input::placeholder {
    color: #999;
    font-style: italic;
}

.search-container:hover > .search-icon {
    animation: anim 1s linear infinite;
}

@keyframes anim {
    0%, 100% {
        transform: translateY(-50%) scale(1);
    }
    50% {
        transform: translateY(-50%) scale(1.2);
    }
}

.dark-theme .search-container {
    background: linear-gradient(145deg, #3a3b3c, #2c2d2e);
    box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1);
}

.dark-theme .search-container:hover {
    box-shadow: 5px 5px 20px rgba(0, 0, 0, 0.4), -5px -5px 20px rgba(255, 255, 255, 0.15);
}

.dark-theme .search-input {
    color: #ffffff;
    box-shadow: inset 2px 2px 5px rgba(0, 0, 0, 0.3), inset -2px -2px 5px rgba(255, 255, 255, 0.1);
}

.dark-theme .search-input:focus {
    box-shadow: inset 3px 3px 8px rgba(0, 0, 0, 0.4), inset -3px -3px 8px rgba(255, 255, 255, 0.15);
}

.dark-theme .search-input::placeholder {
    color: #bbbbbb;
}

.dark-theme .search-icon svg path {
    stroke: #ffffff;
}

.header p {
    font-size: 18px;
    font-weight: 500;
    color: #333;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
    margin: 10px 0;
}

.dark-theme .header p {
    color: #e0e0e0;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.articles {
    margin-top: 20px;
    color: #000000;
    text-align: center;
}

.articles h2 {
    margin-bottom: 30px;
    font-size: 24px;
}

.cards-container {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    justify-items: center;
    max-width: 800px;
    margin: 0 auto;
}

.card {
    --bg-card: #27272a;
    --primary: #d9cd28;
    --primary-800: #d7b15c;
    --primary-shadow: #b7b90d;
    --light: #d9d9d9;
    --zinc-800: #18181b;
    --bg-linear: linear-gradient(0deg, var(--primary) 50%, var(--light) 125%);

    position: relative;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    padding: 1rem;
    width: 100%;
    max-width: 380px;
    border-radius: 1rem;
    justify-content: space-between;
    transition: background-color 0.3s ease;
}

.card.main-law {
    width: 100%;
    max-width: 800px;
    grid-column: 1 / -1;
    margin: 0 auto 40px;
}

.card.hidden {
    display: none;
}

.card.highlight {
    box-shadow: 0 0 10px 5px rgba(230, 207, 5, 0.5);
}

body:not(.dark-theme) .card {
    background-color: #b8973e;
}

.dark-theme .card {
    background-color: #3a3b3c;
    color: #ffffff;
}

.image_container {
    overflow: hidden;
    cursor: pointer;
    position: relative;
    z-index: 5;
    width: 100%;
    height: 200px;
    background-color: var(--primary-800);
    border-radius: 0.5rem;
}

.image_container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.cybercrime-title {
    width: 100%;
    font-size: 1.2rem;
    font-weight: 600;
    color: #ffffff;
    text-transform: capitalize;
    text-wrap: wrap;
    min-height: 3rem; 
    line-height: 1.3; 
}

.cybercrime-description {
    font-size: 0.9rem;
    color: #ffffff;
    line-height: 1.4;
    text-align: justify;
}

.border-button {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 6px 5px;
    border-radius: 10px;
    border: 1px solid rgb(255, 255, 255);
    overflow: hidden;
    background: transparent;
    color: rgb(255, 255, 255);
    cursor: pointer;
    align-self: flex-end;
    margin-top: 1rem;
    transition: all 0.3s ease;
    text-decoration: none;
}

.border-button .button-text {
    transform: translateX(17px);
    font-size: 0.9em;
    font-weight: 500;
    transition-duration: 0.3s;
    margin: 0;
}

.border-button .iconer {
    transform: translateY(35px);
    transition-duration: 0.3s;
    margin: 0;
    display: flex;
    align-items: center;
}

.border-button:hover .button-text {
    transform: translateX(5px);
}

.border-button:hover .iconer {
    transform: translateY(0px);
}

.save-button {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 6px 5px;
    border-radius: 10px;
    border: 1px solid rgb(255, 255, 255);
    overflow: hidden;
    background: transparent;
    color: rgb(255, 255, 255);
    cursor: pointer;
    align-self: flex-end;
    margin-top: 1rem;
    transition: all 0.3s ease;
    text-decoration: none;
}

.save-button .button-text {
    transform: translateX(17px);
    font-size: 0.9em;
    font-weight: 500;
    transition-duration: 0.3s;
    margin: 0;
}

.save-button .iconer {
    transform: translateY(35px);
    transition-duration: 0.3s;
    margin: 0;
    display: flex;
    align-items: center;
}

.save-button:hover .button-text {
    transform: translateX(5px);
}

.save-button:hover .iconer {
    transform: translateY(0px);
}

.success-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 4000;
}

.success-modal.active {
    display: flex;
}

.modal-content {
    background-color: white;
    padding: 20px 30px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    max-width: 400px;
    width: 90%;
}

.dark-theme .modal-content {
    background-color: #2d3748;
    color: #e2e8f0;
}

.modal-content h3 {
    margin: 0 0 15px;
    font-size: 20px;
    font-weight: 600;
    color: #2d3748;
}

.dark-theme .modal-content h3 {
    color: #e2e8f0;
}

.modal-content p {
    margin: 0 0 20px;
    font-size: 14px;
    color: #718096;
}

.dark-theme .modal-content p {
    color: #a0aec0;
}

.modal-buttons {
    display: flex;
    justify-content: center;
    gap: 15px;
}

.modal-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.1s ease;
}

.modal-btn.ok {
    background-color: #4a90e2;
    color: white;
}

.modal-btn.ok:hover {
    background-color: #357abd;
    transform: translateY(-2px);
}

.dark-theme .modal-btn.ok {
    background-color: #5a9bd4;
}

.dark-theme .modal-btn.ok:hover {
    background-color: #4682b4;
}

footer {
    background-color: #333;
    color: white;
    padding: 15px 30px;
    text-align: center;
    margin-left: 290px;
    z-index: 1;
    transition: margin-left 0.3s ease;
}

footer p {
    margin: 0;
    font-size: 14px;
}

.footer-links {
    margin-top: 5px;
}

.footer-links a {
    color: #d7b15c;
    text-decoration: none;
    margin: 0 10px;
    font-size: 14px;
}

.footer-links a:hover {
    text-decoration: underline;
}

.dark-theme footer {
    background-color: #1a1a1a;
}

body.dark-theme {
    background-color: #121212;
    color: #e0e0e0;
}

.dark-theme .content {
    background-color: #28292c;
}

.dark-theme .content::before {
    background-color: rgba(40, 41, 44, 0.9);
}

.dark-theme .articles {
    color: #ffffff;
}

.dark-theme .articles h2 {
    color: #ffffff;
}

.dark-theme .cybercrime-title,
.dark-theme .cybercrime-description {
    color: #ffffff;
}

.mobile-nav {
    display: none;
    background-image: url('https://i.imgur.com/bNRxAhZ.png');
    padding: 15px;
    position: fixed;
    width: 100%;
    z-index: 1000;
}

.mobile-nav .logo {
    color: white;
    font-size: 20px;
    font-weight: bold;
    text-decoration: none;
}

.mobile-nav .menu-icon {
    color: white;
    font-size: 24px;
    cursor: pointer;
    position: absolute;
    right: 15px;
    top: 15px;
}

.clock {
    position: relative;
    width: 100%;
    height: 70px;
    background: linear-gradient(to right, #8B0000, #FFD700);
    border-radius: 10px;
    margin-top: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 24px;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    animation: gradientAnimation 10s ease infinite;
}

@keyframes gradientAnimation {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@media (max-width: 1024px) {
    .sidebar {
        width: 250px;
    }

    .sidebar h1 {
        font-size: 22px;
    }

    .sidebar ul li a {
        font-size: 16px;
    }

    .dark-theme-label {
        font-size: 16px;
    }

    .content {
        margin-left: 250px;
    }

    footer {
        margin-left: 250px;
    }

    .card {
        max-width: 300px;
    }

    .card.main-law {
        width: 100%;
        max-width: 600px;
    }

    .account-customization {
        right: 10px;
    }

    .avatar-container .profile-pic {
        width: 35px;
        height: 35px;
    }

    .avatar-loading {
        width: 35px;
        height: 35px;
    }

    .customization-options {
        top: 45px;
        width: 220px;
    }

    .search-container {
        width: 50%;
    }

    .fingerprint-container {
        width: 120px;
        height: 120px;
    }

    .fingerprint-icon::before {
        width: 108px;
        height: 110px;
    }

    .clock {
        font-size: 20px;
        height: 60px;
    }

    .cards-container {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .sidebar {
        width: 200px;
        padding: 10px;
    }

    .sidebar h1 {
        font-size: 20px;
    }

    .sidebar ul li a {
        font-size: 14px;
    }

    .dark-theme-label {
        font-size: 14px;
    }

    .content {
        margin-left: 200px;
        padding: 10px;
    }

    footer {
        margin-left: 200px;
    }

    .card {
        max-width: 350px;
    }

    .card.main-law {
        width: 100%;
        max-width: 500px;
    }

    .avatar-container .profile-pic {
        width: 30px;
        height: 30px;
    }

    .avatar-loading {
        width: 30px;
        height: 30px;
    }

    .customization-options {
        top: 40px;
        width: 200px;
    }

    .fingerprint-container {
        width: 120px;
        height: 120px;
    }

    .search-container {
        width: 70%;
    }

    .clock {
        font-size: 18px;
        height: 50px;
    }

    .cards-container {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .container {
        flex-direction: column;
    }

    .mobile-nav {
        display: block;
    }

    .sidebar {
        width: 100%;
        height: auto;
        position: fixed;
        padding: 10px;
        transform: translateX(-100%);
        z-index: 999;
        top: 60px;
        height: calc(100vh - 60px);
        overflow-y: auto;
    }

    .sidebar.active {
        transform: translateX(0);
    }

    .sidebar h1 {
        display: none;
    }

    .sidebar ul li {
        margin: 20px 0;
    }

    .sidebar ul li a {
        font-size: 16px;
    }

    .dark-theme-label {
        font-size: 16px;
    }

    .content {
        margin-left: 0;
        padding: 80px 10px 10px;
    }

    footer {
        margin-left: 0;
        padding: 10px 20px;
        text-align: center;
    }

    footer p {
        font-size: 12px;
    }

    .footer-links a {
        font-size: 12px;
        margin: 0 8px;
    }

    .account-customization {
        top: 70px;
        right: 10px;
        z-index: 998;
    }

    .avatar-container .profile-pic {
        width: 30px;
        height: 30px;
        border-width: 1px;
    }

    .avatar-loading {
        width: 30px;
        height: 30px;
    }

    .avatar-loading .loader {
        width: 15px;
        height: 15px;
        border-width: 2px;
    }

    .customization-options {
        top: 40px;
        width: 180px;
    }

    .customization-options .user-info p {
        font-size: 10px;
    }

    .customization-options label,
    .customization-options .file-input-label {
        font-size: 10px;
        padding: 3px 6px;
    }

    .customization-options select {
        font-size: 10px;
        padding: 3px;
    }

    .fingerprint-container {
        width: 90px;
        height: 90px;
    }

    .fingerprint-icon::before {
        width: 78px;
        height: 80px;
    }

    .search-container {
        width: 90%;
    }

    .card {
        max-width: 100%;
    }

    .card.main-law {
        width: 100%;
        max-width: 100%;
    }

    .modal-content {
        padding: 15px 20px;
        max-width: 300px;
    }

    .modal-content h3 {
        font-size: 18px;
    }

    .modal-content p {
        font-size: 12px;
    }

    .modal-btn {
        padding: 8px 16px;
        font-size: 12px;
    }

    .clock {
        font-size: 16px;
        height: 40px;
    }

    .cards-container {
        grid-template-columns: 1fr;
    }
}
    </style>
</head>
<body>
    <div class="loader-overlay" id="loaderOverlay">
        <div class="loader"></div>
    </div>
    <div class="mobile-nav">
        <a href="#" class="logo">Contra E-Crime</a>
        <div class="menu-icon" id="mobileMenuIcon">
            <i class="fas fa-bars"></i>
        </div>
    </div>

    <div class="container">
        <nav class="sidebar" id="sidebar">
            <h1>Contra E-Crime</h1>
            <ul>
                <li>
                    <a href="HomePage.html">
                        <img src="https://i.imgur.com/OAHusQp.png" alt="Home">
                        Home
                    </a>
                </li>
                <li>
                    <a href="News.html">
                        <img src="https://i.imgur.com/FNALwXX.png" alt="News & Insights">
                        News & Insights
                    </a>
                </li>
                <li>
                    <a href="SavedLaws.html">
                        <img src="https://i.imgur.com/VChoqhD.png" alt="Saved Laws">
                        Saved Laws
                    </a>
                </li>
                <li>
                    <a href="History.html">
                        <img src="https://i.imgur.com/cnaDfEq.png" alt="Search History">
                        Search History
                    </a>
                </li>
                <li>
                    <a href="ContactUs.html">
                        <img src="https://i.imgur.com/T7bI4RJ.png" alt="Contact Us">
                        Contact Us
                    </a>
                </li>
                <li>
                    <a href="AboutUs.html">
                        <img src="https://i.imgur.com/lktrzpa.png" alt="About Us">
                        About Us
                    </a>
                </li>
                <li>
                    <a href="index.html">
                        <img src="https://i.imgur.com/2jjsgOq.png" alt="Logout">
                        Logout
                    </a>
                </li>
            </ul>
            <div class="dark-theme-container">
                <div class="dark-theme-label">
                    <img src="https://i.imgur.com/vEKpOsq.png" alt="Dark Theme">
                    <span>Dark Theme</span>
                </div>
                <div class="toggle-switch">
                    <label class="switch-label">
                        <input type="checkbox" class="checkbox" id="themeToggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </nav>
        <main class="content">
            <div class="header">
                <div class="account-customization">
                    <div class="user-details">
                        <!-- Hidden by default -->
                    </div>
                    <div class="avatar-container">
                        <img class="profile-pic" id="profilePic" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/wcAAwAB/4L1mGQAAAAASUVORK5CYII=" alt="User Avatar">
                        <div class="avatar-loading" id="avatarLoading">
                            <div class="loader"></div>
                        </div>
                        <div class="customization-options" id="customizationMenu">
                            <div class="user-info" id="userInfo">
                                <p id="usernameDisplay" data-label="Username:">Loading...</p>
                                <p id="emailDisplay" data-label="Email:">Loading...</p>
                                <p id="createdAtDisplay" data-label="Account Created:">Loading...</p>
                            </div>
                            <label class="file-input-label" for="avatarInput">Change Avatar</label>
                            <input type="file" id="avatarInput" accept="image/jpeg,image/png,image/jpg">
                            <label for="avatarBgColorPicker">Avatar Background Color</label>
                            <input type="color" id="avatarBgColorPicker" value="#cccccc">
                            <label for="borderColorPicker">Border Color</label>
                            <input type="color" id="borderColorPicker" value="#000000">
                            <label for="borderTypeSelect">Border Type</label>
                            <select id="borderTypeSelect">
                                <option value="solid">Solid</option>
                                <option value="dashed">Dashed</option>
                                <option value="dotted">Dotted</option>
                                <option value="double">Double</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="fingerprint-container">
                    <div class="fingerprint-icon" id="fingerprintIcon">
                        <div class="scan-line"></div>
                        <div class="scan-line"></div>
                        <div class="particle"></div>
                        <div class="particle"></div>
                        <div class="particle"></div>
                        <div class="particle"></div>
                    </div>
                </div>
                <div class="search-container">
                    <input type="text" class="search-input" id="searchInput" placeholder="Ask anything...">
                    <span class="search-icon" role="button" aria-label="Search" tabindex="0">
                        <svg width="19px" height="19px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path opacity="1" d="M14 5H20" stroke="#000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path opacity="1" d="M14 8H17" stroke="#000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M21 11.5C21 16.75 16.75 21 11.5 21C6.25 21 2 16.75 2 11.5C2 6.25 6.25 2 11.5 2" stroke="#000" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path> <path opacity="1" d="M22 22L20 20" stroke="#000" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                    </span>
                </div>
                <p>Find the right law for you!</p>
            </div>
            <section class="articles">
                <h2 id="sectionTitle">TOP ARTICLES</h2>
                <div class="cards-container" id="cardsContainer">
                    <!-- Laws will be dynamically populated here -->
                </div>
            </section>
            <div class="clock" id="clock"></div>
            <div class="success-modal" id="successModal">
                <div class="modal-content">
                    <h3>Success</h3>
                    <p>Law saved successfully!</p>
                    <div class="modal-buttons">
                        <button class="modal-btn ok" id="okSuccess">OK</button>
                    </div>
                </div>
            </div>
        </main>
        <footer>
            <p>© 2025 Contra E-Crime. All rights reserved.</p>
            <div class="footer-links">
                <a href="PrivacyPolicy.html">Privacy Policy</a>
                <a href="TermsOfUse.html">Terms of Use</a>
                <a href="ContactUs.html">Contact Us</a>
            </div>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/typesense@1.14.0/dist/typesense.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/compromise@14.10.0/builds/compromise.min.js"></script>
<script>
const firebaseConfig = {
    apiKey: "AIzaSyCDNmxNOV7rr_qfM_mTeYTaUIkkLvRaf80",
    authDomain: "contra-e-crime.firebaseapp.com",
    projectId: "contra-e-crime",
    storageBucket: "contra-e-crime.firebasestorage.app",
    messagingSenderId: "198995444405",
    appId: "1:198995444405:web:5f8c6eed561461b36034fc",
    databaseURL: "https://contra-e-crime-default-rtdb.firebaseio.com"
};

const app = firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const database = firebase.database();

const CLOUDINARY_CLOUD_NAME = 'dkxtbukta';
const CLOUDINARY_UPLOAD_PRESET = 'contraecrime';

const themeToggle = document.getElementById('themeToggle');
const body = document.body;
const mobileMenuIcon = document.getElementById('mobileMenuIcon');
const sidebar = document.getElementById('sidebar');
const loaderOverlay = document.getElementById('loaderOverlay');
const profilePic = document.getElementById('profilePic');
const customizationMenu = document.getElementById('customizationMenu');
const avatarInput = document.getElementById('avatarInput');
const avatarLoading = document.getElementById('avatarLoading');
const avatarBgColorPicker = document.getElementById('avatarBgColorPicker');
const borderColorPicker = document.getElementById('borderColorPicker');
const borderTypeSelect = document.getElementById('borderTypeSelect');
const usernameDisplay = document.getElementById('usernameDisplay');
const emailDisplay = document.getElementById('emailDisplay');
const createdAtDisplay = document.getElementById('createdAtDisplay');
const searchInput = document.getElementById('searchInput');
const fingerprintIcon = document.getElementById('fingerprintIcon');
const cardsContainer = document.getElementById('cardsContainer');
const sectionTitle = document.getElementById('sectionTitle');
const successModal = document.getElementById('successModal');
const okSuccess = document.getElementById('okSuccess');
const clock = document.getElementById('clock');

const laws = [
    {
        title: "Electronic Commerce Act of 2000 (Republic Act No. 8792)",
        description: "Addresses offenses related to electronic transactions, including those involving hacking, cracking, and unauthorized access to computer systems.",
        scenario: "Someone’s account on one of the electronic commerce apps were unawarely hacked by an unknown person because expensive products from online were automatically placed in order by the victim.",
        punishment: "Penalties for offenses include fines and imprisonment, ranging from a minimum of PHP 100,000 and six months to three years imprisonment for online fraud and scams, and a maximum penalty of PHP 1,000,000 or six years imprisonment for other violations.",
        image: "https://i.imgur.com/LmyboLf.png",
        pdf: "https://drive.google.com/uc?export=download&id=19eKpQ6LF8gXcNSHUJP5PRbTc3an0-Ttj",
        pdfwebsite: "https://www.bsp.gov.ph/PaymentAndSettlement/RA8792.pdf"
    },
    {
        title: "Safe Spaces Act (Republic Act No. 11313)",
        description: "A law enacted to protect individuals from gender-based sexual harassment in public spaces, online, workplaces, and educational institutions. It defines and penalizes various forms of gender-based harassment.",
        scenario: "An individual experienced online harassment through threatening messages and inappropriate content on a social media platform.",
        punishment: "Penalties include fines ranging from PHP 10,000 to PHP 500,000 and imprisonment from one to six years, depending on the severity.",
        image: "https://via.placeholder.com/200?text=Safe+Spaces+Act"
    }
];

const searchCache = new Map();

auth.onAuthStateChanged((user) => {
    if (user) {
        const currentUser = {
            username: user.displayName || 'User',
            email: user.email,
            createdAt: user.metadata.creationTime
        };
        localStorage.setItem('currentUser', JSON.stringify(currentUser));

        usernameDisplay.textContent = `${currentUser.username}`;
        emailDisplay.textContent = `${currentUser.email}`;
        createdAtDisplay.textContent = `${new Date(currentUser.createdAt).toLocaleString()}`;

        const sanitizedEmail = currentUser.email.replace(/\./g, ',');

        const userRef = database.ref(`users/${sanitizedEmail}`);
        userRef.once('value', (snapshot) => {
            const userData = snapshot.val();
            if (userData) {
                if (userData.avatarUrl) {
                    profilePic.src = userData.avatarUrl;
                } else {
                    profilePic.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/wcAAwAB/4L1mGQAAAAASUVORK5CYII=';
                }
                if (userData.avatarBgColor) {
                    profilePic.style.backgroundColor = userData.avatarBgColor;
                    avatarBgColorPicker.value = userData.avatarBgColor;
                }
                if (userData.borderColor) {
                    profilePic.style.borderColor = userData.borderColor;
                    borderColorPicker.value = userData.borderColor;
                }
                if (userData.borderType) {
                    profilePic.style.borderStyle = userData.borderType;
                    borderTypeSelect.value = userData.borderType;
                }
            }
        }, (error) => {
            console.error('Error loading user customization:', error);
            alert('Failed to load user customization: ' + error.message);
        });
    } else {
        localStorage.removeItem('currentUser');
        window.location.href = 'index.html';
    }
});

profilePic.addEventListener('click', () => {
    customizationMenu.classList.toggle('active');
});

document.addEventListener('click', (e) => {
    if (!customizationMenu.contains(e.target) && e.target !== profilePic) {
        customizationMenu.classList.remove('active');
    }
});

avatarInput.addEventListener('change', (event) => {
    const file = event.target.files[0];
    if (!file) return;

    const validTypes = ['image/jpeg', 'image/png', 'image/jpg'];
    const maxSize = 2 * 1024 * 1024;
    if (!validTypes.includes(file.type)) {
        alert('Please upload a valid image (JPG, JPEG, PNG).');
        return;
    }
    if (file.size > maxSize) {
        alert('Image size must be less than 2MB.');
        return;
    }

    const user = auth.currentUser;
    if (!user) {
        alert('You must be logged in to upload an avatar.');
        avatarLoading.classList.remove('active');
        return;
    }

    avatarLoading.classList.add('active');

    const img = new Image();
    const reader = new FileReader();
    reader.onload = (e) => {
        img.src = e.target.result;
    };
    reader.readAsDataURL(file);

    img.onload = () => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const maxDimension = 300;
        let width = img.width;
        let height = img.height;

        if (width > height) {
            if (width > maxDimension) {
                height = Math.round((height * maxDimension) / width);
                width = maxDimension;
            }
        } else {
            if (height > maxDimension) {
                width = Math.round((width * maxDimension) / height);
                height = maxDimension;
            }
        }

        canvas.width = width;
        canvas.height = height;
        ctx.drawImage(img, 0, 0, width, height);

        canvas.toBlob((blob) => {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser || !currentUser.email) {
                alert('User not logged in.');
                avatarLoading.classList.remove('active');
                return;
            }

            const formData = new FormData();
            formData.append('file', blob);
            formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
            formData.append('folder', `avatars/${currentUser.email}`);

            fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    return response.text().then(text => {
                        let errorMessage = `Cloudinary upload failed with status ${response.status}`;
                        try {
                            const parsed = JSON.parse(text);
                            errorMessage = parsed.error?.message || text;
                        } catch (e) {
                            errorMessage = text.includes('Invalid cloud name')
                                ? 'Invalid Cloudinary cloud name. Please check the CLOUDINARY_CLOUD_NAME.'
                                : text.includes('Invalid upload preset')
                                ? 'Invalid upload preset. Please check the preset name in Cloudinary.'
                                : text.includes('Unsigned uploads are not allowed')
                                ? 'Unsigned uploads are not allowed. Please set the upload preset to Unsigned in Cloudinary.'
                                : text || 'Unknown error occurred';
                        }
                        throw new Error(errorMessage);
                    });
                }
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    throw new Error(data.error.message || 'Failed to upload image to Cloudinary');
                }

                const avatarUrl = data.secure_url;
                const sanitizedEmail = currentUser.email.replace(/\./g, ',');

                database.ref(`users/${sanitizedEmail}`).update({
                    avatarUrl: avatarUrl,
                    updatedAt: firebase.database.ServerValue.TIMESTAMP
                })
                .then(() => {
                    profilePic.src = avatarUrl;
                    avatarLoading.classList.remove('active');
                })
                .catch(error => {
                    console.error('Error saving avatar URL to Firebase:', error);
                    alert('Failed to save avatar URL to Firebase: ' + error.message);
                    avatarLoading.classList.remove('active');
                });
            })
            .catch(error => {
                console.error('Error uploading avatar to Cloudinary:', error);
                alert(`Failed to upload avatar to Cloudinary: ${error.message}`);
                avatarLoading.classList.remove('active');
            });
        }, file.type, 0.6);
    };
    img.onerror = () => {
        alert('Failed to process the image. Please try a different file.');
        avatarLoading.classList.remove('active');
    };
});

avatarBgColorPicker.addEventListener('change', () => {
    const color = avatarBgColorPicker.value;
    profilePic.style.backgroundColor = color;

    const user = auth.currentUser;
    if (user) {
        const sanitizedEmail = user.email.replace(/\./g, ',');
        database.ref(`users/${sanitizedEmail}`).update({
            avatarBgColor: color,
            updatedAt: firebase.database.ServerValue.TIMESTAMP
        })
        .catch(error => {
            console.error('Error saving avatar background color:', error);
            alert('Failed to save avatar background color: ' + error.message);
        });
    } else {
        alert('You must be logged in to change the avatar background color.');
    }
});

borderColorPicker.addEventListener('change', () => {
    const color = borderColorPicker.value;
    profilePic.style.borderColor = color;

    const user = auth.currentUser;
    if (user) {
        const sanitizedEmail = user.email.replace(/\./g, ',');
        database.ref(`users/${sanitizedEmail}`).update({
            borderColor: color,
            updatedAt: firebase.database.ServerValue.TIMESTAMP
        })
        .catch(error => {
            console.error('Error saving border color:', error);
            alert('Failed to save border color: ' + error.message);
        });
    } else {
        alert('You must be logged in to change the border color.');
    }
});

borderTypeSelect.addEventListener('change', () => {
    const borderType = borderTypeSelect.value;
    profilePic.style.borderStyle = borderType;

    const user = auth.currentUser;
    if (user) {
        const sanitizedEmail = user.email.replace(/\./g, ',');
        database.ref(`users/${sanitizedEmail}`).update({
            borderType: borderType,
            updatedAt: firebase.database.ServerValue.TIMESTAMP
        })
        .catch(error => {
            console.error('Error saving border type:', error);
            alert('Failed to save border type: ' + error.message);
        });
    } else {
        alert('You must be logged in to change the border type.');
    }
});

if (localStorage.getItem('darkTheme') === 'enabled') {
    body.classList.add('dark-theme');
    themeToggle.checked = true;
}

themeToggle.addEventListener('change', function() {
    if (this.checked) {
        body.classList.add('dark-theme');
        localStorage.setItem('darkTheme', 'enabled');
    } else {
        body.classList.remove('dark-theme');
        localStorage.setItem('darkTheme', 'disabled');
    }
});

mobileMenuIcon.addEventListener('click', function() {
    sidebar.classList.toggle('active');
    const icon = mobileMenuIcon.querySelector('i');
    if (sidebar.classList.contains('active')) {
        icon.classList.remove('fa-bars');
        icon.classList.add('fa-times');
    } else {
        icon.classList.remove('fa-times');
        icon.classList.add('fa-bars');
    }
});

document.querySelectorAll('a[href]').forEach(link => {
    if (link.href && !link.href.startsWith('javascript:') && !link.href.startsWith('#')) {
        link.addEventListener('click', function(e) {
            if (!this.href.includes(window.location.hostname)) return;

            e.preventDefault();
            loaderOverlay.classList.add('active');

            setTimeout(() => {
                window.location.href = this.href;
            }, 150);
        });
    }
});

function saveLaw(lawTitle) {
    const user = auth.currentUser;
    if (!user) {
        alert('You must be logged in to save a law.');
        return;
    }

    const sanitizedEmail = user.email.replace(/\./g, ',');
    const lawRef = database.ref(`users/${sanitizedEmail}/savedLaws`).push();
    lawRef.set({
        title: lawTitle,
        timestamp: firebase.database.ServerValue.TIMESTAMP
    })
    .then(() => {
        successModal.classList.add('active');
    })
    .catch(error => {
        console.error('Error saving law:', error);
        alert('Failed to save law: ' + error.message);
    });
}

okSuccess.addEventListener('click', () => {
    successModal.classList.remove('active');
});

function normalizeQuery(query) {
    if (!query || typeof query !== 'string' || query.trim().length < 3) return '';
    const doc = nlp(query.trim().toLowerCase());
    const normalized = doc
        .normalize({ punctuation: true, possessives: true, plurals: true })
        .text()
        .replace(/[^a-z0-9\s]/g, ' ');
    const keywords = normalized.split(' ').filter(word => word.length > 2 && cybercrimeKeywords.some(k => word.includes(k)));
    return keywords.length > 0 ? keywords.join(' ') : '';
}

const cybercrimeKeywords = [
    'hack', 'fraud', 'scam', 'cybercrime', 'phishing', 'malware',
    'identity theft', 'data breach', 'online harassment', 'electronic transaction',
    'cyber', 'internet', 'digital', 'online', 'security', 'crime'
];

async function fetchLawsFromAI(query) {
    try {
        const normalizedQuery = normalizeQuery(query);
        if (!normalizedQuery) {
            throw new Error('Invalid or unrelated query. Please use cybercrime-related terms.');
        }

        if (searchCache.has(normalizedQuery)) {
            return searchCache.get(normalizedQuery);
        }

        const client = new Typesense.Client({
            nodes: [{ host: 'b0rxqzsgv81w3anjp-1.a1.typesense.net', port: '443', protocol: 'https' }],
            apiKey: 'y65G6Iy0S5DdpagXK02Y4o8YAt7xesge',
            connectionTimeoutSeconds: 5
        });

        try {
            await client.collections('laws').retrieve();
        } catch (err) {
            throw new Error('Typesense collection "laws" not found or inaccessible');
        }

        const searchParameters = {
            q: normalizedQuery,
            query_by: 'title,description,scenario',
            query_by_weights: '4,3,2',
            per_page: 5,
            typo_tokens_threshold: 1,
            num_typos: 2,
            include_fields: 'title,description,scenario',
            sort_by: '_text_match:desc',
            prefix: true,
            infix: 'always',
            drop_tokens_threshold: 1,
            locale: 'auto',
            synonyms: true,
            phrase_match: true,
            filter_by: `description:(${cybercrimeKeywords.join(' || ')}) || scenario:(${cybercrimeKeywords.join(' || ')})`
        };

        const results = await client.collections('laws').documents().search(searchParameters);

        let mainLaw = null;
        let alternativeLaws = [];

        if (results.hits && results.hits.length > 0) {
            mainLaw = results.hits[0].document.title;
            alternativeLaws = results.hits
                .slice(1, 5)
                .map(hit => hit.document.title)
                .filter(title => title !== mainLaw)
                .slice(0, 4);
        }

        while (alternativeLaws.length < 4 && laws.length > 0) {
            const availableLaws = laws
                .filter(law => law.title !== mainLaw && !alternativeLaws.includes(law.title))
                .map(law => law.title);
            if (availableLaws.length === 0) break;
            const randomIndex = Math.floor(Math.random() * availableLaws.length);
            alternativeLaws.push(availableLaws[randomIndex]);
        }

        const result = { mainLaw, alternativeLaws: alternativeLaws.slice(0, 4) };
        searchCache.set(normalizedQuery, result);
        if (searchCache.size > 50) {
            const oldestKey = searchCache.keys().next().value;
            searchCache.delete(oldestKey);
        }

        return result;
    } catch (error) {
        console.error('Typesense search error:', error.message);
        return { mainLaw: null, alternativeLaws: [] };
    }
}

function renderLawCards(mainLawTitle, alternativeLawTitles) {
    cardsContainer.innerHTML = '';

    const query = searchInput.value.trim();

    if (mainLawTitle) {
        const mainLaw = laws.find(law => law.title === mainLawTitle);
        if (mainLaw) {
            const mainCard = document.createElement('div');
            mainCard.className = 'card main-law highlight';
            mainCard.innerHTML = `
                <div class="image_container">
                    <img src="${mainLaw.image}" alt="Law Image" onerror="this.src='https://via.placeholder.com/200?text=Image+Not+Found';">
                </div>
                <div class="cybercrime-title">
                    <span>${mainLaw.title}</span>
                </div>
                <div class="cybercrime-description">
                    <p><strong>Description:</strong> <span class="description-text">${mainLaw.description}</span></p>
                    <p><strong>Scenario:</strong> <span class="scenario-text">${mainLaw.scenario}</span></p>
                    <p><strong>Punishment:</strong> <span class="punishment-text">${mainLaw.punishment}</span></p>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    ${mainLaw.pdf ? `
                    <a href="${mainLaw.pdf}" class="border-button" target="_blank">
                        <span class="button-text">Read More</span>
                        <span class="iconer"><svg height="24" width="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z" fill="currentColor"></path></svg></span>
                    </a>` : ''}
                    <button class="save-button" data-title="${mainLaw.title}">
                        <span class="button-text">Save Law</span>
                        <span class="iconer"><svg height="24" width="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 3H7a2 2 0 0 0-2 2v16l7-4 7 4V5a2 2 0 0 0-2-2z" fill="currentColor"></path></svg></span>
                    </button>
                </div>
            `;
            cardsContainer.appendChild(mainCard);

            if (query) {
                ['description-text', 'scenario-text', 'punishment-text'].forEach(className => {
                    const element = mainCard.querySelector(`.${className}`);
                    highlightText(element, query);
                });
            }
        }
    } else {
        cardsContainer.innerHTML = '<p>No relevant laws found for your search. Try a different query related to cybercrime.</p>';
        fingerprintIcon.classList.add('glow');
        fingerprintIcon.style.opacity = '1';
        return;
    }

    if (alternativeLawTitles.length > 0) {
        const alternativesSection = document.createElement('div');
        alternativesSection.innerHTML = '<h2 style="text-align: center; margin: 40px 0 20px;">Alternative Laws Suggested</h2>';
        cardsContainer.appendChild(alternativesSection);

        const alternativesContainer = document.createElement('div');
        alternativesContainer.className = 'cards-container';

        alternativeLawTitles.forEach(title => {
            const law = laws.find(l => l.title === title);
            if (law) {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="image_container">
                        <img src="${law.image}" alt="Law Image" onerror="this.src='https://via.placeholder.com/200?text=Image+Not+Found';">
                    </div>
                    <div class="cybercrime-title" style="text-align: center; padding: 10px 0;">
                        <span>${law.title}</span>
                    </div>
                    <div class="cybercrime-description" style="padding: 0 10px;">
                        <p style="margin: 5px 0;"><strong>Description:</strong> <span class="description-text">${law.description}</span></p>
                        <p style="margin: 5px 0;"><strong>Scenario:</strong> <span class="scenario-text">${law.scenario}</span></p>
                        <p style="margin: 5px 0;"><strong>Punishment:</strong> <span class="punishment-text">${law.punishment}</span></p>
                    </div>
                    <div style="display: flex; gap: 10px; justify-content: flex-end; padding: 10px;">
                        ${law.pdf ? `
                        <a href="${law.pdf}" class="border-button" target="_blank">
                            <span class="button-text">Read More</span>
                            <span class="iconer"><svg height="24" width="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z" fill="currentColor"></path></svg></span>
                        </a>` : ''}
                        <button class="save-button" data-title="${law.title}">
                            <span class="button-text">Save Law</span>
                            <span class="iconer"><svg height="24" width="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 3H7a2 2 0 0 0-2 2v16l7-4 7 4V5a2 2 0 0 0-2-2z" fill="currentColor"></path></svg></span>
                        </button>
                    </div>
                `;
                alternativesContainer.appendChild(card);

                if (query) {
                    ['description-text', 'scenario-text', 'punishment-text'].forEach(className => {
                        const element = card.querySelector(`.${className}`);
                        highlightText(element, query);
                    });
                }
            }
        });

        while (alternativesContainer.childElementCount < 4) {
            const placeholderCard = document.createElement('div');
            placeholderCard.className = 'card placeholder';
            placeholderCard.style.opacity = '0.5';
            placeholderCard.innerHTML = `
                <div class="image_container">
                    <img src="https://via.placeholder.com/200?text=No+Law+Available" alt="Placeholder">
                </div>
                <div class="cybercrime-title" style="text-align: center; padding: 10px 0;">
                    <span>No Law Available</span>
                </div>
                <div class="cybercrime-description" style="padding: 0 10px;">
                    <p style="margin: 5px 0;"><strong>Description:</strong> N/A</p>
                    <p style="margin: 5px 0;"><strong>Scenario:</strong> N/A</p>
                    <p style="margin: 5px 0;"><strong>Punishment:</strong> N/A</p>
                </div>
            `;
            alternativesContainer.appendChild(placeholderCard);
        }

        cardsContainer.appendChild(alternativesContainer);
    }

    document.querySelectorAll('.save-button').forEach(button => {
        button.removeEventListener('click', saveLawHandler);
        button.addEventListener('click', saveLawHandler);
    });

    fingerprintIcon.classList.add('glow');
    fingerprintIcon.style.opacity = '1';
}

function saveLawHandler() {
    const lawTitle = this.getAttribute('data-title');
    saveLaw(lawTitle);
}

const defaultCards = [
    {
        title: "UN: Asian Scam Calls Now a Global Export",
        image: "https://regmedia.co.uk/2023/09/20/shutterstock_call_center.jpg",
        description: "A new report from the United Nations Office on Drugs and Crime (UNODC) warns that scam calls originating in Asia have become a global problem, fueled by organized crime networks that have turned fraud into a multi-billion-dollar industry."
    },
    {
        title: "UN: Global Expansion of Southeast Asian Cyber-Fraud Operations Underway",
        image: "https://c-assets.papillon.io/image/fetch/s--YnOMApIW--/f_auto/https://dkf1ato8y5dsg.cloudfront.net/uploads/8/79/1000x1000-global-threat-report.jpg",
        description: "The United Nations Office on Drugs and Crime (UNODC) released a report detailing the alarming global expansion of Southeast Asian cyber-fraud operations, which have evolved into a transnational organized crime threat affecting every continent."
    },
    {
        title: "Southeast Asia Cyber Fraud at ‘Inflection Point’ as Scam Networks Go Global",
        image: "https://cms.therecord.media/uploads/format_webp/large_myanmar_scam_arrest_07972d5702.jpg",
        description: "A new United Nations report warns that cyber fraud originating in Southeast Asia has reached an 'inflection point,' with criminal networks expanding globally and generating billions in illicit profits, often through the exploitation of trafficked workers."
    }
];

defaultCards.forEach(cardData => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
        <div class="image_container">
            <img src="${cardData.image}" alt="Cybercrime Image">
        </div>
        <div class="cybercrime-title">
            <span>${cardData.title}</span>
        </div>
        <div class="cybercrime-description">
            <p>Cybercrime</p>
            <p>${cardData.description}</p>
        </div>
        <a href="News.html" class="border-button">
            <span class="button-text">Read More</span>
            <span class="iconer"><svg height="24" width="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z" fill="currentColor"></path></svg></span>
        </a>
    `;
    cardsContainer.appendChild(card);
});

async function performSearch(query) {
    try {
        if (query) {
            fingerprintIcon.classList.add('scanning');
            fingerprintIcon.style.opacity = '1';
            sectionTitle.textContent = 'RELEVANT LAW';
            loaderOverlay.classList.add('active');

            const user = auth.currentUser;
            if (user) {
                const sanitizedEmail = user.email.replace(/\./g, ',');
                database.ref(`users/${sanitizedEmail}/searchHistory`).push({
                    query: query,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });
            }

            const { mainLaw, alternativeLaws } = await fetchLawsFromAI(query);
            if (mainLaw) {
                renderLawCards(mainLaw, alternativeLaws);
            } else {
                cardsContainer.innerHTML = '<p>No relevant laws found for your search. Try a different query related to cybercrime.</p>';
                fingerprintIcon.classList.add('glow');
                fingerprintIcon.style.opacity = '1';
            }
        } else {
            sectionTitle.textContent = 'TOP ARTICLES';
            cardsContainer.innerHTML = '';
            fingerprintIcon.classList.add('glow');
            fingerprintIcon.style.opacity = '1';
            defaultCards.forEach(cardData => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="image_container">
                        <img src="${cardData.image}" alt="Cybercrime Image">
                    </div>
                    <div class="cybercrime-title">
                        <span>${cardData.title}</span>
                    </div>
                    <div class="cybercrime-description">
                        <p>Cybercrime</p>
                        <p>${cardData.description}</p>
                    </div>
                    <a href="News.html" class="border-button">
                        <span class="button-text">Read More</span>
                        <span class="iconer">
                            <svg height="24" width="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M0 0h24v24H0z" fill="none"></path>
                                <path d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z" fill="currentColor"></path>
                            </svg>
                        </span>
                    </a>
                `;
                cardsContainer.appendChild(card);
            });
        }
    } catch (error) {
        console.error('Search error:', error.message);
        cardsContainer.innerHTML = `<p>Error fetching laws: ${error.message}. Please check your connection or try again.</p>`;
        fingerprintIcon.classList.add('glow');
        fingerprintIcon.style.opacity = '1';
    } finally {
        loaderOverlay.classList.remove('active');
    }
}

searchInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        const query = searchInput.value.trim();
        performSearch(query);
    }
});

document.querySelector('.search-icon').addEventListener('click', function() {
    const query = searchInput.value.trim();
    performSearch(query);
});

function highlightText(element, query) {
    if (!element || !query) return;
    const text = element.textContent;
    const regex = new RegExp(`(${query})`, 'gi');
    element.innerHTML = text.replace(regex, '<span style="background-color: yellow; color: black;">$1</span>');
}

function updateClock() {
    const now = new Date();
    const options = {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: true,
        timeZoneName: 'short'
    };
    clock.textContent = now.toLocaleTimeString('en-US', options);
}

setInterval(updateClock, 1000);
updateClock();

window.addEventListener('resize', () => {
    if (window.innerWidth > 480 && sidebar.classList.contains('active')) {
        sidebar.classList.remove('active');
        mobileMenuIcon.querySelector('i').classList.remove('fa-times');
        mobileMenuIcon.querySelector('i').classList.add('fa-bars');
    }
});
</script>
</body>
</html>