<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contra E-Crime</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/Dccn8pc.png">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <style>
        * { box-sizing: border-box; }
        body, html {
            min-height: 100vh;
            margin: 0;
            padding: 0;
            font-family: 'Montserrat', sans-serif;
            background-color: #f7f7f7;
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
            overscroll-behavior: none;
        }
        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .loader-overlay.active { opacity: 1; pointer-events: all; }
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #FFF;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        .dark-theme .loader {
            border-color: #d7b15c;
            border-bottom-color: transparent;
        }
        .container {
            display: flex;
            min-height: 100vh;
            flex-direction: column;
        }
        .mobile-nav {
            display: none;
            background-image: url('https://i.imgur.com/bNRxAhZ.png');
            background-size: cover;
            background-position: center;
            padding: 15px;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1002;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .mobile-nav .logo {
            color: white;
            font-size: 20px;
            font-weight: bold;
            text-decoration: none;
        }
        .mobile-nav .menu-icon {
            color: white;
            font-size: 24px;
            cursor: pointer;
            position: absolute;
            right: 15px;
            top: 15px;
        }
       .sidebar {
            width: 290px;
            background-image: url('https://i.imgur.com/bNRxAhZ.png');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 20px;
            height: 100vh;
            position: fixed;
            transition: transform 0.3s ease;
            display: block;
        }
        .sidebar.active {
            z-index: 1001;
        }
        .sidebar h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
        }
        .sidebar ul { list-style-type: none; padding: 0; }
        .sidebar ul li { margin: 50px 0; }
        .sidebar ul li a {
            color: white;
            text-decoration: none;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .sidebar ul li a img {
            width: 30px;
            height: 30px;
        }
        .sidebar ul li a:not(.dark-theme-label a) {
            transition: all 0.3s ease;
            position: relative;
        }
        .sidebar ul li a:not(.dark-theme-label a):hover {
            color: #d7b15c;
            transform: translateX(5px);
        }
        .sidebar ul li a:not(.dark-theme-label a)::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -10px;
            left: 0;
            background-color: #d7b15c;
            transition: width 0.3s ease;
        }
        .sidebar ul li a:not(.dark-theme-label a):hover::after {
            width: 95%;
        }
        .dark-theme .sidebar ul li a:not(.dark-theme-label a):hover { color: #d7b15c; }
        .dark-theme-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 20px;
        }
        .dark-theme-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
        }
        .dark-theme-label img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
        }
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }
        .switch-label {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: #28292c;
            border-radius: 25px;
            cursor: pointer;
            border: 3px solid #28292c;
        }
        .checkbox {
            position: absolute;
            display: none;
        }
        .slider {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 25px;
            transition: 0.3s;
        }
        .checkbox:checked ~ .slider { background-color: #d8dbe0; }
        .slider::before {
            content: "";
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            box-shadow: inset 8px -3px 0px 0px #d8dbe0;
            background-color: #28292c;
            transition: 0.3s;
        }
        .checkbox:checked ~ .slider::before {
            transform: translateX(30px);
            background-color: #28292c;
            box-shadow: none;
        }
        .content {
            flex: 1;
            margin-left: 290px;
            padding: 80px 30px 30px 30px;
            position: relative;
            background: linear-gradient(135deg, #f7f7f7 0%, #e0e0e0 100%);
            transition: background-color 0.3s ease, margin-left 0.3s ease;
            overflow-y: auto;
            min-height: 100vh;
        }
        .content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(200, 200, 200, 0.1);
            z-index: 0;
        }
        .quiz-section {
            position: relative;
            z-index: 1000;
            max-width: 900px;
            margin: 0 auto;
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            padding: 40px;
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.5s ease, transform 0.5s ease;
            touch-action: manipulation;
        }
        .quiz-section.visible {
            opacity: 1;
            transform: scale(1);
        }
        .quiz-section h1 {
            font-size: 36px;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 3px solid #8B0000;
            padding-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        #particles-js {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
        .progress-container {
            width: 100%;
            background: #ddd;
            border-radius: 25px;
            margin-bottom: 20px;
            overflow: hidden;
            position: relative;
        }
        .progress-bar {
            height: 20px;
            background: linear-gradient(90deg, #ffcc00, #e6b800);
            width: 0%;
            border-radius: 25px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                45deg,
                rgba(255, 255, 255, 0.2) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0.2) 75%,
                transparent 75%,
                transparent
            );
            background-size: 30px 30px;
            animation: moveStripes 2s linear infinite;
        }
        .progress-text {
            font-size: 1.2em;
            margin-bottom: 10px;
            text-align: center;
            color: #333;
            font-weight: 600;
        }
        .timer-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            gap: 20px;
        }
        .timer-svg {
            width: 70px;
            height: 70px;
            position: relative;
        }
        .timer-circle {
            fill: none;
            stroke: #ffcc00;
            stroke-width: 5;
            stroke-dasharray: 188;
            stroke-dashoffset: 0;
            transition: stroke-dashoffset 1s linear;
        }
        .timer-text {
            font-size: 20px;
            color: #ffcc00;
            font-weight: 600;
            margin-left: 10px;
        }
        .power-ups {
            display: flex;
            gap: 10px;
        }
        .power-up-btn {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: #fff;
            border: none;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        .power-up-btn:hover {
            transform: scale(1.1);
        }
        .power-up-btn:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.6;
        }
        .question-box {
            background: #f9f9f9;
            color: #1e3c72;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            animation: slideIn 0.5s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        .question-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            z-index: 0;
        }
        .question-text {
            font-size: 1.5em;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }
        .options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            position: relative;
            z-index: 1;
        }
        .option-btn {
            background: linear-gradient(135deg, #4a90e2, #357abd);
            color: #fff;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            touch-action: manipulation;
        }
        .option-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transition: left 0.3s ease;
        }
        .option-btn:hover::before {
            left: 0;
        }
        .option-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
        }
        .option-btn.correct {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            animation: pulse 0.5s;
        }
        .option-btn.correct::after {
            content: '\f058';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #fff;
            font-size: 20px;
        }
        .option-btn.wrong {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            animation: shake 0.5s;
        }
        .option-btn.wrong::after {
            content: '\f057';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #fff;
            font-size: 20px;
        }
        .option-btn.disabled {
            pointer-events: none;
            opacity: 0.6;
        }
        .explanation {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: #e0f7fa;
            border-radius: 8px;
            color: #1e3c72;
            font-size: 1em;
            line-height: 1.6;
        }
        .explanation.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        .button-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        .next-btn, .exit-game-btn {
            background: linear-gradient(135deg, #ffcc00, #e6b800);
            color: #1e3c72;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: none;
            cursor: pointer;
            position: relative;
            z-index: 1000;
            touch-action: manipulation;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        .exit-game-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: #fff;
        }
        .next-btn.visible, .exit-game-btn.visible {
            display: inline-flex;
            pointer-events: auto;
        }
        .next-btn:hover, .exit-game-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        .score {
            font-size: 1.5em;
            margin: 20px 0;
            text-align: center;
            color: #333;
            font-weight: 600;
        }
        .start-modal, .tutorial-modal, .result-modal, .redemption-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1002;
            overflow-y: auto;
            padding: 10px;
            box-sizing: border-box;
            overscroll-behavior: contain;
        }
        .start-modal.active, .tutorial-modal.active, .result-modal.active, .redemption-modal.active {
            display: flex;
        }
        .start-modal-content, .tutorial-modal-content, .result-modal-content, .redemption-modal-content {
            background: #fff;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            width: 90%;
            max-width: 700px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            animation: zoomIn 0.5s ease;
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
        }
        .tutorial-modal-content {
            max-width: 900px; /* Match quiz-section width */
            transition: all 0.3s ease;
        }
        .start-modal-actions {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .start-modal-content h2, .tutorial-modal-content h2, .result-modal-content h2, .redemption-modal-content h2 {
            font-size: 32px;
            color: #1e3c72;
            margin-bottom: 25px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        .difficulty-options {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        .difficulty-card {
            background: #fff;
            border-radius: 15px;
            padding: 20px;
            width: 180px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
            min-height: 44px;
        }
        .difficulty-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #4a90e2, #357abd);
            opacity: 0.1;
            transition: opacity 0.3s ease;
        }
        .difficulty-card:hover::before {
            opacity: 0.3;
        }
        .difficulty-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        .difficulty-card.selected {
            border: 3px solid #ffcc00;
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.5);
        }
        .difficulty-card .label {
            font-size: 20px;
            color: #333;
            font-weight: 600;
        }
        .difficulty-card .description {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
        }
        .start-btn, .tutorial-btn, .restart-btn, .back-btn, .start-quiz-btn, .exit-btn, .back-about-btn, .skip-redemption-btn {
            background: linear-gradient(135deg, #ffcc00, #e6b800);
            color: #1e3c72;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            margin: 10px;
            touch-action: manipulation;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            min-height: 44px;
        }
        .back-about-btn, .skip-redemption-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: #fff;
        }
        .start-btn:hover, .tutorial-btn:hover, .restart-btn:hover, .back-btn:hover, .start-quiz-btn:hover, .exit-btn:hover, .back-about-btn:hover, .skip-redemption-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        .tutorial-modal-content {
            padding: 30px;
            overflow: hidden;
        }
        .slide-header {
            text-align: center;
            margin-bottom: 20px;
        }
        .slide-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        .slide-image {
            max-width: 300px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .slide-text {
            text-align: center;
            font-size: 16px;
            line-height: 1.6;
        }
        .feature-highlight {
            background: rgba(255,204,0,0.1);
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 600;
        }
        .feature-highlight i {
            color: #ffcc00;
        }
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            width: 100%;
        }
        .feature-card {
            background: rgba(255,255,255,0.8);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        .dark-theme .feature-card {
            background: rgba(0,0,0,0.2);
        }
        .feature-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        .feature-card h4 {
            margin: 10px 0;
            color: #1e3c72;
        }
        .dark-theme .feature-card h4 {
            color: #d8dbe0;
        }
        .feature-list {
            text-align: left;
            list-style: none;
            padding: 0;
            margin-top: 15px;
        }
        .feature-list li {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .feature-list i {
            color: #ffcc00;
            width: 20px;
        }
        .tutorial-slide {
            display: none;
            padding: 0;
            text-align: center;
            opacity: 0;
            transform: translateX(50px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .tutorial-slide.active {
            display: block;
            opacity: 1;
            transform: translateX(0);
        }
        .tutorial-slide h3 {
            font-size: 28px;
            color: #1e3c72;
            margin-bottom: 20px;
        }
        .dark-theme .tutorial-slide h3 {
            color: #d8dbe0;
        }
        .tutorial-slide p {
            font-size: 16px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        .dark-theme .tutorial-slide p {
            color: #b0b0b0;
        }
        .tutorial-nav {
            display: none;
        }
        .tutorial-prev, .tutorial-next {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: #fff;
            border: none;
            padding: 10px;
            cursor: pointer;
            font-size: 20px;
            border-radius: 50%;
            transition: background 0.3s ease, opacity 0.3s ease;
            min-height: 44px;
            opacity: 1;
            pointer-events: auto;
        }
        .tutorial-prev:hover, .tutorial-next:hover {
            background: rgba(0, 0, 0, 0.8);
        }
        .tutorial-prev.disabled, .tutorial-next.disabled {
            opacity: 0;
            pointer-events: none;
        }
        .tutorial-prev {
            left: 20px;
        }
        .tutorial-next {
            right: 20px;
        }
        .tutorial-actions {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .dont-show-again {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        .dont-show-again label {
            font-size: 14px;
            color: #666;
        }
        .dark-theme .dont-show-again label {
            color: #b0b0b0;
        }
        .dont-show-again input {
            cursor: pointer;
        }
        .result-modal-content, .redemption-modal-content {
            max-height: 80vh;
            overflow-y: auto;
        }
        .result-modal-content h3, .redemption-modal-content h3 {
            font-size: 22px;
            color: #1e3c72;
            margin: 20px 0 10px;
        }
        .result-modal-content p, .redemption-modal-content p {
            font-size: 16px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        .result-summary, .redemption-summary {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        .result-summary:hover, .redemption-summary:hover {
            transform: translateY(-5px);
        }
        .result-summary h3, .redemption-summary h3 {
            font-size: 24px;
            color: #1e3c72;
            margin-bottom: 15px;
            padding: 10px;
            background: linear-gradient(135deg, #ffcc00, #e6b800);
            border-radius: 8px;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        .result-summary .question-block, .redemption-summary .question-block {
            background: #fff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: background 0.3s ease;
        }
        .result-summary .question-block:hover, .redemption-summary .question-block:hover {
            background: #f0f0f0;
        }
        .result-summary .question, .redemption-summary .question {
            font-weight: 600;
            color: #1e3c72;
            font-size: 18px;
            margin-bottom: 8px;
        }
        .result-summary .user-answer, .redemption-summary .user-answer {
            color: #333;
            font-size: 16px;
            margin-bottom: 8px;
        }
        .result-summary .correct-answer, .redemption-summary .correct-answer {
            color: #2ecc71;
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .result-summary .correct-answer::before, .redemption-summary .correct-answer::before {
            content: '\f058';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            color: #2ecc71;
            font-size: 18px;
        }
        .result-summary .user-answer.incorrect, .redemption-summary .user-answer.incorrect {
            color: #e74c3c;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .result-summary .user-answer.incorrect::before, .redemption-summary .user-answer.incorrect::before {
            content: '\f057';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            color: #e74c3c;
            font-size: 18px;
        }
        .result-summary .time-taken, .redemption-summary .time-taken {
            color: #666;
            font-size: 14px;
            font-style: italic;
        }
        .result-stats {
            text-align: left;
            padding: 15px;
            background: #e0f7fa;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .result-stats div {
            margin: 5px 0;
        }
        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #e74c3c;
            color: #fff;
            padding: 20px 40px;
            border-radius: 10px;
            font-size: 24px;
            font-weight: 600;
            z-index: 1003;
            display: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: fadeInOut 2s ease;
        }
        .notification.visible {
            display: block;
        }
        .dice-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .dice-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .dice-option:hover {
            transform: translateY(-5px);
        }

        .dice-icon {
            font-size: 50px;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #ffcc00, #e6b800);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .dice-icon:hover {
            transform: rotate(15deg) scale(1.1);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .dice-label {
            margin-top: 10px;
            font-weight: 600;
            color: #333;
        }

        .dark-theme .dice-label {
            color: #e0e0e0;
        }

        .wrong-count {
            color: #e74c3c;
            font-weight: 700;
        }

        .dark-theme .wrong-count {
            color: #ff6b6b;
        }
        body.dark-theme { background-color: #121212; color: #e0e0e0; }
        .dark-theme .content { background: linear-gradient(135deg, #28292c 0%, #1a1a1a 100%); }
        .dark-theme .content::before { background-color: rgba(40, 41, 44, 0.9); }
        .dark-theme .quiz-section { background: #333; }
        .dark-theme .quiz-section h1 { color: #d8dbe0; }
        .dark-theme .progress-text { color: #d8dbe0; }
        .dark-theme .question-box { background-color: #444; color: #d8dbe0; }
        .dark-theme .score { color: #d8dbe0; }
        .dark-theme .start-modal-content, .dark-theme .tutorial-modal-content, .dark-theme .result-modal-content, .dark-theme .redemption-modal-content { background: #333; color: #d8dbe0; }
        .dark-theme .start-modal-content h2, .dark-theme .tutorial-modal-content h2, .dark-theme .result-modal-content h2, .dark-theme .redemption-modal-content h2 { color: #d8dbe0; }
        .dark-theme .difficulty-card { background: #444; }
        .dark-theme .difficulty-card .label { color: #d8dbe0; }
        .dark-theme .difficulty-card .description { color: #b0b0b0; }
        .dark-theme .result-modal-content h3, .dark-theme .redemption-modal-content h3 { color: #d8dbe0; }
        .dark-theme .result-modal-content p, .dark-theme .redemption-modal-content p { color: #b0b0b0; }
        .dark-theme .result-summary, .dark-theme .redemption-summary { background: #444; }
        .dark-theme .result-summary h3, .dark-theme .redemption-summary h3 {
            color: #d8dbe0;
            background: linear-gradient(135deg, #d7b15c, #b89b4a);
        }
        .dark-theme .result-summary .question-block, .dark-theme .redemption-summary .question-block {
            background: #555;
        }
        .dark-theme .result-summary .question-block:hover, .dark-theme .redemption-summary .question-block:hover {
            background: #666;
        }
        .dark-theme .result-summary .question, .dark-theme .redemption-summary .question { color: #d8dbe0; }
        .dark-theme .result-summary .user-answer, .dark-theme .redemption-summary .user-answer { color: #b0b0b0; }
        .dark-theme .result-summary .correct-answer, .dark-theme .redemption-summary .correct-answer { color: #2ecc71; }
        .dark-theme .result-summary .user-answer.incorrect, .dark-theme .redemption-summary .user-answer.incorrect { color: #e74c3c; }
        .dark-theme .result-summary .time-taken, .dark-theme .redemption-summary .time-taken { color: #b0b0b0; }
        .dark-theme .explanation { background: #1a3c3e; color: #d8dbe0; }
        .dark-theme .result-stats { background: #1a3c3e; }
        .dark-theme .result-stats div { color: #d8dbe0; }
        .dark-theme .notification { background: #c0392b; }
        footer {
            background-color: #333;
            color: white;
            padding: 15px 30px;
            text-align: center;
            margin-left: 290px;
            z-index: 1;
            transition: margin-left 0.3s ease;
        }
        footer p { margin: 0; font-size: 14px; }
        .footer-links { margin-top: 5px; }
        .footer-links a {
            color: #d7b15c;
            text-decoration: none;
            margin: 0 10px;
            font-size: 14px;
        }
        .footer-links a:hover { text-decoration: underline; }
        .dark-theme footer { background-color: #1a1a1a; }
        @media (max-width: 1024px) {
            .sidebar { width: 250px; }
            .sidebar h1 { font-size: 22px; }
            .sidebar ul li a { font-size: 16px; }
            .dark-theme-label { font-size: 16px; }
            .content { margin-left: 250px; }
            footer { margin-left: 250px; }
            .quiz-section h1 { font-size: 32px; }
            .difficulty-card { width: 160px; }
            .tutorial-modal-content { max-width: 700px; }
        }
        @media (max-width: 768px) {
            .sidebar { width: 200px; padding: 10px; }
            .sidebar h1 { font-size: 20px; }
            .sidebar ul li a { font-size: 14px; }
            .dark-theme-label { font-size: 14px; }
            .content { margin-left: 200px; }
            footer { margin-left: 200px; }
            .quiz-section { padding: 30px; }
            .options { grid-template-columns: 1fr; }
            .difficulty-card { width: 140px; }
            .slide-content {
                flex-direction: column;
            }
            .slide-image {
                max-width: 200px;
            }
            .features-grid {
                grid-template-columns: 1fr;
            }
            .tutorial-modal-content { max-width: 500px; }
        }
        @media (max-width: 480px) {
            .container { flex-direction: column; }
            .mobile-nav { display: block; }
            .sidebar {
                width: 100%;
                height: calc(100vh - 60px);
                position: fixed;
                top: 60px;
                left: 0;
                padding: 15px;
                transform: translateX(-100%);
                z-index: 1001;
                overflow-y: auto;
                background-size: cover;
                background-position: center;
                background-color: #1a1a1a;
                display: block;
            }
            .sidebar.active { transform: translateX(0); }
            .sidebar h1 { display: none; }
            .sidebar ul { margin: 0; }
            .sidebar ul li { margin: 20px 0; }
            .sidebar ul li a { font-size: 16px; }
            .dark-theme-container { margin-top: 20px; }
            .dark-theme-label { font-size: 16px; }
            .content {
                margin-left: 0;
                padding: 70px 15px 15px 15px;
                overflow-y: auto;
                min-height: 100vh;
            }
            .tutorial-modal-content {
                padding: 15px;
                max-width: 360px;
            }
            footer { margin-left: 0; padding: 10px 20px; text-align: center; }
            .footer-links a { font-size: 12px; margin: 0 8px; }
            .quiz-section { padding: 20px; }
            .quiz-section h1 { font-size: 24px; }
            .question-text { font-size: 1.2em; }
            .option-btn { font-size: 1em; padding: 12px; min-height: 44px; }
            .next-btn, .exit-game-btn { font-size: 16px; padding: 12px 25px; min-height: 44px; }
            .score { font-size: 1.3em; }
            .progress-text { font-size: 1em; }
            .timer-svg { width: 50px; height: 50px; }
            .timer-circle { stroke-dasharray: 125.6; }
            .timer-text { font-size: 16px; margin-left: 8px; }
            .power-up-btn { font-size: 12px; padding: 8px; min-height: 44px; }
            .difficulty-options { flex-direction: column; align-items: center; gap: 15px; }
            .difficulty-card { width: 100%; max-width: 280px; padding: 15px; }
            .start-modal-content, .tutorial-modal-content, .result-modal-content, .redemption-modal-content {
                padding: 15px;
                width: 95%;
                max-width: 360px;
                max-height: 90vh;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                margin: 10px;
                box-sizing: border-box;
            }
            .start-modal-content h2, .tutorial-modal-content h2, .result-modal-content h2, .redemption-modal-content h2 {
                font-size: 20px;
                margin-bottom: 15px;
            }
            .start-modal-actions, .tutorial-actions, .result-actions, .redemption-actions {
                flex-direction: column;
                gap: 10px;
            }
            .start-btn, .tutorial-btn, .restart-btn, .back-btn, .start-quiz-btn, .exit-btn, .back-about-btn, .skip-redemption-btn {
                padding: 10px 20px;
                font-size: 16px;
                width: 100%;
                max-width: 280px;
            }
            .tutorial-slide img { max-width: 200px; }
            .tutorial-slide h3 { font-size: 22px; }
            .tutorial-slide p { font-size: 14px; }
            .tutorial-prev, .tutorial-next { font-size: 14px; padding: 6px; }
            .dont-show-again { font-size: 12px; }
            button, .difficulty-card { -webkit-tap-highlight-color: transparent; }
        }
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes zoomIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fadeInOut {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }
        @keyframes moveStripes {
            0% { background-position: 0 0; }
            100% { background-position: 30px 0; }
        }
        @keyframes diceRoll {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(90deg) scale(1.2); }
            50% { transform: rotate(180deg) scale(1); }
            75% { transform: rotate(270deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }
    </style>
</head>
<body>
    <div class="loader-overlay" id="loaderOverlay">
        <div class="loader"></div>
    </div>
    <div class="mobile-nav">
        <a href="HomePage.html" class="logo">Contra E-Crime</a>
        <div class="menu-icon" id="mobileMenuIcon">
            <i class="fas fa-bars"></i>
        </div>
    </div>
    <div class="container">
       <nav class="sidebar" id="sidebar">
    <h1>Contra E-Crime</h1>
    <ul>
        <li>
            <a href="HomePage.html">
                <img src="https://i.imgur.com/OAHusQp.png" alt="Home">
                Home
            </a>
        </li>
        <li>
            <a href="News.html" target="_self" onclick="return true;">
                <img src="https://i.imgur.com/FNALwXX.png" alt="News & Insights">
                News & Insights
            </a>
        </li>
        <li>
            <a href="SavedLaws.html">
                <img src="https://i.imgur.com/VChoqhD.png" alt="Saved Laws">
                Saved Laws
            </a>
        </li>
        <li>
            <a href="History.html">
                <img src="https://i.imgur.com/cnaDfEq.png" alt="Search History">
                Search History
            </a>
        </li>
        <li>
            <a href="ContactUs.html">
                <img src="https://i.imgur.com/T7bI4RJ.png" alt="Contact Us">
                Contact Us
            </a>
        </li>
        <li>
            <a href="AboutUs.html">
                <img src="https://i.imgur.com/lktrzpa.png" alt="About Us">
                About Us
            </a>
        </li>
        <li>
            <a href="index.html">
                <img src="https://i.imgur.com/2jjsgOq.png" alt="Logout">
                Logout
            </a>
        </li>
    </ul>
    <div class="dark-theme-container">
        <div class="dark-theme-label">
            <img src="https://i.imgur.com/vEKpOsq.png" alt="Dark Theme">
            <span>Dark Theme</span>
        </div>
        <div class="toggle-switch">
            <label class="switch-label">
                <input type="checkbox" class="checkbox" id="themeToggle">
                <span class="slider"></span>
            </label>
        </div>
    </div>
</nav>
        <main class="content">
            <section class="quiz-section" id="quizSection">
                <div id="particles-js"></div>
                <h1>CyberLaw Quiz Master</h1>
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <div class="progress-text" id="progressText"></div>
                <div class="timer-container">
                    <svg class="timer-svg">
                        <circle class="timer-circle" cx="35" cy="35" r="30"></circle>
                    </svg>
                    <span class="timer-text" id="timerText"></span>
                    <div class="power-ups">
                        <button class="power-up-btn" id="extraTime1" title="Add 10 seconds"><i class="fas fa-clock"></i> Extra Time 1</button>
                        <button class="power-up-btn" id="extraTime2" title="Add 10 seconds"><i class="fas fa-clock"></i> Extra Time 2</button>
                        <button class="power-up-btn" id="timeFreeze" title="Freeze Timer"><i class="fas fa-pause"></i> Time Freeze</button>
                    </div>
                </div>
                <div class="question-box" id="questionBox">
                    <div class="question-text" id="questionText"></div>
                    <div class="options" id="options"></div>
                    <div class="explanation" id="explanation"></div>
                </div>
                <div class="button-container">
                    <button class="next-btn" id="nextBtn"><i class="fas fa-arrow-right"></i> Next Question</button>
                    <button class="exit-game-btn" id="exitGameBtn"><i class="fas fa-door-open"></i> Exit Game</button>
                </div>
                <div class="score" id="score">Score: 0</div>
            </section>
        </main>
        <div class="start-modal active" id="startModal">
            <div class="start-modal-content">
                <h2>Welcome to CyberLaw Quiz Master!</h2>
                <p>Select your difficulty level to begin:</p>
                <div class="difficulty-options">
                    <div class="difficulty-card" data-difficulty="easy">
                        <div class="label">Easy</div>
                        <div class="description">40 seconds per question, basic law questions.</div>
                    </div>
                    <div class="difficulty-card" data-difficulty="medium">
                        <div class="label">Medium</div>
                        <div class="description">35 seconds per question, mixed easy and scenario-based.</div>
                    </div>
                    <div class="difficulty-card" data-difficulty="hard">
                        <div class="label">Hard</div>
                        <div class="description">20 seconds per question, advanced details.</div>
                    </div>
                </div>
                <div class="start-modal-actions">
                    <button class="tutorial-btn" id="tutorialBtn" disabled><i class="fas fa-info-circle"></i> Proceed to Tutorial/Quiz</button>
                    <button class="back-about-btn" id="backAboutBtn"><i class="fas fa-arrow-left"></i> Back to About Us</button>
                </div>
            </div>
        </div>
        <div class="tutorial-modal" id="tutorialModal">
    <div class="tutorial-modal-content">
        <!-- Slide 1 - Welcome -->
        <div class="tutorial-slide active" id="slide1">
            <div class="slide-header">
                <h3>📚 Welcome to CyberLaw Quiz Master</h3>
            </div>
            <div class="slide-content">
                <img src="https://i.imgur.com/Ho1v1YP.png" alt="Law Book" class="slide-image">
                <div class="slide-text">
                    <p>Test your knowledge of cybercrime laws in the Philippines and worldwide through this interactive quiz. 🚀</p>
                    <div class="feature-highlight">
                        <i class="fas fa-bolt"></i>
                        <span>Use special power-ups to help you succeed! ⚡</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 2 - Gameplay -->
        <div class="tutorial-slide" id="slide2">
            <div class="slide-header">
                <h3>🎮 How to Play</h3>
            </div>
            <div class="slide-content">
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">⏱️</div>
                        <h4>Time Limits</h4>
                        <p>Easy: 40s | Medium: 35s | Hard: 20s per question</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">✨</div>
                        <h4>Power-Ups</h4>
                        <p>2x Extra Time (+10s)<br>1x Time Freeze (pause timer)</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">🎯</div>
                        <h4>Scoring</h4>
                        <p>10 points per correct answer<br>10 points in redemption</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 3 - Redemption -->
        <div class="tutorial-slide" id="slide3">
            <div class="slide-header">
                <h3>🎲 Redemption Round</h3>
            </div>
            <div class="slide-content">
                <img src="https://i.imgur.com/cvsWr1c.jpeg" alt="Redemption" class="slide-image">
                <div class="slide-text">
                    <p>After the main quiz, you'll get a chance to recover points from questions you missed. 🔄</p>
                    <div class="feature-highlight">
                        <i class="fas fa-dice"></i>
                        <span>Roll the dice to select a redemption question! 🎰</span>
                    </div>
                    <ul class="feature-list">
                        <li><i class="fas fa-check-circle"></i> Earn 10 points per correct redemption answer</li>
                        <li><i class="fas fa-info-circle"></i> Detailed explanations for all answers</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <button class="tutorial-prev" id="tutorialPrev"><i class="fas fa-chevron-left"></i></button>
        <button class="tutorial-next" id="tutorialNext"><i class="fas fa-chevron-right"></i></button>
        
        <div class="tutorial-actions">
            <button class="back-btn" id="backBtn"><i class="fas fa-arrow-left"></i> Back</button>
            <button class="start-quiz-btn" id="startQuizBtn"><i class="fas fa-play"></i> Start Quiz</button>
        </div>

        <div class="dont-show-again">
            <input type="checkbox" id="dontShowAgain">
            <label for="dontShowAgain">Skip tutorial next time</label>
        </div>
    </div>
</div>
        <div class="result-modal" id="resultModal">
            <div class="result-modal-content">
                <h2>Quiz Completed!</h2>
                <p>Your Score: <span id="finalScore"></span></p>
                <div class="result-stats">
                    <div><strong>Accuracy:</strong> <span id="accuracy"></span>%</div>
                    <div><strong>Average Time per Question:</strong> <span id="avgTime"></span>s</div>
                    <div><strong>Difficulty Analysis:</strong> <span id="difficultyAnalysis"></span></div>
                </div>
                <h3>Thinking Level</h3>
                <p id="thinkingLevel"></p>
                <h3>Remarks</h3>
                <p id="remarks"></p>
                <h3>Problem-Solving Skills</h3>
                <p id="problemSolving"></p>
                <h3>Detailed Results</h3>
                <div class="result-summary" id="resultSummary"></div>
                <div class="result-actions">
                    <button class="restart-btn" id="restartBtn"><i class="fas fa-redo"></i> Play Again</button>
                    <button class="exit-btn" id="exitBtn"><i class="fas fa-times"></i> Go Back to Difficulty</button>
                </div>
            </div>
        </div>
<div class="redemption-modal" id="redemptionModal">
    <div class="redemption-modal-content">
        <h2>Redemption Round</h2>
        <p id="redemptionMessage">You got <span class="wrong-count">3</span> question(s) wrong. Roll a die to select a question for redemption (worth 10 points).</p>
        
        <div class="dice-container" id="diceContainer">
            <div class="dice-option">
                <div class="dice-icon" data-dice="1">🎲</div>
                <div class="dice-label">Dice 1</div>
            </div>
            <div class="dice-option">
                <div class="dice-icon" data-dice="2">🎲</div>
                <div class="dice-label">Dice 2</div>
            </div>
            <div class="dice-option">
                <div class="dice-icon" data-dice="3">🎲</div>
                <div class="dice-label">Dice 3</div>
            </div>
        </div>
        
        <div class="redemption-actions">
            <button class="skip-redemption-btn" id="skipRedemptionBtn">
                <i class="fas fa-forward"></i> Skip Redemption
            </button>
        </div>
    </div>
</div>


        <div class="notification" id="timeUpNotification">Time's Up!</div>
        <footer>
            <p>© 2025 Contra E-Crime. All rights reserved.</p>
            <div class="footer-links">
                <a href="PrivacyPolicy.html">Privacy Policy</a>
                <a href="TermsOfUse.html">Terms of Use</a>
                <a href="ContactUs.html">Contact Us</a>
            </div>
        </footer>
    </div>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script>
       // Firebase initialization
const firebaseConfig = {
    apiKey: "AIzaSyCDNmxNOV7rr_qfM_mTeYTaUIkkLvRaf80",
    authDomain: "contra-e-crime.firebaseapp.com",
    projectId: "contra-e-crime",
    storageBucket: "contra-e-crime.firebasestorage.app",
    messagingSenderId: "198995444405",
    appId: "1:198995444405:web:5f8c6eed561461b36034fc",
    measurementId: "G-7Y2E24DD42"
};

try {
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    console.log('Firebase initialized successfully');
} catch (error) {
    console.error('Firebase initialization failed:', error);
}

// Particles.js initialization
try {
    particlesJS('particles-js', {
        particles: {
            number: { value: 80, density: { enable: true, value_area: 800 } },
            color: { value: '#ffcc00' },
            shape: { type: 'circle' },
            opacity: { value: 0.5, random: false },
            size: { value: 3, random: true },
            line_linked: { enable: true, distance: 150, color: '#ffcc00', opacity: 0.4, width: 1 },
            move: { enable: true, speed: 2, direction: 'none', random: false, straight: false, out_mode: 'out', bounce: false }
        },
        interactivity: {
            detect_on: 'canvas',
            events: { onhover: { enable: true, mode: 'repulse' }, onclick: { enable: true, mode: 'push' }, resize: true },
            modes: { repulse: { distance: 100, duration: 0.4 }, push: { particles_nb: 4 } }
        },
        retina_detect: true
    });
    console.log('Particles.js initialized');
} catch (error) {
    console.error('Particles.js initialization failed:', error);
}

// Stub sound functions to prevent errors
function playSound(sound) {
    console.log('Sound play attempted:', sound);
}

const questions = {
    easy: [
        {
            text: "Which law addresses crimes like hacking and data interference?",
            answer: "Cybercrime Prevention Act of 2012 (Republic Act No. 10175)",
            options: [
                "Cybercrime Prevention Act of 2012 (Republic Act No. 10175)",
                "Anti-Child Pornography Act of 2009 (Republic Act No. 9775)",
                "Consumer Act of the Philippines (Republic Act No. 7394)",
                "Safe Spaces Act (Republic Act No. 11313)"
            ],
            explanation: "The Cybercrime Prevention Act of 2012 (RA 10175) targets cybercrimes such as hacking, data interference, and identity theft to protect digital systems."
        },
        {
            text: "What term describes stealing someone’s personal information for financial gain?",
            answer: "Identity Theft",
            options: [
                "Identity Theft",
                "Cyber-Squatting",
                "Voyeurism",
                "Phishing"
            ],
            explanation: "Identity Theft involves using another person’s identity for financial advantage, often penalized under laws like the Access Devices Regulation Act."
        },
        {
            text: "Which law protects consumers from defective products and unfair practices?",
            answer: "Consumer Act of the Philippines (Republic Act No. 7394)",
            options: [
                "Consumer Act of the Philippines (Republic Act No. 7394)",
                "Data Privacy Act of 2012 (Republic Act No. 10173)",
                "Anti-Money Laundering Act of 2001 (Republic Act No. 9160)",
                "Optical Media Act of 2003 (Republic Act No. 9239)"
            ],
            explanation: "The Consumer Act of the Philippines (RA 7394) ensures consumer protection against defective products and deceptive sales practices."
        },
        {
            text: "What does the Anti-Bullying Act of 2013 aim to prevent in schools?",
            answer: "Bullying",
            options: [
                "Bullying",
                "Wiretapping",
                "Money Muling",
                "Cybersex"
            ],
            explanation: "The Anti-Bullying Act of 2013 (RA 10627) addresses bullying in schools, such as repeated harassment or intimidation of students."
        },
        {
            text: "Which law requires SIM card registration to curb telecom fraud?",
            answer: "Subscriber Identity Module (SIM) Registration Act (Republic Act No. 11934)",
            options: [
                "Subscriber Identity Module (SIM) Registration Act (Republic Act No. 11934)",
                "Anti-Terrorism Act of 2020 (Republic Act No. 11449)",
                "Electronic Commerce Act of 2000 (Republic Act No. 8792)",
                "Safe Spaces Act (Republic Act No. 11313)"
            ],
            explanation: "The SIM Registration Act (RA 11934) mandates SIM card registration to enhance telecom security and prevent fraud."
        },
        {
            text: "What term refers to secretly recording someone in a private setting?",
            answer: "Voyeurism",
            options: [
                "Voyeurism",
                "Grooming",
                "SIM Spoofing",
                "Data Breach"
            ],
            explanation: "Voyeurism involves unauthorized recording of someone in private, penalized under the Anti-Photo and Video Voyeurism Act."
        },
        {
            text: "Which law criminalizes the distribution of pirated DVDs and Blu-rays?",
            answer: "Optical Media Act of 2003 (Republic Act No. 9239)",
            options: [
                "Optical Media Act of 2003 (Republic Act No. 9239)",
                "Intellectual Property Code of the Philippines (Republic Act No. 8293)",
                "Anti-Wire Tapping Act (Republic Act No. 4200)",
                "Anti-Financial Account Scamming Act (Republic Act No. 12010)"
            ],
            explanation: "The Optical Media Act of 2003 (RA 9239) penalizes the illegal manufacture and distribution of pirated optical media."
        },
        {
            text: "What is the main goal of the Safe Spaces Act?",
            answer: "Prevent gender-based harassment",
            options: [
                "Prevent gender-based harassment",
                "Regulate electronic tax filing",
                "Protect intellectual property",
                "Curb terrorism financing"
            ],
            explanation: "The Safe Spaces Act (RA 11313) aims to prevent gender-based sexual harassment in online, public, and workplace settings."
        },
        {
            text: "Which law regulates online pharmaceutical sales for safety?",
            answer: "Online Pharmaceutical Sales Regulation (FDA Administrative Order No. 2013-0027)",
            options: [
                "Online Pharmaceutical Sales Regulation (FDA Administrative Order No. 2013-0027)",
                "E-Commerce Protection Guidelines (DTI Administrative Order No. 22-01)",
                "Anti-Money Laundering Act of 2001 (Republic Act No. 9160)",
                "Strategic Trade Management Act (Republic Act No. 10697)"
            ],
            explanation: "The FDA’s Online Pharmaceutical Sales Regulation (AO 2013-0027) ensures safe distribution and storage of pharmaceuticals sold online."
        },
        {
            text: "What term describes AI-generated fake media used in elections?",
            answer: "Deep Fake",
            options: [
                "Deep Fake",
                "Phishing Attack",
                "System Interference",
                "Electronic Evidence"
            ],
            explanation: "Deep Fake refers to AI-generated media falsely depicting individuals, regulated under COMELEC’s Social Media and AI Election Guidelines."
        }
    ],
    medium: [
        {
            text: "Which scenario best illustrates a violation of the Anti-Money Laundering Act?",
            answer: "Depositing drug trafficking proceeds into a legitimate business account",
            options: [
                "Depositing drug trafficking proceeds into a legitimate business account",
                "Sending inappropriate messages in a group chat without consent",
                "Using a copyrighted song in a commercial without permission",
                "Installing a secret camera to record a child’s bedroom"
            ],
            explanation: "Depositing illicit drug money into a legitimate business to conceal its origins violates the Anti-Money Laundering Act (RA 9160), which targets financial crimes like money laundering."
        },
        {
            text: "What scenario might prompt action by the National Bureau of Investigation under RA 10867?",
            answer: "Investigating a phishing scam mimicking online banking portals",
            options: [
                "Investigating a phishing scam mimicking online banking portals",
                "Exporting dual-use computer chips without a license",
                "Sending promotional texts without subscriber opt-in",
                "Teasing a student over their penmanship in class"
            ],
            explanation: "The NBI, empowered by the NBI Reorganization Act (RA 10867), investigates cybercrimes like phishing scams through its Cybercrime Division, targeting fake banking websites."
        },
        {
            text: "Which scenario could violate the Anti-Online Sexual Abuse or Exploitation of Children Act?",
            answer: "A relative coerces a minor to send explicit content for money",
            options: [
                "A relative coerces a minor to send explicit content for money",
                "Using stolen credit card details for online purchases",
                "Manually filing taxes despite eFPS mandates",
                "Posting defamatory statements on social media"
            ],
            explanation: "Coercing a minor to produce explicit content online violates the Anti-Online Sexual Abuse or Exploitation of Children Act (RA 11930), which protects children from digital exploitation."
        },
        {
            text: "What action might breach the Social Media and AI Election Guidelines?",
            answer: "Distributing unregistered AI-generated campaign videos",
            options: [
                "Distributing unregistered AI-generated campaign videos",
                "Hacking an e-commerce platform to place orders",
                "Selling pirated DVDs in a local market",
                "Ignoring cloud computing mandates for government systems"
            ],
            explanation: "Using unregistered AI-generated content, like deep fakes, in election campaigns violates COMELEC Resolution No. 11064 (2024), which requires transparency in digital platforms."
        },
        {
            text: "Which scenario might involve the Anti-Terrorism Act of 2020?",
            answer: "Releasing dangerous substances to intimidate the government",
            options: [
                "Releasing dangerous substances to intimidate the government",
                "Using a fake ID to register multiple SIM cards",
                "Secretly recording a business meeting",
                "Selling counterfeit products online"
            ],
            explanation: "Releasing dangerous substances to intimidate is a terrorist act under the Anti-Terrorism Act (RA 11449), which addresses threats to public safety."
        },
        {
            text: "What might violate the Access Devices Regulation Act?",
            answer: "Installing illegal card readers on ATMs to steal data",
            options: [
                "Installing illegal card readers on ATMs to steal data",
                "Observing a child via a hidden camera",
                "Setting a prepaid load expiry shorter than one year",
                "Failing to report a cyber incident to the BSP"
            ],
            explanation: "Credit card skimming via illegal ATM readers violates the Access Devices Regulation Act (RA 8484), which criminalizes unauthorized use of access devices."
        },
        {
            text: "Which scenario could breach the Rules on Electronic Evidence?",
            answer: "Presenting an unauthenticated email as evidence in court",
            options: [
                "Presenting an unauthenticated email as evidence in court",
                "Laundering money through fake bank accounts",
                "Bullying a student over their penmanship",
                "Exporting strategic goods without approval"
            ],
            explanation: "Presenting an unauthenticated email violates the Rules on Electronic Evidence (A.M. No. 01-7-01-SC), which requires proper authentication for electronic documents to be admissible."
        },
        {
            text: "What scenario might violate the Guidelines on Prepaid Load Expiry?",
            answer: "A telecom sets a six-month expiry for a ₱100 prepaid load",
            options: [
                "A telecom sets a six-month expiry for a ₱100 prepaid load",
                "A bank fails to implement multi-factor authentication",
                "A company uses a copyrighted logo without permission",
                "A suspect distributes deep fake election ads"
            ],
            explanation: "Setting a prepaid load expiry shorter than one year violates the NTC’s Guidelines on Prepaid Load Expiry (MC No. 01-04-2019), which mandates a one-year validity."
        },
        {
            text: "Which scenario might involve the Anti-Financial Account Scamming Act?",
            answer: "Opening fake accounts with stolen IDs for scam funds",
            options: [
                "Opening fake accounts with stolen IDs for scam funds",
                "Recording a private conversation without consent",
                "Sending inappropriate messages in a group chat",
                "Using a mobile number to send smishing texts"
            ],
            explanation: "Opening fake accounts for scam funds, like money muling, violates the Anti-Financial Account Scamming Act (RA 12010), which targets online fraud schemes."
        },
        {
            text: "What might violate the Anti-Photo and Video Voyeurism Act?",
            answer: "Secretly recording someone showering and sharing it online",
            options: [
                "Secretly recording someone showering and sharing it online",
                "Hacking a company’s network for customer data",
                "Using a fake ID to register SIM cards",
                "Ignoring BSP cybersecurity guidelines"
            ],
            explanation: "Secretly recording and distributing private footage violates the Anti-Photo and Video Voyeurism Act (RA 9995), which protects against unauthorized recordings."
        }
    ],
    hard: [
        {
            text: "Which description best captures the Anti-Financial Account Scamming Act (RA 12010)?",
            answer: "Strengthens bank fraud prevention and penalizes money muling and social engineering",
            options: [
                "Strengthens bank fraud prevention and penalizes money muling and social engineering",
                "Protects personal data privacy through regulated data processing",
                "Criminalizes unauthorized interception of private communications",
                "Regulates the export of dual-use goods to prevent misuse"
            ],
            explanation: "The Anti-Financial Account Scamming Act (RA 12010) focuses on combating online fraud by enhancing bank fraud prevention systems and penalizing acts like money muling and social engineering, distinguishing it from data privacy or export laws."
        },
        {
            text: "What unique provision does the Subscriber Identity Module (SIM) Registration Act include to curb fraud?",
            answer: "Mandates Public Telecommunications Entities to track SIM usage",
            options: [
                "Mandates Public Telecommunications Entities to track SIM usage",
                "Requires banks to implement multi-factor authentication",
                "Prohibits the use of AI-generated content in elections",
                "Allows asset freezing for suspected terrorist funds"
            ],
            explanation: "The SIM Registration Act (RA 11934) uniquely requires Public Telecommunications Entities to track SIM card usage to prevent fraud like smishing, unlike provisions in banking, election, or terrorism laws."
        },
        {
            text: "Which scenario best distinguishes a violation of the Data Privacy Act from the Cybercrime Prevention Act?",
            answer: "A BPO employee illegally accesses client data for fraud, without hacking the system",
            options: [
                "A hacker steals credit card data by breaching a company’s network",
                "A BPO employee illegally accesses client data for fraud, without hacking the system",
                "A suspect distributes child pornography via a computer system",
                "A group uses fake SIM cards to send phishing texts"
            ],
            explanation: "Illegal access to client data by a BPO employee without hacking violates the Data Privacy Act (RA 10173) for unauthorized data processing, whereas hacking or child pornography distribution falls under the Cybercrime Prevention Act (RA 10175), making this scenario distinct."
        },
        {
            text: "What penalty applies for producing child sexual abuse materials under the Anti-Online Sexual Abuse or Exploitation of Children Act?",
            answer: "Life imprisonment and at least ₱2,000,000 fine",
            options: [
                "Life imprisonment and at least ₱2,000,000 fine",
                "6 to 12 years imprisonment and ₱500,000 fine",
                "3 to 7 years imprisonment and ₱100,000 fine",
                "Reclusion temporal and ₱1,000,000 fine"
            ],
            explanation: "The Anti-Online Sexual Abuse or Exploitation of Children Act (RA 11930) imposes life imprisonment and a minimum ₱2,000,000 fine for producing child sexual abuse materials, reflecting its severe stance on child exploitation."
        },
        {
            text: "Which law’s scope might be confused with the Anti-Wire Tapping Act due to overlapping privacy concerns?",
            answer: "Anti-Photo and Video Voyeurism Act (Republic Act No. 9995)",
            options: [
                "Anti-Photo and Video Voyeurism Act (Republic Act No. 9995)",
                "Anti-Money Laundering Act of 2001 (Republic Act No. 9160)",
                "Strategic Trade Management Act (Republic Act No. 10697)",
                "Consumer Act of the Philippines (Republic Act No. 7394)"
            ],
            explanation: "The Anti-Photo and Video Voyeurism Act (RA 9995) overlaps with the Anti-Wire Tapping Act (RA 4200) in addressing unauthorized recordings, but focuses on visual privacy violations, creating potential confusion in privacy-related cases."
        },
        {
            text: "What specific role does the Anti-Terrorism Council play under the Anti-Terrorism Act of 2020?",
            answer: "Designates terrorists and oversees detention and surveillance",
            options: [
                "Designates terrorists and oversees detention and surveillance",
                "Registers SIM cards to prevent telecom fraud",
                "Authenticates electronic evidence for court cases",
                "Conducts risk assessments for bank cybersecurity"
            ],
            explanation: "The Anti-Terrorism Act (RA 11449) empowers the Anti-Terrorism Council to designate terrorists and manage detention and surveillance, a unique role distinguishing it from telecom, evidence, or banking regulations."
        },
        {
            text: "Which scenario might require distinguishing between the Intellectual Property Code and the Optical Media Act?",
            answer: "A company illegally distributes pirated movies on DVDs without a license",
            options: [
                "A company illegally distributes pirated movies on DVDs without a license",
                "A bank fails to report a cyber incident to the BSP",
                "A suspect uses a fake ID to register SIM cards",
                "A hacker steals customer data from a website"
            ],
            explanation: "Illegal DVD piracy could violate the Optical Media Act (RA 9239) for unlicensed distribution or the Intellectual Property Code (RA 8293) for copyright infringement, requiring careful distinction based on licensing vs. copyright issues."
        },
        {
            text: "What penalty does the Safe Spaces Act impose for a third offense of lewd acts like groping?",
            answer: "1 month and 1 day to 6 months imprisonment and ₱20,000 fine",
            options: [
                "1 month and 1 day to 6 months imprisonment and ₱20,000 fine",
                "11 to 30 days imprisonment and ₱10,000 fine",
                "6 months to 2 years imprisonment and ₱50,000 fine",
                "Reclusion perpetua and ₱500,000 fine"
            ],
            explanation: "The Safe Spaces Act (RA 11313) specifies 1 month and 1 day to 6 months imprisonment and a ₱20,000 fine for a third offense of lewd acts, such as groping, escalating from lesser penalties."
        },
        {
            text: "Which term from the Cybercrime Prevention Act might be confused with ‘Data Breach’ under the Data Privacy Act?",
            answer: "Data Interference",
            options: [
                "Data Interference",
                "Cyber-Squatting",
                "Cybersex",
                "System Interference"
            ],
            explanation: "Data Interference, involving intentional alteration or deletion of data, under the Cybercrime Prevention Act (RA 10175), may be confused with a Data Breach under the Data Privacy Act (RA 10173), as both involve data compromise but differ in intent and scope."
        },
        {
            text: "What penalty applies for non-compliance with a cybercrime warrant under A.M. No. 17-11-03-SC?",
            answer: "Penalties under the Cybercrime Prevention Act",
            options: [
                "Penalties under the Cybercrime Prevention Act",
                "Fines up to ₱1,000 and 6 months imprisonment",
                "Administrative sanctions only",
                "Reclusion perpetua and ₱5,000,000 fine"
            ],
            explanation: "Non-compliance with a cybercrime warrant under A.M. No. 17-11-03-SC is penalized under the Cybercrime Prevention Act (RA 10175), which may include imprisonment or fines, depending on the offense."
        }
    ]
};

// DOM elements
const loaderOverlay = document.getElementById('loaderOverlay');
const mobileMenuIcon = document.getElementById('mobileMenuIcon');
const sidebar = document.getElementById('sidebar');
const themeToggle = document.getElementById('themeToggle');
const quizSection = document.getElementById('quizSection');
const progressBar = document.getElementById('progressBar');
const progressText = document.getElementById('progressText');
const timerText = document.getElementById('timerText');
const timerCircle = document.querySelector('.timer-circle');
const extraTime1 = document.getElementById('extraTime1');
const extraTime2 = document.getElementById('extraTime2');
const timeFreeze = document.getElementById('timeFreeze');
const questionText = document.getElementById('questionText');
const options = document.getElementById('options');
const explanation = document.getElementById('explanation');
const nextBtn = document.getElementById('nextBtn');
const exitGameBtn = document.getElementById('exitGameBtn');
const scoreElement = document.getElementById('score');
const startModal = document.getElementById('startModal');
const tutorialModal = document.getElementById('tutorialModal');
const resultModal = document.getElementById('resultModal');
const redemptionModal = document.getElementById('redemptionModal');
const tutorialBtn = document.getElementById('tutorialBtn');
const backAboutBtn = document.getElementById('backAboutBtn');
const backBtn = document.getElementById('backBtn');
const startQuizBtn = document.getElementById('startQuizBtn');
const dontShowAgain = document.getElementById('dontShowAgain');
const finalScore = document.getElementById('finalScore');
const accuracy = document.getElementById('accuracy');
const avgTime = document.getElementById('avgTime');
const difficultyAnalysis = document.getElementById('difficultyAnalysis');
const thinkingLevel = document.getElementById('thinkingLevel');
const remarks = document.getElementById('remarks');
const problemSolving = document.getElementById('problemSolving');
const resultSummary = document.getElementById('resultSummary');
const restartBtn = document.getElementById('restartBtn');
const exitBtn = document.getElementById('exitBtn');
const timeUpNotification = document.getElementById('timeUpNotification');
const redemptionMessage = document.getElementById('redemptionMessage');
const skipRedemptionBtn = document.getElementById('skipRedemptionBtn');
const tutorialPrev = document.getElementById('tutorialPrev');
const tutorialNext = document.getElementById('tutorialNext');

let selectedDifficulty = null;
let currentQuestionIndex = 0;
let score = 0;
let timeLeft = 0;
let timerInterval = null;
let isFrozen = false;
let questionStartTime = 0;
let wrongAnswers = [];
let userAnswers = [];
let isRedemption = false;
let extraTime1Used = false;
let extraTime2Used = false;
let timeFreezeUsed = false;
let currentSlide = 1;

// GSAP animations
gsap.to(quizSection, { opacity: 1, scale: 1, duration: 0.5, delay: 0.5 });

// Event listeners
mobileMenuIcon.addEventListener('click', function() {
    sidebar.classList.toggle('active');
    const icon = mobileMenuIcon.querySelector('i');
    if (sidebar.classList.contains('active')) {
        icon.classList.remove('fa-bars');
        icon.classList.add('fa-times');
    } else {
        icon.classList.remove('fa-times');
        icon.classList.add('fa-bars');
    }
    playSound('click');
});

themeToggle.addEventListener('change', () => {
    document.body.classList.toggle('dark-theme');
    localStorage.setItem('theme', document.body.classList.contains('dark-theme') ? 'dark' : 'light');
    playSound('click');
});

document.querySelectorAll('.difficulty-card').forEach(card => {
    card.addEventListener('click', () => {
        document.querySelectorAll('.difficulty-card').forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        selectedDifficulty = card.dataset.difficulty;
        tutorialBtn.disabled = false;
        playSound('click');
    });
});

tutorialBtn.addEventListener('click', () => {
    try {
        if (!selectedDifficulty) {
            showNotification('Please select a difficulty first!');
            return;
        }
        startModal.classList.remove('active');
        tutorialModal.classList.add('active');
        showSlide(1);
        playSound('click');
    } catch (error) {
        console.error('Error in tutorial button handler:', error);
    }
});

backAboutBtn.addEventListener('click', () => {
    window.location.href = 'AboutUs.html';
    playSound('click');
});

backBtn.addEventListener('click', () => {
    tutorialModal.classList.remove('active');
    startModal.classList.add('active');
    playSound('click');
});

startQuizBtn.addEventListener('click', () => {
    if (dontShowAgain.checked) {
        localStorage.setItem('skipTutorial', 'true');
    }
    tutorialModal.classList.remove('active');
    startQuiz();
    playSound('click');
});

tutorialPrev.addEventListener('click', () => {
    if (currentSlide > 1) {
        showSlide(currentSlide - 1);
        playSound('click');
    }
});

tutorialNext.addEventListener('click', () => {
    if (currentSlide < 3) {
        showSlide(currentSlide + 1);
        playSound('click');
    }
});

extraTime1.addEventListener('click', () => {
    if (!extraTime1Used && !extraTime1.disabled) {
        timeLeft += 10;
        timerText.textContent = `${timeLeft}s`;
        extraTime1Used = true;
        extraTime1.disabled = true;
        playSound('click');
    }
});

extraTime2.addEventListener('click', () => {
    if (!extraTime2Used && !extraTime2.disabled) {
        timeLeft += 10;
        timerText.textContent = `${timeLeft}s`;
        extraTime2Used = true;
        extraTime2.disabled = true;
        playSound('click');
    }
});

timeFreeze.addEventListener('click', () => {
    if (!timeFreezeUsed && !timeFreeze.disabled) {
        isFrozen = true;
        clearInterval(timerInterval);
        timeFreezeUsed = true;
        timeFreeze.disabled = true;
        playSound('click');
    }
});

nextBtn.addEventListener('click', () => {
    try {
        // Reset UI state
        explanation.classList.remove('visible');
        explanation.textContent = '';
        options.innerHTML = '';
        nextBtn.classList.remove('visible');
        exitGameBtn.classList.remove('visible');

        currentQuestionIndex++;
        loadQuestion();
        playSound('click');
    } catch (error) {
        console.error('Error in next button handler:', error);
        showNotification('Error loading next question. Please try again.');
    }
});

exitGameBtn.addEventListener('click', () => {
    clearInterval(timerInterval);
    showResult();
    playSound('gameOver');
});

restartBtn.addEventListener('click', () => {
    resetQuiz();
    startModal.classList.add('active');
    resultModal.classList.remove('active');
    playSound('click');
});

exitBtn.addEventListener('click', () => {
    resetQuiz();
    resultModal.classList.remove('active');
    startModal.classList.add('active');
    playSound('click');
});

skipRedemptionBtn.addEventListener('click', () => {
    redemptionModal.classList.remove('active');
    showResult();
    playSound('click');
});

// Functions
function showSlide(slideNumber) {
    try {
        const slides = document.querySelectorAll('.tutorial-slide');
        const prevSlide = document.getElementById(`slide${currentSlide}`);
        const nextSlide = document.getElementById(`slide${slideNumber}`);

        const direction = slideNumber > currentSlide ? 1 : -1;

        currentSlide = slideNumber;

        slides.forEach(slide => {
            slide.classList.remove('active');
            slide.style.display = 'none';
            slide.style.opacity = '0';
            slide.style.transform = `translateX(${direction * 50}px)`;
        });

        nextSlide.style.display = 'block';
        gsap.to(nextSlide, {
            opacity: 1,
            x: 0,
            duration: 0.5,
            ease: 'power2.out',
            onStart: () => {
                nextSlide.classList.add('active');
            }
        });

        if (slideNumber === 1) {
            tutorialPrev.classList.add('disabled');
            tutorialNext.classList.remove('disabled');
        } else if (slideNumber === 3) {
            tutorialPrev.classList.remove('disabled');
            tutorialNext.classList.add('disabled');
        } else {
            tutorialPrev.classList.remove('disabled');
            tutorialNext.classList.remove('disabled');
        }

        console.log(`Showing slide ${slideNumber}`);
    } catch (error) {
        console.error('Error in showSlide:', error);
    }
}

function showNotification(message) {
    timeUpNotification.textContent = message;
    timeUpNotification.classList.add('visible');
    setTimeout(() => {
        timeUpNotification.classList.remove('visible');
    }, 2000);
}

function startQuiz() {
    if (localStorage.getItem('skipTutorial') === 'true') {
        tutorialModal.classList.remove('active');
    }
    quizSection.classList.add('visible');
    currentQuestionIndex = 0;
    score = 0;
    wrongAnswers = [];
    userAnswers = [];
    isRedemption = false;
    extraTime1Used = false;
    extraTime2Used = false;
    timeFreezeUsed = false;
    extraTime1.disabled = false;
    extraTime2.disabled = false;
    timeFreeze.disabled = false;
    scoreElement.textContent = `Score: ${score}`;
    loadQuestion();
}

function loadQuestion() {
    try {
        const questionList = isRedemption ? wrongAnswers : questions[selectedDifficulty];
        console.log('Loading question:', { currentQuestionIndex, questionListLength: questionList.length, isRedemption });

        if (!questionList || questionList.length === 0) {
            console.warn('Question list is empty or undefined');
            showResult();
            return;
        }

        if (currentQuestionIndex >= questionList.length) {
            console.log('Reached end of questions');
            if (isRedemption) {
                showResult();
            } else {
                showRedemptionModal();
            }
            return;
        }

        const question = questionList[currentQuestionIndex];
        questionText.textContent = question.text;
        options.innerHTML = '';
        explanation.textContent = '';
        explanation.classList.remove('visible');
        nextBtn.classList.remove('visible');
        exitGameBtn.classList.remove('visible'); // Hide until answered or time-out

        question.options.forEach(option => {
            const button = document.createElement('button');
            button.className = 'option-btn';
            button.innerHTML = `<i class="fas fa-circle"></i> ${option}`;
            button.addEventListener('click', () => checkAnswer(option, question.answer));
            options.appendChild(button);
        });

        progressText.textContent = `Question ${currentQuestionIndex + 1} of ${questionList.length}`;
        progressBar.style.width = `${((currentQuestionIndex + 1) / questionList.length) * 100}%`;

        timeLeft = selectedDifficulty === 'easy' ? 40 : selectedDifficulty === 'medium' ? 35 : 20;
        timerText.textContent = `${timeLeft}s`;
        timerCircle.style.strokeDashoffset = 0;
        questionStartTime = Date.now();

        isFrozen = false;

        clearInterval(timerInterval);
        if (!isFrozen) {
            timerInterval = setInterval(updateTimer, 1000);
        }

        extraTime1.disabled = extraTime1Used;
        extraTime2.disabled = extraTime2Used;
        timeFreeze.disabled = timeFreezeUsed;

        console.log('Loaded question:', question.text);
    } catch (error) {
        console.error('Error loading question:', error);
        showNotification('Error loading question. Ending quiz.');
        showResult();
    }
}

function updateTimer() {
    if (timeLeft <= 0) {
        clearInterval(timerInterval);
        showNotification("Time's Up!");
        playSound('timeUp');
        const currentQuestion = isRedemption ? wrongAnswers[currentQuestionIndex] : questions[selectedDifficulty][currentQuestionIndex];
        explanation.textContent = `Time's up! The correct answer was: ${currentQuestion.answer}. ${currentQuestion.explanation}`;
        explanation.classList.add('visible');
        nextBtn.classList.add('visible');
        exitGameBtn.classList.add('visible');
        userAnswers.push({
            question: currentQuestion.text,
            userAnswer: 'None (Time Up)',
            correctAnswer: currentQuestion.answer,
            timeTaken: (Date.now() - questionStartTime) / 1000,
            isCorrect: false
        });
        if (!isRedemption) {
            wrongAnswers.push(currentQuestion);
        }
        document.querySelectorAll('.option-btn').forEach(btn => btn.classList.add('disabled'));
        return;
    }

    timeLeft--;
    timerText.textContent = `${timeLeft}s`;
    const circumference = 188;
    const offset = circumference * (1 - timeLeft / (selectedDifficulty === 'easy' ? 40 : selectedDifficulty === 'medium' ? 35 : 20));
    timerCircle.style.strokeDashoffset = offset;
}

function checkAnswer(selectedOption, correctAnswer) {
    try {
        clearInterval(timerInterval);
        const timeTaken = (Date.now() - questionStartTime) / 1000;
        const isCorrect = selectedOption === correctAnswer;
        const currentQuestion = isRedemption ? wrongAnswers[currentQuestionIndex] : questions[selectedDifficulty][currentQuestionIndex];

        document.querySelectorAll('.option-btn').forEach(btn => {
            btn.classList.add('disabled');
            if (btn.textContent.includes(correctAnswer)) {
                btn.classList.add('correct');
            }
            if (btn.textContent.includes(selectedOption) && !isCorrect) {
                btn.classList.add('wrong');
            }
        });

        if (isCorrect) {
            score += 10;
            scoreElement.textContent = `Score: ${score}`;
            explanation.textContent = currentQuestion.explanation;
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
            playSound('correct');
        } else {
            explanation.textContent = `Incorrect. The correct answer was: ${correctAnswer}. ${currentQuestion.explanation}`;
            if (!isRedemption) {
                wrongAnswers.push(currentQuestion);
            }
            playSound('wrong');
        }

        explanation.classList.add('visible');
        nextBtn.classList.add('visible');
        exitGameBtn.classList.add('visible');

        userAnswers.push({
            question: currentQuestion.text,
            userAnswer: selectedOption,
            correctAnswer: correctAnswer,
            timeTaken: timeTaken,
            isCorrect: isCorrect
        });

        console.log('Answer checked:', { selectedOption, isCorrect, explanation: explanation.textContent });
    } catch (error) {
        console.error('Error in checkAnswer:', error);
        showNotification('Error processing answer. Moving to next question.');
        nextBtn.classList.add('visible');
    }
}

function showRedemptionModal() {
    try {
        if (wrongAnswers.length === 0) {
            showResult();
            return;
        }

        const numQuestions = Math.min(wrongAnswers.length, 3);
        redemptionMessage.innerHTML = `You got <span class="wrong-count">${wrongAnswers.length}</span> question(s) wrong. Roll a die to select a question for redemption (worth 10 points).`;

        const diceContainer = document.getElementById('diceContainer');
        diceContainer.innerHTML = '';

        for (let i = 0; i < numQuestions; i++) {
            const diceOption = document.createElement('div');
            diceOption.className = 'dice-option';
            diceOption.innerHTML = `
                <div class="dice-icon" data-dice="${i+1}">🎲</div>
                <div class="dice-label">Dice ${i+1}</div>
            `;

            diceOption.addEventListener('click', () => {
                const randomIndex = Math.floor(Math.random() * wrongAnswers.length);
                wrongAnswers = [wrongAnswers[randomIndex]];
                redemptionModal.classList.remove('active');
                isRedemption = true;
                currentQuestionIndex = 0;
                loadQuestion();
                playSound('click');

                const diceIcon = diceOption.querySelector('.dice-icon');
                diceIcon.style.animation = 'diceRoll 0.5s ease';
                setTimeout(() => {
                    diceIcon.style.animation = '';
                }, 500);
            });

            diceContainer.appendChild(diceOption);
        }

        redemptionModal.classList.add('active');
    } catch (error) {
        console.error('Error showing redemption modal:', error);
        showResult();
    }
}

function showResult() {
    try {
        clearInterval(timerInterval);
        quizSection.classList.remove('visible');
        resultModal.classList.add('active');

        finalScore.textContent = score;
        const correctCount = userAnswers.filter(ans => ans.isCorrect).length;
        const totalQuestions = userAnswers.length;
        const accuracyPercent = totalQuestions > 0 ? ((correctCount / totalQuestions) * 100).toFixed(2) : 0;
        accuracy.textContent = accuracyPercent;

        const totalTime = userAnswers.reduce((sum, ans) => sum + ans.timeTaken, 0);
        const avgTimePerQuestion = totalQuestions > 0 ? (totalTime / totalQuestions).toFixed(2) : 0;
        avgTime.textContent = avgTimePerQuestion;

        difficultyAnalysis.textContent = `You played on ${selectedDifficulty} mode. ${
            selectedDifficulty === 'easy' ? 'Great start! Try Medium for more scenarios.' :
            selectedDifficulty === 'medium' ? 'Good mix of basics and scenarios! Ready for Hard?' :
            'Impressive handling of advanced details! Keep mastering cyberlaws.'
        }`;

        thinkingLevel.textContent = accuracyPercent > 80 ? 'Excellent analytical skills!' :
                                   accuracyPercent > 50 ? 'Good understanding, keep practicing!' :
                                   'Needs improvement, review the laws!';

        remarks.textContent = score >= 80 ? 'Outstanding! You’re a cyberlaw expert!' :
                             score >= 50 ? 'Well done! Solid grasp of cyberlaws.' :
                             'Keep studying to boost your score!';

        problemSolving.textContent = avgTimePerQuestion < 10 ? 'Lightning-fast decisions!' :
                                    avgTimePerQuestion < 20 ? 'Steady and thoughtful!' :
                                    'Take your time to analyze carefully.';

        resultSummary.innerHTML = '';
        userAnswers.forEach((ans, index) => {
            const block = document.createElement('div');
            block.className = 'question-block';
            block.innerHTML = `
                <div class="question">Q${index + 1}: ${ans.question}</div>
                <div class="user-answer ${ans.isCorrect ? '' : 'incorrect'}">Your Answer: ${ans.userAnswer}</div>
                <div class="correct-answer">Correct Answer: ${ans.correctAnswer}</div>
                <div class="time-taken">Time Taken: ${ans.timeTaken.toFixed(2)}s</div>
            `;
            resultSummary.appendChild(block);
        });

        try {
            if (firebase.auth().currentUser) {
                const userId = firebase.auth().currentUser.uid;
                firebase.firestore().collection('quizResults').add({
                    userId: userId,
                    score: score,
                    accuracy: accuracyPercent,
                    avgTime: avgTimePerQuestion,
                    difficulty: selectedDifficulty,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                }).then(() => {
                    console.log('Quiz results saved to Firestore');
                }).catch(error => {
                    console.error('Error saving quiz results:', error);
                });
            }
        } catch (error) {
            console.error('Firestore save error:', error);
        }

        playSound('gameOver');
    } catch (error) {
        console.error('Error showing result:', error);
        showNotification('Error displaying results.');
    }
}

function resetQuiz() {
    selectedDifficulty = null;
    currentQuestionIndex = 0;
    score = 0;
    timeLeft = 0;
    isFrozen = false;
    wrongAnswers = [];
    userAnswers = [];
    isRedemption = false;
    extraTime1Used = false;
    extraTime2Used = false;
    timeFreezeUsed = false;
    extraTime1.disabled = false;
    extraTime2.disabled = false;
    timeFreeze.disabled = false;
    scoreElement.textContent = `Score: ${score}`;
    quizSection.classList.remove('visible');
    document.querySelectorAll('.difficulty-card').forEach(card => card.classList.remove('selected'));
    tutorialBtn.disabled = true;
    clearInterval(timerInterval);
}

// Initialize theme when DOM is fully loaded
document.addEventListener('DOMContentLoaded', function() {
    if (localStorage.getItem('darkTheme') === 'enabled') {
        document.body.classList.add('dark-theme');
        const themeToggle = document.getElementById('themeToggle');
        if (themeToggle) {
            themeToggle.checked = true;
        }
    }

    const themeToggle = document.getElementById('themeToggle');
    if (themeToggle) {
        themeToggle.addEventListener('change', function() {
            if (this.checked) {
                document.body.classList.add('dark-theme');
                localStorage.setItem('darkTheme', 'enabled');
            } else {
                document.body.classList.remove('dark-theme');
                localStorage.setItem('darkTheme', 'disabled');
            }
            playSound('click');
        });
    }
});

document.querySelectorAll('a[href]:not([href^="#"])').forEach(link => {
    link.addEventListener('click', function(e) {
        if (!this.href.includes(window.location.hostname) && !this.href.startsWith('mailto:')) return;
        
        e.preventDefault();
        loaderOverlay.classList.add('active');
        
        setTimeout(() => {
            window.location.href = this.href;
        }, 150);
    });
});
console.log('Quiz app initialized');
</script>