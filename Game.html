<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberSleuth: Case Files - Contra E-Crime</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/Dccn8pc.png">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=IBM+Plex+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body, html {
            min-height: 100vh;
            font-family: 'Montserrat', sans-serif;
            background-color: #f7f7f7;
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
        }

        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .loader-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #FFF;
            border-bottom-color: transparent;
            border-radius: 50%;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .dark-theme .loader {
            border-color: #d7b15c;
            border-bottom-color: transparent;
        }

        .container {
            display: flex;
            min-height: 100vh;
            flex-direction: column;
        }

        .sidebar {
            width: 290px;
            background-image: url('https://i.imgur.com/bNRxAhZ.png');
            background-size: cover;
            background-position: center;
            background-color: #1a1a1a;
            color: white;
            padding: 20px;
            height: 100vh;
            position: fixed;
            transition: transform 0.3s ease;
        }

        .sidebar h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
        }

        .sidebar ul {
            list-style-type: none;
            padding: 0;
        }

        .sidebar ul li {
            margin: 50px 0;
        }

        .sidebar ul li a {
            color: white;
            text-decoration: none;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar ul li a img {
            width: 30px;
            height: 30px;
        }

        .sidebar ul li a:not(.dark-theme-label a) {
            transition: all 0.3s ease;
            position: relative;
        }

        .sidebar ul li a:not(.dark-theme-label a):hover {
            color: #d7b15c;
            transform: translateX(5px);
        }

        .sidebar ul li a:not(.dark-theme-label a)::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -10px;
            left: 0;
            background-color: #d7b15c;
            transition: width 0.3s ease;
        }

        .sidebar ul li a:not(.dark-theme-label a):hover::after {
            width: 95%;
        }

        .dark-theme .sidebar ul li a:not(.dark-theme-label a):hover {
            color: #d7b15c;
        }

        .dark-theme-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 20px;
        }

        .dark-theme-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
        }

        .dark-theme-label img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }

        .switch-label {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: #28292c;
            border-radius: 25px;
            cursor: pointer;
            border: 3px solid #28292c;
        }

        .checkbox {
            position: absolute;
            display: none;
        }

        .slider {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 25px;
            transition: 0.3s;
        }

        .checkbox:checked ~ .slider {
            background-color: #d8dbe0;
        }

        .slider::before {
            content: "";
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            box-shadow: inset 8px -3px 0px 0px #d8dbe0;
            background-color: #28292c;
            transition: 0.3s;
        }

        .checkbox:checked ~ .slider::before {
            transform: translateX(30px);
            background-color: #28292c;
            box-shadow: none;
        }

        .content {
            flex: 1;
            margin-left: 290px;
            padding: 50px 30px 30px 30px;
            position: relative;
            background: linear-gradient(135deg, #f7f7f7 0%, #e0e0e0 100%);
            transition: background-color 0.3s ease, margin-left 0.3s ease;
        }

        .content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(200, 200, 200, 0.1);
            z-index: 0;
        }

        .header {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .game-section {
            position: relative;
            z-index: 1;
            max-width: 900px;
            margin: 0 auto;
            background: url('https://i.imgur.com/parchment-bg.jpg') no-repeat center/cover;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            padding: 40px;
            font-family: 'IBM Plex Mono', monospace;
            border: 4px solid #8B0000;
        }

        .dark-theme .game-section {
            background: url('https://i.imgur.com/dark-parchment-bg.jpg') no-repeat center/cover;
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1);
        }

        .game-section h1 {
            font-size: 36px;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #8B0000;
            padding-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .dark-theme .game-section h1 {
            color: #d8dbe0;
        }

        .case-file {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .dark-theme .case-file {
            background: rgba(40, 40, 40, 0.9);
            box-shadow: 0 2px 10px rgba(255, 255, 255, 0.1);
        }

        .case-file::before {
            content: 'CONFIDENTIAL';
            position: absolute;
            top: 10px;
            right: -50px;
            transform: rotate(45deg);
            background: #8B0000;
            color: white;
            padding: 5px 60px;
            font-size: 12px;
            font-weight: bold;
            opacity: 0.8;
        }

        .case-file h2 {
            font-size: 24px;
            color: #333;
            margin-bottom: 15px;
            border-left: 4px solid #8B0000;
            padding-left: 10px;
        }

        .dark-theme .case-file h2 {
            color: #d8dbe0;
        }

        .case-file p {
            font-size: 16px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .dark-theme .case-file p {
            color: #b0b0b0;
        }

        .word-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .word-item {
            background: #f9f9f9;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            color: #333;
            transition: all 0.3s ease;
        }

        .word-item.found {
            background: #8B0000;
            color: white;
            text-decoration: line-through;
        }

        .dark-theme .word-item {
            background: #444;
            color: #d8dbe0;
        }

        .dark-theme .word-item.found {
            background: #d7b15c;
            color: #1a1a1a;
        }

        .word-grid {
            display: grid;
            gap: 2px;
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            user-select: none;
        }

        .dark-theme .word-grid {
            background: #333;
            box-shadow: 0 2px 10px rgba(255, 255, 255, 0.1);
        }

        .grid-cell {
            width: 40px;
            height: 40px;
            background: #f9f9f9;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #333;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .dark-theme .grid-cell {
            background: #444;
            color: #d8dbe0;
        }

        .grid-cell:hover {
            background: #8B0000;
            color: white;
            transform: scale(1.1);
        }

        .grid-cell.selected {
            background: #8B0000;
            color: white;
            box-shadow: 0 0 10px rgba(139, 0, 0, 0.5);
        }

        .dark-theme .grid-cell:hover,
        .dark-theme .grid-cell.selected {
            background: #d7b15c;
            color: #1a1a1a;
        }

        .game-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .power-ups {
            display: flex;
            gap: 10px;
        }

        .power-up-btn {
            background: #8B0000;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .power-up-btn:hover {
            background: #580100;
            transform: translateY(-2px);
        }

        .dark-theme .power-up-btn {
            background: #d7b15c;
            color: #1a1a1a;
        }

        .dark-theme .power-up-btn:hover {
            background: #b08d3e;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #f9f9f9;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 20px;
        }

        .progress-fill {
            height: 100%;
            background: #8B0000;
            transition: width 0.5s ease;
        }

        .dark-theme .progress-bar {
            background: #444;
        }

        .dark-theme .progress-fill {
            background: #d7b15c;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            font-size: 16px;
            color: #333;
        }

        .dark-theme .stats {
            color: #d8dbe0;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #fff;
            padding: 30px;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .dark-theme .modal-content {
            background: #333;
            color: #d8dbe0;
        }

        .modal-content h2 {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .modal-content p {
            font-size: 16px;
            margin-bottom: 20px;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #333;
        }

        .dark-theme .close-modal {
            color: #d8dbe0;
        }

        .achievement-list {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .achievement {
            background: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
            width: 150px;
            text-align: center;
        }

        .achievement.unlocked {
            background: #8B0000;
            color: white;
        }

        .dark-theme .achievement {
            background: #444;
            color: #d8dbe0;
        }

        .dark-theme .achievement.unlocked {
            background: #d7b15c;
            color: #1a1a1a;
        }

        footer {
            background-color: #333;
            color: white;
            padding: 15px 30px;
            text-align: center;
            margin-left: 290px;
            z-index: 1;
            transition: margin-left 0.3s ease;
        }

        footer p {
            margin: 0;
            font-size: 14px;
        }

        .footer-links {
            margin-top: 5px;
        }

        .footer-links a {
            color: #d7b15c;
            text-decoration: none;
            margin: 0 10px;
            font-size: 14px;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        .dark-theme footer {
            background-color: #1a1a1a;
        }

        .mobile-nav {
            display: none;
            background-image: url('https://i.imgur.com/bNRxAhZ.png');
            padding: 15px;
            position: fixed;
            width: 100%;
            z-index: 1000;
        }

        .mobile-nav .logo {
            color: white;
            font-size: 20px;
            font-weight: bold;
            text-decoration: none;
        }

        .mobile-nav .menu-icon {
            color: white;
            font-size: 24px;
            cursor: pointer;
            position: absolute;
            right: 15px;
            top: 15px;
        }

        @media (max-width: 1024px) {
            .sidebar {
                width: 250px;
            }

            .sidebar h1 {
                font-size: 22px;
            }

            .sidebar ul li a {
                font-size: 16px;
            }

            .dark-theme-label {
                font-size: 16px;
            }

            .content {
                margin-left: 250px;
            }

            footer {
                margin-left: 250px;
            }

            .game-section h1 {
                font-size: 32px;
            }

            .case-file h2 {
                font-size: 22px;
            }

            .case-file p {
                font-size: 15px;
            }

            .grid-cell {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
                padding: 10px;
            }

            .sidebar h1 {
                font-size: 20px;
            }

            .sidebar ul li a {
                font-size: 14px;
            }

            .dark-theme-label {
                font-size: 14px;
            }

            .content {
                margin-left: 200px;
            }

            footer {
                margin-left: 200px;
            }

            .game-section {
                padding: 30px;
            }

            .grid-cell {
                width: 30px;
                height: 30px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .container {
                flex-direction: column;
            }

            .mobile-nav {
                display: block;
            }

            .sidebar {
                width: 100%;
                height: auto;
                position: fixed;
                padding: 15px;
                transform: translateX(-100%);
                z-index: 999;
                top: 60px;
                height: calc(100vh - 60px);
                overflow-y: auto;
                background-size: cover;
                background-position: center;
                background-color: #1a1a1a;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .sidebar h1 {
                display: none;
            }

            .sidebar ul {
                margin: 0;
            }

            .sidebar ul li {
                margin: 20px 0;
            }

            .sidebar ul li a {
                font-size: 16px;
            }

            .dark-theme-container {
                margin-top: 20px;
                margin-bottom: 15px;
            }

            .dark-theme-label {
                font-size: 16px;
            }

            .content {
                margin-left: 0;
            }

            footer {
                margin-left: 0;
                padding: 10px 20px;
                text-align: center;
            }

            footer p {
                font-size: 12px;
            }

            .footer-links a {
                font-size: 12px;
                margin: 0 8px;
            }

            .header {
                justify-content: center;
            }

            .game-section {
                padding: 20px;
            }

            .game-section h1 {
                font-size: 28px;
            }

            .case-file h2 {
                font-size: 20px;
            }

            .case-file p {
                font-size: 14px;
            }

            .grid-cell {
                width: 25px;
                height: 25px;
                font-size: 12px;
            }

            .power-up-btn {
                padding: 8px 15px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="loader-overlay" id="loaderOverlay">
        <div class="loader"></div>
    </div>
    <div class="mobile-nav">
        <a href="HomePage.html" class="logo">Contra E-Crime</a>
        <div class="menu-icon" id="mobileMenuIcon">
            <i class="fas fa-bars"></i>
        </div>
    </div>

    <div class="container">
        <nav class="sidebar" id="sidebar">
            <h1>Contra E-Crime</h1>
            <ul>
                <li>
                    <a href="HomePage.html">
                        <img src="https://i.imgur.com/OAHusQp.png" alt="Home">
                        Home
                    </a>
                </li>
                <li>
                    <a href="News.html" target="_self" onclick="return true;">
                        <img src="https://i.imgur.com/FNALwXX.png" alt="News & Insights">
                        News & Insights
                    </a>
                </li>
                <li>
                    <a href="SavedLaws.html">
                        <img src="https://i.imgur.com/VChoqhD.png" alt="Saved Laws">
                        Saved Laws
                    </a>
                </li>
                <li>
                    <a href="History.html">
                        <img src="https://i.imgur.com/cnaDfEq.png" alt="Search History">
                        Search History
                    </a>
                </li>
                <li>
                    <a href="ContactUs.html">
                        <img src="https://i.imgur.com/T7bI4RJ.png" alt="Contact Us">
                        Contact Us
                    </a>
                </li>
                <li>
                    <a href="AboutUs.html">
                        <img src="https://i.imgur.com/lktrzpa.png" alt="About Us">
                        About Us
                    </a>
                </li>
                <li>
                    <a href="index.html">
                        <img src="https://i.imgur.com/2jjsgOq.png" alt="Logout">
                        Logout
                    </a>
                </li>
            </ul>

            <div class="dark-theme-container">
                <div class="dark-theme-label">
                    <img src="https://i.imgur.com/vEKpOsq.png" alt="Dark Theme">
                    <span>Dark Theme</span>
                </div>
                <div class="toggle-switch">
                    <label class="switch-label">
                        <input type="checkbox" class="checkbox" id="themeToggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </nav>
        <main class="content">
            <div class="header">
            </div>
            <section class="game-section">
                <h1>CyberSleuth: Case Files</h1>
                <div class="case-file" id="caseFile">
                    <h2>Case #001: The Phantom Hacker</h2>
                    <p id="scenarioText">A hacker infiltrated a bank’s database, committing unauthorized access and data breach. Investigate the scene to uncover evidence of hacking and fraud.</p>
                    <div class="word-list" id="wordList"></div>
                </div>
                <div class="word-grid" id="wordGrid"></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                </div>
                <div class="stats">
                    <span>Level: <span id="levelDisplay">1</span></span>
                    <span>Score: <span id="scoreDisplay">0</span></span>
                    <span>Coins: <span id="coinDisplay">0</span></span>
                    <span>Time: <span id="timeDisplay">0:00</span></span>
                </div>
                <div class="game-controls">
                    <div class="power-ups">
                        <button class="power-up-btn" id="magnifierBtn">Magnifier (50)</button>
                        <button class="power-up-btn" id="caseNotesBtn">Case Notes (100)</button>
                        <button class="power-up-btn" id="shuffleBtn">Shuffle Evidence (30)</button>
                    </div>
                    <button class="power-up-btn" id="settingsBtn">Settings</button>
                </div>
            </section>
        </main>

        <div class="modal" id="levelCompleteModal">
            <div class="modal-content">
                <span class="close-modal" id="closeLevelModal">&times;</span>
                <h2>Case Closed!</h2>
                <p id="levelCompleteMessage"></p>
                <button class="power-up-btn" id="nextLevelBtn">Next Case</button>
            </div>
        </div>

        <div class="modal" id="achievementsModal">
            <div class="modal-content">
                <span class="close-modal" id="closeAchievementsModal">&times;</span>
                <h2>Achievements</h2>
                <div class="achievement-list" id="achievementList"></div>
            </div>
        </div>

        <div class="modal" id="settingsModal">
            <div class="modal-content">
                <span class="close-modal" id="closeSettingsModal">&times;</span>
                <h2>Settings</h2>
                <p>
                    Sound: <input type="checkbox" id="soundToggle" checked>
                    <br>
                    Music: <input type="checkbox" id="musicToggle" checked>
                    <br>
                    Difficulty: 
                    <select id="difficultySelect">
                        <option value="beginner">Beginner</option>
                        <option value="intermediate">Intermediate</option>
                        <option value="advanced">Advanced</option>
                        <option value="expert">Expert</option>
                    </select>
                </p>
                <button class="power-up-btn" id="saveSettingsBtn">Save</button>
                <button class="power-up-btn" id="viewAchievementsBtn">View Achievements</button>
            </div>
        </div>

        <footer>
            <p>© 2025 Contra E-Crime. All rights reserved.</p>
            <div class="footer-links">
                <a href="PrivacyPolicy.html">Privacy Policy</a>
                <a href="TermsOfUse.html">Terms of Use</a>
                <a href="ContactUs.html">Contact Us</a>
            </div>
        </footer>
    </div>

    <audio id="bgMusic" loop>
        <source src="detective-jazz.mp3" type="audio/mpeg">
    </audio>
    <audio id="wordFoundSound">
        <source src="typewriter.mp3" type="audio/mpeg">
    </audio>
    <audio id="levelCompleteSound">
        <source src="camera-shutter.mp3" type="audio/mpeg">
    </audio>
    <audio id="incorrectSound">
        <source src="siren.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Core game data from provided cardsData
        const cardsData = [
            { term: "Cybercrime", partOfSpeech: "noun", definition: "Criminal activities carried out by means of computers or the internet, such as hacking, phishing, or identity theft.", example: "The Cybercrime Prevention Act of 2012 addresses various forms of cybercrime, including unauthorized access to computer systems.", synonyms: "digital crime, internet crime, online fraud" },
            { term: "Hacking", partOfSpeech: "noun", definition: "The act of gaining unauthorized access to computer systems or networks to steal, alter, or destroy data.", example: "Hacking is penalized under the Electronic Commerce Act of 2000 for unauthorized access to electronic transactions.", synonyms: "unauthorized access, cyber intrusion, data breach" },
            { term: "Phishing", partOfSpeech: "noun", definition: "A fraudulent attempt to obtain sensitive information by disguising as a trustworthy entity in electronic communication.", example: "The NBI Cybercrime Division raided a group operating a phishing scam using fake banking websites.", synonyms: "online scam, identity theft, social engineering" },
            { term: "Fraud", partOfSpeech: "noun", definition: "Wrongful deception intended to result in financial or personal gain, often conducted online or through electronic means.", example: "The Anti-Financial Account Scamming Act penalizes fraud involving fake bank accounts for online scams.", synonyms: "deception, scam, swindle" },
            { term: "Identity Theft", partOfSpeech: "noun", definition: "The deliberate use of someone else's identity, typically to gain financial advantage or obtain credit.", example: "The Access Devices Regulation Act criminalizes the use of stolen credit card information for identity theft.", synonyms: "impersonation, identity fraud, personal data theft" },
            { term: "Data Breach", partOfSpeech: "noun", definition: "An incident where sensitive or confidential data is accessed or disclosed without authorization.", example: "The Data Privacy Act of 2012 imposes penalties for data breaches involving unauthorized access to personal information.", synonyms: "security breach, information leak, data exposure" },
            { term: "Child Pornography", partOfSpeech: "noun", definition: "Illegal material depicting minors in sexual acts, often distributed online.", example: "The Anti-Child Pornography Act of 2009 criminalizes the production and distribution of child pornography.", synonyms: "child exploitation material, illegal content, explicit media" },
            { term: "Money Laundering", partOfSpeech: "noun", definition: "The process of concealing the origins of illegally obtained money, often through financial transactions.", example: "The Anti-Money Laundering Act of 2001 aims to prevent the financial system from being used for laundering drug money.", synonyms: "financial crime, illicit funds, money washing" },
            { term: "Cyber-Squatting", partOfSpeech: "noun", definition: "Registering or using a domain name with bad faith intent to profit from the goodwill of a trademark belonging to someone else.", example: "Cyber-squatting is penalized under the Cybercrime Prevention Act of 2012 for misusing domain names.", synonyms: "domain hijacking, trademark abuse, online squatting" },
            { term: "Unauthorized Access", partOfSpeech: "noun", definition: "Gaining entry to a computer system or network without permission.", example: "Unauthorized access to customer data is punishable under the Data Privacy Act of 2012.", synonyms: "illegal entry, system breach, hacking" },
            { term: "Electronic Transaction", partOfSpeech: "noun", definition: "A transaction conducted through electronic means, such as online payments or digital contracts.", example: "The Electronic Commerce Act of 2000 regulates electronic transactions to prevent fraud.", synonyms: "digital transaction, e-commerce, online exchange" },
            { term: "Credit Card Skimming", partOfSpeech: "noun", definition: "The theft of credit card information using illegal devices attached to card readers.", example: "Credit card skimming at ATMs is addressed under the Access Devices Regulation Act of 1998.", synonyms: "card fraud, data theft, skimming scam" },
            { term: "Money Muling", partOfSpeech: "noun", definition: "The act of using individuals to transfer illegally obtained money, often through fake accounts.", example: "Money muling is penalized under the Anti-Financial Account Scamming Act with imprisonment.", synonyms: "financial mule, illicit transfer, scam facilitator" },
            { term: "Social Engineering", partOfSpeech: "noun", definition: "Manipulating individuals into divulging confidential information, often used in cyber scams.", example: "Social engineering schemes are heavily penalized under the Anti-Financial Account Scamming Act.", synonyms: "human hacking, manipulation scam, deception tactic" },
            { term: "Economic Sabotage", partOfSpeech: "noun", definition: "Large-scale financial crimes that undermine the economy, often linked to terrorism or fraud.", example: "Economic sabotage under the Anti-Financial Account Scamming Act can lead to life imprisonment.", synonyms: "financial sabotage, economic crime, systemic fraud" },
            { term: "Cybersex", partOfSpeech: "noun", definition: "Engaging in sexual activities through digital platforms, often illegally involving exploitation.", example: "Cybersex crimes are addressed under the Cybercrime Prevention Act with severe penalties.", synonyms: "online sexual exploitation, digital sex crime, virtual abuse" },
            { term: "Data Interference", partOfSpeech: "noun", definition: "The intentional alteration, deletion, or corruption of computer data without authorization.", example: "Data interference is a punishable offense under the Cybercrime Prevention Act of 2012.", synonyms: "data tampering, information corruption, system disruption" },
            { term: "System Interference", partOfSpeech: "noun", definition: "Disrupting the normal operation of a computer system, often through malware or attacks.", example: "System interference is criminalized under the Cybercrime Prevention Act to protect infrastructure.", synonyms: "cyber disruption, system sabotage, network interference" },
            { term: "Misuse of Devices", partOfSpeech: "noun", definition: "Using tools or software to commit cybercrimes, such as hacking tools or malware.", example: "Misuse of devices carries heavy fines under the Cybercrime Prevention Act of 2012.", synonyms: "device abuse, illegal software use, cyber tool misuse" },
            { term: "Computer-Related Forgery", partOfSpeech: "noun", definition: "Creating or altering digital data to deceive others, often for fraudulent purposes.", example: "Computer-related forgery is penalized under the Cybercrime Prevention Act for digital fraud.", synonyms: "digital forgery, electronic fraud, data falsification" },
            { term: "Voyeurism", partOfSpeech: "noun", definition: "The act of secretly observing or recording someone in a private setting, often for sexual purposes.", example: "The Anti-Photo and Video Voyeurism Act of 2009 penalizes voyeurism involving unauthorized recordings.", synonyms: "peeping, privacy violation, secret recording" },
            { term: "Human Trafficking", partOfSpeech: "noun", definition: "The illegal trade of humans for exploitation, often involving coercion or deception.", example: "The Expanded Anti-Trafficking in Persons Act addresses trafficking for prostitution or labor.", synonyms: "modern slavery, forced labor, exploitation trade" },
            { term: "SIM Spoofing", partOfSpeech: "noun", definition: "Impersonating a legitimate SIM card to send misleading messages or commit fraud.", example: "SIM spoofing is penalized under the Subscriber Identity Module Registration Act.", synonyms: "SIM fraud, mobile impersonation, telecom scam" },
            { term: "Online Sexual Abuse", partOfSpeech: "noun", definition: "Exploiting individuals, often minors, through digital platforms for sexual purposes.", example: "The Anti-Online Sexual Abuse or Exploitation of Children Act protects minors from online abuse.", synonyms: "digital exploitation, cyber abuse, online predation" },
            { term: "Grooming", partOfSpeech: "noun", definition: "Building a relationship with a child to manipulate them into sexual activity, often online.", example: "Grooming is heavily penalized under the Anti-Online Sexual Abuse or Exploitation of Children Act.", synonyms: "online enticement, child manipulation, predator behavior" },
            { term: "Intellectual Property", partOfSpeech: "noun", definition: "Creations of the mind, such as inventions, designs, or artistic works, protected by law.", example: "The Intellectual Property Code of the Philippines protects copyrights and trademarks.", synonyms: "IP rights, creative ownership, patent protection" },
            { term: "Terrorism Financing", partOfSpeech: "noun", definition: "Providing or collecting funds to support terrorist activities or organizations.", example: "The Terrorism Financing Prevention and Suppression Act criminalizes funding terrorist groups.", synonyms: "terror funding, illicit financing, terrorism support" },
            { term: "Asset Freezing", partOfSpeech: "noun", definition: "The legal process of restricting access to financial assets to prevent illegal use.", example: "Asset freezing is a provision under the Anti-Money Laundering Act to stop illicit transactions.", synonyms: "fund seizure, financial restriction, property lockdown" },
            { term: "Phishing Attack", partOfSpeech: "noun", definition: "A targeted attempt to steal sensitive information through fraudulent emails or messages.", example: "A phishing attack on a government agency is addressed by the National Cybersecurity Inter-Agency Committee.", synonyms: "email scam, fraudulent message, cyber baiting" },
            { term: "Number Portability", partOfSpeech: "noun", definition: "The ability to retain a mobile number when switching service providers.", example: "The Mobile Number Portability Act allows consumers to switch providers without losing their number.", synonyms: "mobile portability, number retention, telecom switching" },
            { term: "Gender-Based Harassment", partOfSpeech: "noun", definition: "Unwanted behavior targeting someone based on their gender, often in public or online spaces.", example: "The Safe Spaces Act penalizes gender-based harassment in online group chats.", synonyms: "sexual harassment, gender discrimination, online abuse" },
            { term: "Wiretapping", partOfSpeech: "noun", definition: "The act of secretly intercepting or recording private communications without consent.", example: "The Anti-Wire Tapping Act prohibits unauthorized wiretapping of business meetings.", synonyms: "eavesdropping, illegal interception, communication breach" },
            { term: "Terrorism", partOfSpeech: "noun", definition: "The use of violence or threats to intimidate a population or government for political purposes.", example: "The Anti-Terrorism Act of 2020 penalizes acts of terrorism like bomb threats.", synonyms: "violent extremism, terror act, political violence" },
            { term: "Bullying", partOfSpeech: "noun", definition: "Repeated aggressive behavior intended to harm or intimidate someone, often in schools.", example: "The Anti-Bullying Act of 2013 addresses bullying in schools, such as teasing over penmanship.", synonyms: "harassment, intimidation, peer abuse" },
            { term: "Cybersecurity", partOfSpeech: "noun", definition: "Measures taken to protect computer systems and networks from cyber threats.", example: "The Department of Information and Communications Technology Act strengthens cybersecurity policies.", synonyms: "digital security, online protection, cyber defense" },
            { term: "Strategic Goods", partOfSpeech: "noun", definition: "Items that can be used for both civilian and military purposes, regulated to prevent misuse.", example: "The Strategic Trade Management Act regulates the export of strategic goods like computer chips.", synonyms: "dual-use goods, controlled items, sensitive technology" },
            { term: "Consumer Protection", partOfSpeech: "noun", definition: "Laws and regulations designed to safeguard consumers from unfair practices.", example: "The Consumer Act of the Philippines protects consumers from defective products.", synonyms: "buyer rights, consumer safety, fair trade" },
            { term: "Piracy", partOfSpeech: "noun", definition: "The unauthorized reproduction or distribution of copyrighted material, such as movies or music.", example: "The Optical Media Act of 2003 penalizes piracy of DVDs and Blu-rays.", synonyms: "copyright infringement, illegal copying, content theft" },
            { term: "Operational Risk", partOfSpeech: "noun", definition: "The risk of loss due to inadequate processes, systems, or human error.", example: "The Guidelines on Operational Risk Management address risks like accidental data leaks.", synonyms: "process risk, system failure, human error risk" },
            { term: "Business Continuity", partOfSpeech: "noun", definition: "Planning to ensure critical operations continue during disruptions like natural disasters.", example: "The Guidelines on Business Continuity Management ensure banks operate during crises.", synonyms: "disaster recovery, operational resilience, continuity planning" },
            { term: "Outsourcing Risk", partOfSpeech: "noun", definition: "Risks associated with delegating operations to third-party providers, such as security breaches.", example: "The Guidelines on Outsourcing Risk Management ensure secure outsourcing of customer support.", synonyms: "vendor risk, third-party risk, delegation risk" },
            { term: "Critical Infrastructure", partOfSpeech: "noun", definition: "Essential systems like telecommunications or banking that, if disrupted, impact society.", example: "The Adoption of PNS ISO/IEC 27002 protects critical information infrastructure.", synonyms: "essential systems, vital infrastructure, key networks" },
            { term: "Cloud Computing", partOfSpeech: "noun", definition: "The delivery of computing services over the internet, including storage and processing.", example: "The Cloud First Policy mandates government agencies to prioritize cloud solutions.", synonyms: "cloud services, online computing, virtual infrastructure" },
            { term: "Value-Added Services", partOfSpeech: "noun", definition: "Enhanced telecommunications services beyond basic offerings, like messaging or VoIP.", example: "The Value-Added Services Regulation governs services like VoIP calls.", synonyms: "enhanced services, telecom extras, digital add-ons" },
            { term: "Broadcast Messaging", partOfSpeech: "noun", definition: "Sending promotional or informational messages to a large group of subscribers.", example: "The Broadcast Messaging Regulation requires opt-in consent for promotional texts.", synonyms: "mass messaging, push notifications, bulk SMS" },
            { term: "Prepaid Load", partOfSpeech: "noun", definition: "A monetary amount added to a mobile account for services like calls or data.", example: "The Guidelines on Prepaid Load Expiry set a one-year validity for prepaid loads.", synonyms: "mobile credit, top-up balance, prepaid funds" },
            { term: "Deep Fake", partOfSpeech: "noun", definition: "AI-generated media that falsely depicts a person, often used to spread disinformation.", example: "The Social Media and AI Election Guidelines penalize the use of deep fakes in campaigns.", synonyms: "AI forgery, synthetic media, fake video" },
            { term: "Online Pharmacy", partOfSpeech: "noun", definition: "A digital platform selling pharmaceutical products, regulated for safety and legality.", example: "The Online Pharmaceutical Sales Regulation ensures safe distribution of medicines online.", synonyms: "e-pharmacy, digital drugstore, virtual pharmacy" },
            { term: "E-Commerce", partOfSpeech: "noun", definition: "The buying and selling of goods and services over the internet.", example: "The E-Commerce Protection Guidelines ensure fair practices in online shopping.", synonyms: "online trade, digital commerce, internet shopping" },
            { term: "Cybercrime Warrant", partOfSpeech: "noun", definition: "A legal authorization to search, seize, or disclose computer data in cybercrime investigations.", example: "The Rules on Cybercrime Warrants allow law enforcement to obtain data in fraud cases.", synonyms: "digital warrant, cyber search order, data seizure warrant" },
            { term: "Electronic Evidence", partOfSpeech: "noun", definition: "Digital information, such as emails or documents, admissible in court if authenticated.", example: "The Rules on Electronic Evidence allow emails to be used as evidence in trials.", synonyms: "digital evidence, e-evidence, online proof" }
        ];

        // Game state
        let currentLevel = 1;
        let score = 0;
        let coins = 0;
        let timeElapsed = 0;
        let wordsToFind = [];
        let foundWords = [];
        let grid = [];
        let gridSize = 8;
        let selectedCells = [];
        let isSelecting = false;
        let timerInterval = null;
        let achievements = [
            { id: 'rookie', name: 'Rookie Sleuth', description: 'Find 10 words', condition: () => foundWords.length >= 10, unlocked: false },
            { id: 'detective', name: 'Cyber Detective', description: 'Complete 5 levels', condition: () => currentLevel > 5, unlocked: false },
            { id: 'master', name: 'Master Sleuth', description: 'Earn 1000 points', condition: () => score >= 1000, unlocked: false },
            { id: 'coin', name: 'Coin Collector', description: 'Earn 500 coins', condition: () => coins >= 500, unlocked: false }
        ];
        let settings = {
            sound: true,
            music: true,
            difficulty: 'beginner'
        };

        // DOM elements
        const caseFile = document.getElementById('caseFile');
        const scenarioText = document.getElementById('scenarioText');
        const wordList = document.getElementById('wordList');
        const wordGrid = document.getElementById('wordGrid');
        const progressFill = document.getElementById('progressFill');
        const levelDisplay = document.getElementById('levelDisplay');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const coinDisplay = document.getElementById('coinDisplay');
        const timeDisplay = document.getElementById('timeDisplay');
        const magnifierBtn = document.getElementById('magnifierBtn');
        const caseNotesBtn = document.getElementById('caseNotesBtn');
        const shuffleBtn = document.getElementById('shuffleBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const levelCompleteModal = document.getElementById('levelCompleteModal');
        const levelCompleteMessage = document.getElementById('levelCompleteMessage');
        const nextLevelBtn = document.getElementById('nextLevelBtn');
        const closeLevelModal = document.getElementById('closeLevelModal');
        const achievementsModal = document.getElementById('achievementsModal');
        const achievementList = document.getElementById('achievementList');
        const closeAchievementsModal = document.getElementById('closeAchievementsModal');
        const settingsModal = document.getElementById('settingsModal');
        const soundToggle = document.getElementById('soundToggle');
        const musicToggle = document.getElementById('musicToggle');
        const difficultySelect = document.getElementById('difficultySelect');
        const saveSettingsBtn = document.getElementById('saveSettingsBtn');
        const viewAchievementsBtn = document.getElementById('viewAchievementsBtn');
        const closeSettingsModal = document.getElementById('closeSettingsModal');
        const bgMusic = document.getElementById('bgMusic');
        const wordFoundSound = document.getElementById('wordFoundSound');
        const levelCompleteSound = document.getElementById('levelCompleteSound');
        const incorrectSound = document.getElementById('incorrectSound');

        // Scenario templates
        const scenarioTemplates = [
            { template: "Suspect committed {term1} by targeting {entity}. Evidence suggests {term2} was also involved.", entities: ['a bank', 'a government agency', 'an online retailer'] },
            { template: "A {term1} operation was uncovered, linked to {term2} and {entity}.", entities: ['organized crime', 'a phishing ring', 'a dark web marketplace'] },
            { template: "The case involves {term1}, with traces of {term2} found at {entity}.", entities: ['a corporate network', 'a social media platform', 'a cloud server'] },
            { template: "{entity} was hit by {term1}, leading to {term2} and significant losses.", entities: ['a hospital', 'a telecom provider', 'a financial institution'] },
            { template: "Investigation revealed {term1} and {term2} in an attack on {entity}.", entities: ['a school', 'a gaming platform', 'a cryptocurrency exchange'] }
        ];

        // Initialize game
        function initGame() {
            loadSettings();
            loadProgress();
            if (settings.music) bgMusic.play();
            generateLevel();
            setupEventListeners();
            startTimer();
            updateAchievements();
        }

        // Load settings from local storage
        function loadSettings() {
            const savedSettings = localStorage.getItem('gameSettings');
            if (savedSettings) {
                settings = JSON.parse(savedSettings);
                soundToggle.checked = settings.sound;
                musicToggle.checked = settings.music;
                difficultySelect.value = settings.difficulty;
            }
        }

        // Save settings to local storage
        function saveSettings() {
            settings.sound = soundToggle.checked;
            settings.music = musicToggle.checked;
            settings.difficulty = difficultySelect.value;
            localStorage.setItem('gameSettings', JSON.stringify(settings));
            if (settings.music) {
                bgMusic.play();
            } else {
                bgMusic.pause();
            }
        }

        // Load progress from local storage
        function loadProgress() {
            const savedProgress = localStorage.getItem('gameProgress');
            if (savedProgress) {
                const progress = JSON.parse(savedProgress);
                currentLevel = progress.level || 1;
                score = progress.score || 0;
                coins = progress.coins || 0;
                achievements = progress.achievements || achievements;
            }
            updateStats();
        }

        // Save progress to local storage
        function saveProgress() {
            const progress = {
                level: currentLevel,
                score: score,
                coins: coins,
                achievements: achievements
            };
            localStorage.setItem('gameProgress', JSON.stringify(progress));
        }

        // Generate a new level
        function generateLevel() {
            // Determine grid size and word count based on level and difficulty
            if (settings.difficulty === 'beginner' || currentLevel <= 20) {
                gridSize = 8;
                wordsToFind = selectWords(4 + Math.floor(currentLevel / 5));
            } else if (settings.difficulty === 'intermediate' || currentLevel <= 50) {
                gridSize = 12;
                wordsToFind = selectWords(7 + Math.floor(currentLevel / 10));
            } else if (settings.difficulty === 'advanced' || currentLevel <= 80) {
                gridSize = 16;
                wordsToFind = selectWords(11 + Math.floor(currentLevel / 15));
            } else {
                gridSize = 20;
                wordsToFind = selectWords(16 + Math.floor(currentLevel / 20));
            }

            foundWords = [];
            selectedCells = [];
            generateScenario();
            generateGrid();
            renderGrid();
            renderWordList();
            updateProgress();
            updateStats();
            animateCaseFile();
        }

        // Select random words from cardsData or API
        async function selectWords(count) {
            let selectedWords = [];
            const usedIndices = new Set();

            // Try fetching synonyms from WordsAPI
            try {
                const response = await fetch('https://wordsapiv1.p.rapidapi.com/words/cybercrime/synonyms', {
                    method: 'GET',
                    headers: {
                        'X-RapidAPI-Key': 'YOUR_RAPIDAPI_KEY',
                        'X-RapidAPI-Host': 'wordsapiv1.p.rapidapi.com'
                    }
                });
                const data = await response.json();
                if (data.synonyms && data.synonyms.length > 0) {
                    const apiWords = data.synonyms.filter(word => word.length >= 3 && word.length <= gridSize).slice(0, Math.floor(count / 2));
                    selectedWords.push(...apiWords.map(word => word.toUpperCase()));
                }
            } catch (error) {
                console.error('WordsAPI error:', error);
            }

            // Fill remaining words from cardsData
            while (selectedWords.length < count && usedIndices.size < cardsData.length) {
                const index = Math.floor(Math.random() * cardsData.length);
                if (!usedIndices.has(index)) {
                    const term = cardsData[index].term.toUpperCase().replace(/ /g, '');
                    if (term.length >= 3 && term.length <= gridSize) {
                        selectedWords.push(term);
                        usedIndices.add(index);
                    }
                }
            }

            // If not enough words, use synonyms from cardsData
            while (selectedWords.length < count) {
                const card = cardsData[Math.floor(Math.random() * cardsData.length)];
                const synonyms = card.synonyms.split(', ').map(s => s.toUpperCase().replace(/ /g, ''));
                const validSynonyms = synonyms.filter(s => s.length >= 3 && s.length <= gridSize && !selectedWords.includes(s));
                if (validSynonyms.length > 0) {
                    selectedWords.push(validSynonyms[0]);
                }
            }

            return selectedWords.slice(0, count);
        }

        // Generate scenario based on selected words
        function generateScenario() {
            const template = scenarioTemplates[Math.floor(Math.random() * scenarioTemplates.length)];
            const entity = template.entities[Math.floor(Math.random() * template.entities.length)];
            let scenario = template.template;
            const word1 = wordsToFind[Math.floor(Math.random() * wordsToFind.length)];
            let word2 = wordsToFind[Math.floor(Math.random() * wordsToFind.length)];
            while (word2 === word1 && wordsToFind.length > 1) {
                word2 = wordsToFind[Math.floor(Math.random() * wordsToFind.length)];
            }
            scenario = scenario.replace('{term1}', word1.toLowerCase()).replace('{term2}', word2.toLowerCase()).replace('{entity}', entity);
            scenarioText.textContent = scenario;
            caseFile.querySelector('h2').textContent = `Case #${String(currentLevel).padStart(3, '0')}: ${getCaseTitle()}`;
        }

        // Generate a thematic case title
        function getCaseTitle() {
            const titles = [
                'The Phantom Hacker', 'The Digital Deceiver', 'The Shadow Scammer', 'The Cyber Con', 'The Data Heist',
                'The Phishing Plot', 'The Identity Ruse', 'The Malware Mystery', 'The Fraud File', 'The Encryption Enigma'
            ];
            return titles[Math.floor(Math.random() * titles.length)];
        }

        // Generate word search grid
        function generateGrid() {
            grid = Array(gridSize).fill().map(() => Array(gridSize).fill(''));
            
            // Place words in the grid
            wordsToFind.forEach(word => {
                let placed = false;
                let attempts = 0;
                while (!placed && attempts < 100) {
                    const direction = Math.floor(Math.random() * 8); // 0: right, 1: down, 2: left, 3: up, 4: diag-down-right, 5: diag-down-left, 6: diag-up-right, 7: diag-up-left
                    const row = Math.floor(Math.random() * gridSize);
                    const col = Math.floor(Math.random() * gridSize);
                    if (canPlaceWord(word, row, col, direction)) {
                        placeWord(word, row, col, direction);
                        placed = true;
                    }
                    attempts++;
                }
            });

            // Fill remaining cells with random letters
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    if (grid[i][j] === '') {
                        grid[i][j] = String.fromCharCode(65 + Math.floor(Math.random() * 26));
                    }
                }
            }
        }

        // Check if a word can be placed
        function canPlaceWord(word, row, col, direction) {
            const len = word.length;
            let r = row, c = col;

            for (let i = 0; i < len; i++) {
                if (r < 0 || r >= gridSize || c < 0 || c >= gridSize) return false;
                if (grid[r][c] !== '' && grid[r][c] !== word[i]) return false;
                switch (direction) {
                    case 0: c++; break; // right
                    case 1: r++; break; // down
                    case 2: c--; break; // left
                    case 3: r--; break; // up
                    case 4: r++; c++; break; // diag-down-right
                    case 5: r++; c--; break; // diag-down-left
                    case 6: r--; c++; break; // diag-up-right
                    case 7: r--; c--; break; // diag-up-left
                }
            }
            return true;
        }

        // Place a word in the grid
        function placeWord(word, row, col, direction) {
            let r = row, c = col;
            for (let i = 0; i < word.length; i++) {
                grid[r][c] = word[i];
                switch (direction) {
                    case 0: c++; break;
                    case 1: r++; break;
                    case 2: c--; break;
                    case 3: r--; break;
                    case 4: r++; c++; break;
                    case 5: r++; c--; break;
                    case 6: r--; c++; break;
                    case 7: r--; c--; break;
                }
            }
        }

        // Render the word grid
        function renderGrid() {
            wordGrid.innerHTML = '';
            wordGrid.style.gridTemplateColumns = `repeat(${gridSize}, 40px)`;
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    const cell = document.createElement('div');
                    cell.classList.add('grid-cell');
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    cell.textContent = grid[i][j];
                    wordGrid.appendChild(cell);
                }
            }
            animateGrid();
        }

        // Render the word list
        function renderWordList() {
            wordList.innerHTML = '';
            wordsToFind.forEach(word => {
                const wordItem = document.createElement('div');
                wordItem.classList.add('word-item');
                wordItem.textContent = word;
                if (foundWords.includes(word)) {
                    wordItem.classList.add('found');
                }
                wordList.appendChild(wordItem);
            });
        }

        // Update progress bar
        function updateProgress() {
            const progress = (foundWords.length / wordsToFind.length) * 100;
            progressFill.style.width = `${progress}%`;
        }

        // Update stats display
        function updateStats() {
            levelDisplay.textContent = currentLevel;
            scoreDisplay.textContent = score;
            coinDisplay.textContent = coins;
            timeDisplay.textContent = formatTime(timeElapsed);
            saveProgress();
        }

        // Format time as MM:SS
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Start timer
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeElapsed++;
                updateStats();
            }, 1000);
        }

        // Setup event listeners
        function setupEventListeners() {
            // Grid interaction
            wordGrid.addEventListener('mousedown', startSelection);
            wordGrid.addEventListener('mousemove', continueSelection);
            wordGrid.addEventListener('mouseup', endSelection);
            wordGrid.addEventListener('touchstart', startSelection);
            wordGrid.addEventListener('touchmove', continueSelection);
            wordGrid.addEventListener('touchend', endSelection);

            // Power-ups
            magnifierBtn.addEventListener('click', useMagnifier);
            caseNotesBtn.addEventListener('click', useCaseNotes);
            shuffleBtn.addEventListener('click', useShuffle);

            // Modals
            nextLevelBtn.addEventListener('click', () => {
                levelCompleteModal.style.display = 'none';
                currentLevel++;
                timeElapsed = 0;
                generateLevel();
            });
            closeLevelModal.addEventListener('click', () => {
                levelCompleteModal.style.display = 'none';
            });
            settingsBtn.addEventListener('click', () => {
                settingsModal.style.display = 'flex';
                GSAP.to(settingsModal, { opacity: 1, y: 0, duration: 0.5 });
            });
            closeSettingsModal.addEventListener('click', () => {
                settingsModal.style.display = 'none';
            });
            saveSettingsBtn.addEventListener('click', () => {
                saveSettings();
                settingsModal.style.display = 'none';
            });
            viewAchievementsBtn.addEventListener('click', () => {
                settingsModal.style.display = 'none';
                achievementsModal.style.display = 'flex';
                renderAchievements();
                GSAP.to(achievementsModal, { opacity: 1, y: 0, duration: 0.5 });
            });
            closeAchievementsModal.addEventListener('click', () => {
                achievementsModal.style.display = 'none';
            });
        }

        // Start word selection
        function startSelection(event) {
            event.preventDefault();
            isSelecting = true;
            const cell = event.target.closest('.grid-cell');
            if (cell) {
                selectedCells = [{ row: parseInt(cell.dataset.row), col: parseInt(cell.dataset.col) }];
                cell.classList.add('selected');
            }
        }

        // Continue word selection
        function continueSelection(event) {
            if (!isSelecting) return;
            event.preventDefault();
            const cell = event.target.closest('.grid-cell');
            if (cell) {
                const row = parseInt(cell.dataset.row);
                const col = parseInt(cell.dataset.col);
                const lastCell = selectedCells[selectedCells.length - 1];
                if (isAdjacent(lastCell, { row, col }) && !selectedCells.some(c => c.row === row && c.col === col)) {
                    selectedCells.push({ row, col });
                    cell.classList.add('selected');
                }
            }
        }

        // End word selection
        function endSelection() {
            if (!isSelecting) return;
            isSelecting = false;
            const selectedWord = selectedCells.map(cell => grid[cell.row][cell.col]).join('');
            if (wordsToFind.includes(selectedWord) && !foundWords.includes(selectedWord)) {
                foundWords.push(selectedWord);
                score += 100;
                coins += 10;
                if (settings.sound) wordFoundSound.play();
                renderWordList();
                updateProgress();
                updateStats();
                animateWordFound(selectedCells);
                checkLevelComplete();
            } else if (selectedWord.length > 1) {
                score = Math.max(0, score - 20);
                if (settings.sound) incorrectSound.play();
                updateStats();
            }
            selectedCells.forEach(cell => {
                const cellElement = wordGrid.querySelector(`.grid-cell[data-row="${cell.row}"][data-col="${cell.col}"]`);
                if (cellElement) cellElement.classList.remove('selected');
            });
            selectedCells = [];
        }

        // Check if cells are adjacent
        function isAdjacent(cell1, cell2) {
            const dr = Math.abs(cell1.row - cell2.row);
            const dc = Math.abs(cell1.col - cell2.col);
            return dr <= 1 && dc <= 1 && !(dr === 0 && dc === 0);
        }

        // Check if level is complete
        function checkLevelComplete() {
            if (foundWords.length === wordsToFind.length) {
                clearInterval(timerInterval);
                score += Math.max(0, 500 - timeElapsed * 10); // Time bonus
                coins += 50 + currentLevel * 5;
                if (settings.sound) levelCompleteSound.play();
                levelCompleteMessage.textContent = `Case #${String(currentLevel).padStart(3, '0')} solved! Score: ${score}, Coins: ${coins}`;
                levelCompleteModal.style.display = 'flex';
                GSAP.to(levelCompleteModal, { opacity: 1, y: 0, duration: 0.5 });
                updateAchievements();
                saveProgress();
            }
        }

        // Use Magnifier power-up
        function useMagnifier() {
            if (coins < 50) {
                alert('Not enough coins!');
                return;
            }
            coins -= 50;
            const remainingWords = wordsToFind.filter(word => !foundWords.includes(word));
            if (remainingWords.length > 0) {
                const word = remainingWords[0];
                const cell = findWordStart(word);
                if (cell) {
                    const cellElement = wordGrid.querySelector(`.grid-cell[data-row="${cell.row}"][data-col="${cell.col}"]`);
                    GSAP.to(cellElement, { scale: 1.2, duration: 0.5, repeat: 3, yoyo: true });
                }
            }
            updateStats();
            saveProgress();
        }

        // Use Case Notes power-up
        function useCaseNotes() {
            if (coins < 100) {
                alert('Not enough coins!');
                return;
            }
            coins -= 100;
            const remainingWords = wordsToFind.filter(word => !foundWords.includes(word));
            if (remainingWords.length > 0) {
                const word = remainingWords[0];
                foundWords.push(word);
                renderWordList();
                updateProgress();
                updateStats();
                checkLevelComplete();
                animateWordFound(findWordCells(word));
            }
            saveProgress();
        }

        // Use Shuffle Evidence power-up
        function useShuffle() {
            if (coins < 30) {
                alert('Not enough coins!');
                return;
            }
            coins -= 30;
            // Preserve found words
            const foundWordCells = [];
            foundWords.forEach(word => {
                foundWordCells.push(...findWordCells(word));
            });
            // Clear grid
            grid = Array(gridSize).fill().map(() => Array(gridSize).fill(''));
            // Re-place found words
            foundWordCells.forEach(({ word, row, col, direction }) => {
                placeWord(word, row, col, direction);
            });
            // Place remaining words
            const remainingWords = wordsToFind.filter(word => !foundWords.includes(word));
            remainingWords.forEach(word => {
                let placed = false;
                let attempts = 0;
                while (!placed && attempts < 100) {
                    const direction = Math.floor(Math.random() * 8);
                    const row = Math.floor(Math.random() * gridSize);
                    const col = Math.floor(Math.random() * gridSize);
                    if (canPlaceWord(word, row, col, direction)) {
                        placeWord(word, row, col, direction);
                        placed = true;
                    }
                    attempts++;
                }
            });
            // Fill remaining cells
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    if (grid[i][j] === '') {
                        grid[i][j] = String.fromCharCode(65 + Math.floor(Math.random() * 26));
                    }
                }
            }
            renderGrid();
            updateStats();
            saveProgress();
        }

// Find starting cell of a word
function findWordStart(word) {
    for (let i = 0; i < gridSize; i++) {
        for (let j = 0; j < gridSize; j++) {
            for (let direction = 0; direction < 8; direction++) {
                if (canFindWord(word, i, j, direction)) {
                    return { row: i, col: j };
                }
            }
        }
    }
    return null; // Word not found
}

// Check if a word can be found starting at (row, col) in the given direction
function canFindWord(word, row, col, direction) {
    const len = word.length;
    let r = row, c = col;

    for (let i = 0; i < len; i++) {
        if (r < 0 || r >= gridSize || c < 0 || c >= gridSize) return false;
        if (grid[r][c] !== word[i]) return false;
        switch (direction) {
            case 0: c++; break; // right
            case 1: r++; break; // down
            case 2: c--; break; // left
            case 3: r--; break; // up
            case 4: r++; c++; break; // diag-down-right
            case 5: r++; c--; break; // diag-down-left
            case 6: r--; c++; break; // diag-up-right
            case 7: r--; c--; break; // diag-up-left
        }
    }
    return true;
}

// Find all cells of a word for highlighting (used in Case Notes power-up)
function findWordCells(word) {
    for (let i = 0; i < gridSize; i++) {
        for (let j = 0; j < gridSize; j++) {
            for (let direction = 0; direction < 8; direction++) {
                if (canFindWord(word, i, j, direction)) {
                    const cells = [];
                    let r = i, c = j;
                    for (let k = 0; k < word.length; k++) {
                        cells.push({ row: r, col: c });
                        switch (direction) {
                            case 0: c++; break;
                            case 1: r++; break;
                            case 2: c--; break;
                            case 3: r--; break;
                            case 4: r++; c++; break;
                            case 5: r++; c--; break;
                            case 6: r--; c++; break;
                            case 7: r--; c--; break;
                        }
                    }
                    return cells;
                }
            }
        }
    }
    return [];
}

// Animate word found effect
function animateWordFound(cells) {
    cells.forEach((cell, index) => {
        const cellElement = wordGrid.querySelector(`.grid-cell[data-row="${cell.row}"][data-col="${cell.col}"]`);
        if (cellElement) {
            GSAP.to(cellElement, {
                scale: 1.2,
                backgroundColor: '#8B0000',
                color: '#fff',
                duration: 0.3,
                delay: index * 0.1,
                yoyo: true,
                repeat: 1
            });
        }
    });
}

// Animate case file entrance
function animateCaseFile() {
    GSAP.from(caseFile, {
        opacity: 0,
        y: 50,
        duration: 1,
        ease: 'power2.out'
    });
    GSAP.from(scenarioText, {
        opacity: 0,
        x: -20,
        duration: 1,
        delay: 0.5,
        onStart: () => {
            let text = '';
            const finalText = scenarioText.textContent;
            let i = 0;
            const typeInterval = setInterval(() => {
                text += finalText[i];
                scenarioText.textContent = text;
                i++;
                if (i >= finalText.length) {
                    clearInterval(typeInterval);
                    scenarioText.textContent = finalText;
                }
            }, 50);
        }
    });
}

// Animate grid entrance
function animateGrid() {
    const cells = wordGrid.querySelectorAll('.grid-cell');
    cells.forEach((cell, index) => {
        GSAP.from(cell, {
            opacity: 0,
            scale: 0,
            duration: 0.5,
            delay: index * 0.02,
            ease: 'back.out'
        });
    });
}

// Update achievements
function updateAchievements() {
    let newUnlock = false;
    achievements.forEach(achievement => {
        if (!achievement.unlocked && achievement.condition()) {
            achievement.unlocked = true;
            newUnlock = true;
        }
    });
    if (newUnlock) {
        renderAchievements();
        saveProgress();
    }
}

// Render achievements
function renderAchievements() {
    achievementList.innerHTML = '';
    achievements.forEach(achievement => {
        const achievementDiv = document.createElement('div');
        achievementDiv.classList.add('achievement');
        if (achievement.unlocked) {
            achievementDiv.classList.add('unlocked');
        }
        achievementDiv.innerHTML = `
            <h3>${achievement.name}</h3>
            <p>${achievement.description}</p>
        `;
        achievementList.appendChild(achievementDiv);
    });
}

// Handle daily challenge
function generateDailyChallenge() {
    const today = new Date().toISOString().split('T')[0];
    const savedChallenge = localStorage.getItem('dailyChallenge');
    if (savedChallenge && JSON.parse(savedChallenge).date === today) {
        const challenge = JSON.parse(savedChallenge);
        wordsToFind = challenge.words;
        generateScenario();
        generateGrid();
        renderGrid();
        renderWordList();
        updateProgress();
        updateStats();
    } else {
        selectWords(8).then(words => {
            wordsToFind = words;
            generateScenario();
            generateGrid();
            renderGrid();
            renderWordList();
            updateProgress();
            updateStats();
            localStorage.setItem('dailyChallenge', JSON.stringify({
                date: today,
                words: wordsToFind
            }));
        });
    }
}

// Initialize daily challenge
function initDailyChallenge() {
    const dailyChallengeBtn = document.createElement('button');
    dailyChallengeBtn.classList.add('power-up-btn');
    dailyChallengeBtn.textContent = 'Daily Challenge';
    dailyChallengeBtn.addEventListener('click', () => {
        currentLevel = 0; // Special level for daily challenge
        generateDailyChallenge();
        caseFile.querySelector('h2').textContent = 'Daily Case: Special Investigation';
    });
    document.querySelector('.game-controls').prepend(dailyChallengeBtn);
}

// Setup navigation and loader
function setupNavigation() {
    document.querySelectorAll('a[href]:not([href^="#"])').forEach(link => {
        link.addEventListener('click', function(e) {
            if (!this.href.includes(window.location.hostname) && !this.href.startsWith('mailto:')) return;
            e.preventDefault();
            loaderOverlay.classList.add('active');
            setTimeout(() => {
                window.location.href = this.href;
            }, 150);
        });
    });
}

// Sidebar and theme toggle
const themeToggle = document.getElementById('themeToggle');
const body = document.body;
const mobileMenuIcon = document.getElementById('mobileMenuIcon');
const sidebar = document.getElementById('sidebar');
const loaderOverlay = document.getElementById('loaderOverlay');

if (localStorage.getItem('darkTheme') === 'enabled') {
    body.classList.add('dark-theme');
    themeToggle.checked = true;
}

themeToggle.addEventListener('change', function() {
    if (this.checked) {
        body.classList.add('dark-theme');
        localStorage.setItem('darkTheme', 'enabled');
    } else {
        body.classList.remove('dark-theme');
        localStorage.setItem('darkTheme', 'disabled');
    }
});

mobileMenuIcon.addEventListener('click', function() {
    sidebar.classList.toggle('active');
    const icon = mobileMenuIcon.querySelector('i');
    if (sidebar.classList.contains('active')) {
        icon.classList.remove('fa-bars');
        icon.classList.add('fa-times');
    } else {
        icon.classList.remove('fa-times');
        icon.classList.add('fa-bars');
    }
});

// Initialize game
initGame();
initDailyChallenge();
setupNavigation();
    </script>