<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberSmart Trivia - Contra E-Crime</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/Dccn8pc.png">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body, html {
            min-height: 100vh;
            font-family: 'Montserrat', sans-serif;
            background-color: #f7f7f7;
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
        }

        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .loader-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #FFF;
            border-bottom-color: transparent;
            border-radius: 50%;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .dark-theme .loader {
            border-color: #d7b15c;
            border-bottom-color: transparent;
        }

        .avatar-loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 50px;
            height: 50px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 101;
        }

        .avatar-loading.active {
            display: flex;
        }

        .avatar-loading .loader {
            width: 24px;
            height: 24px;
            border-width: 3px;
        }

        .container {
            display: flex;
            min-height: 100vh;
            flex-direction: column;
        }

        .sidebar {
            width: 290px;
            background-image: url('https://i.imgur.com/bNRxAhZ.png');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 20px;
            height: 100vh;
            position: fixed;
            transition: transform 0.3s ease;
        }

        .sidebar h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
        }

        .sidebar ul {
            list-style-type: none;
            padding: 0;
        }

        .sidebar ul li {
            margin: 50px 0;
        }

        .sidebar ul li a {
            color: white;
            text-decoration: none;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar ul li a img {
            width: 30px;
            height: 30px;
        }

        .sidebar ul li a:not(.dark-theme-label a) {
            transition: all 0.3s ease;
            position: relative;
        }

        .sidebar ul li a:not(.dark-theme-label a):hover {
            color: #d7b15c;
            transform: translateX(5px);
        }

        .sidebar ul li a:not(.dark-theme-label a)::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -10px;
            left: 0;
            background-color: #d7b15c;
            transition: width 0.3s ease;
        }

        .sidebar ul li a:not(.dark-theme-label a):hover::after {
            width: 95%;
        }

        .dark-theme-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 20px;
        }

        .dark-theme-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
        }

        .dark-theme-label img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }

        .switch-label {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: #28292c;
            border-radius: 25px;
            cursor: pointer;
            border: 3px solid #28292c;
        }

        .checkbox {
            position: absolute;
            display: none;
        }

        .slider {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 25px;
            transition: 0.3s;
        }

        .checkbox:checked ~ .slider {
            background-color: #d8dbe0;
        }

        .slider::before {
            content: "";
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            box-shadow: inset 8px -3px 0px 0px #d8dbe0;
            background-color: #28292c;
            transition: 0.3s;
        }

        .checkbox:checked ~ .slider::before {
            transform: translateX(30px);
            background-color: #28292c;
            box-shadow: none;
        }

        .content {
            flex: 1;
            margin-left: 290px;
            padding: 60px 40px;
            background: linear-gradient(135deg, #f7f7f7 0%, #e5e5e5 100%);
            transition: background-color 0.3s ease, margin-left 0.3s ease;
            position: relative;
            overflow-y: auto;
        }

        .content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.6);
            z-index: 0;
        }

        .header {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 40px;
            position: relative;
            z-index: 3000;
        }

        .account-customization {
            position: fixed;
            top: 10px;
            right: 20px;
            z-index: 998;
        }

        .avatar-container {
            position: relative;
            display: inline-block;
        }

        .avatar-container .profile-pic {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            object-fit: cover;
            border: 2px solid #000;
            cursor: pointer;
            color: transparent;
            font-size: 0;
        }

        .customization-options {
            position: absolute;
            top: 50px;
            right: 0;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: none;
            flex-direction: column;
            padding: 8px;
            z-index: 3002;
            align-items: flex-start;
            width: 300px;
        }

        .customization-options.active {
            display: flex;
        }

        .customization-options .user-info {
            margin-bottom: 10px;
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #d32f2f 100%);
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }

        .customization-options .user-info p {
            margin: 5px 0;
            font-size: 12px;
            color: #ffffff;
            position: relative;
            z-index: 1;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            font-weight: 500;
            overflow-wrap: break-word;
        }

        .customization-options .user-info p::before {
            content: attr(data-label);
            font-weight: 700;
            color: #ff3333;
            margin-right: 5px;
        }

        .customization-options label {
            font-size: 12px;
            color: #333;
            cursor: pointer;
            padding: 4px 8px;
            transition: background-color 0.3s ease;
            width: 100%;
            text-align: left;
        }

        .customization-options label:hover {
            background-color: #f0f0f0;
            border-radius: 5px;
        }

        .customization-options input[type="color"] {
            width: 100%;
            height: 25px;
            padding: 0;
            border: none;
            cursor: pointer;
            background: none;
        }

        .customization-options select {
            font-size: 12px;
            padding: 4px;
            border-radius: 5px;
            border: 1px solid #ccc;
            cursor: pointer;
            width: 100%;
        }

        .customization-options input[type="file"] {
            display: none;
        }

        .customization-options .file-input-label {
            font-size: 12px;
            color: #333;
            cursor: pointer;
            padding: 4px 8px;
            transition: background-color 0.3s ease;
            width: 100%;
            text-align: left;
        }

        .customization-options .file-input-label:hover {
            background-color: #f0f0f0;
            border-radius: 5px;
        }

        .dark-theme .customization-options {
            background-color: #3a3b3c;
            border-color: #555;
        }

        .dark-theme .customization-options .user-info {
            background: linear-gradient(135deg, #5a6268 0%, #454b50 50%, #2f3539 100%);
            color: #e0e0e0;
        }

        .dark-theme .customization-options .user-info p {
            color: #e0e0e0;
        }

        .dark-theme .customization-options .user-info p::before {
            color: #ffeb3b;
        }

        .dark-theme .customization-options label,
        .dark-theme .customization-options .file-input-label {
            color: #e0e0e0;
        }

        .dark-theme .customization-options label:hover,
        .dark-theme .customization-options .file-input-label:hover {
            background-color: #4a4b4c;
        }

        .dark-theme .customization-options select {
            background-color: #3a3b3c;
            color: #e0e0e0;
            border-color: #555;
        }

        .game-section {
            position: relative;
            z-index: 1;
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px;
            background: linear-gradient(135deg, #2b2b2b 0%, #1a1a1a 100%);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            color: #fff;
            text-align: center;
            overflow: hidden;
        }

        .game-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://www.transparenttextures.com/patterns/circuit.png');
            opacity: 0.1;
            z-index: 0;
        }

        .game-section h1 {
            font-size: 48px;
            font-weight: 700;
            background: linear-gradient(90deg, #8B0000, #d7b15c);
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
            animation: fadeInDown 1s ease;
        }

        .game-section p {
            font-family: 'Poppins', sans-serif;
            font-size: 18px;
            font-weight: 300;
            color: #b0b0b0;
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
            animation: fadeInUp 1s ease 0.3s forwards;
            opacity: 0;
        }

        .difficulty-selection {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
            position: relative;
            z-index: 1;
        }

        .difficulty-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(90deg, #8B0000, #b30000);
            color: #fff;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .difficulty-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(139, 0, 0, 0.3);
        }

        .difficulty-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .difficulty-btn:hover::before {
            left: 100%;
        }

        .difficulty-btn.active {
            background: linear-gradient(90deg, #d7b15c, #b89a47);
            transform: scale(1.1);
        }

        .game-container {
            display: none;
            position: relative;
            z-index: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            animation: fadeIn 1s ease;
        }

        .game-container.active {
            display: block;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .game-header h2 {
            font-size: 24px;
            font-weight: 700;
            color: #d7b15c;
        }

        .score-board {
            display: flex;
            gap: 20px;
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
        }

        .score-board span {
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 15px;
            border-radius: 20px;
            color: #fff;
        }

        .puzzle-area {
            display: grid;
            gap: 5px;
            margin: 0 auto;
            background: #333;
            padding: 10px;
            border-radius: 10px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .puzzle-cell {
            width: 50px;
            height: 50px;
            background: #444;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            font-weight: 700;
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
            user-select: none;
        }

        .puzzle-cell:hover {
            background: #555;
            transform: scale(1.05);
        }

        .puzzle-cell.selected {
            background: #d7b15c;
            color: #222;
        }

        .puzzle-cell.correct {
            background: #4caf50;
            animation: pulse 0.5s ease;
        }

        .puzzle-cell.incorrect {
            background: #f44336;
            animation: shake 0.3s ease;
        }

        .word-list {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .word-item {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            font-size: 16px;
            color: #b0b0b0;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .word-item.found {
            background: #4caf50;
            color: #fff;
            text-decoration: line-through;
        }

        .clue-area {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            color: #b0b0b0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .clue-area span {
            animation: fadeIn 0.5s ease;
        }

        .control-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .control-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(90deg, #8B0000, #b30000);
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 0, 0, 0.3);
        }

        .control-btn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: #222;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            position: relative;
            animation: slideIn 0.5s ease;
        }

        .modal-content h2 {
            font-size: 32px;
            color: #d7b15c;
            margin-bottom: 20px;
        }

        .modal-content p {
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            color: #b0b0b0;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .modal-content button {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(90deg, #8B0000, #b30000);
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .modal-content button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 0, 0, 0.3);
        }

        .instructions-list {
            text-align: left;
            margin-bottom: 20px;
        }

        .instructions-list li {
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            color: #b0b0b0;
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .leaderboard {
            margin-top: 20px;
            text-align: left;
        }

        .leaderboard h3 {
            font-size: 24px;
            color: #d7b15c;
            margin-bottom: 15px;
        }

        .leaderboard ul {
            list-style: none;
            padding: 0;
        }

        .leaderboard li {
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            color: #b0b0b0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            margin-bottom: 5px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
        }

        .dark-theme .game-section {
            background: linear-gradient(135deg, #121212, #2c2c2c);
        }

        .dark-theme .game-section h1 {
            background: linear-gradient(90deg, #d7b15c, #8B0000);
            background-clip: text;
            -webkit-background-clip: text;
        }

        .dark-theme .game-container {
            background: rgba(255, 255, 255, 0.05);
        }

        .dark-theme .puzzle-area {
            background: #222;
        }

        .dark-theme .puzzle-cell {
            background: #333;
        }

        .dark-theme .puzzle-cell:hover {
            background: #444;
        }

        .dark-theme .puzzle-cell.selected {
            background: #b89a47;
        }

        .dark-theme .word-item {
            background: rgba(255, 255, 255, 0.05);
            color: #b0b0b0;
        }

        .dark-theme .clue-area {
            background: rgba(255, 255, 255, 0.05);
        }

        .dark-theme .modal-content {
            background: #333;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .mobile-nav {
            display: none;
            background-image: url('https://i.imgur.com/bNRxAhZ.png');
            padding: 15px;
            position: fixed;
            width: 100%;
            z-index: 3000;
        }

        .mobile-nav .logo {
            color: white;
            font-size: 20px;
            font-weight: bold;
            text-decoration: none;
        }

        .mobile-nav .menu-icon {
            color: white;
            font-size: 24px;
            cursor: pointer;
            position: absolute;
            right: 15px;
            top: 15px;
        }

        footer {
            background-color: #333;
            color: white;
            padding: 15px 30px;
            text-align: center;
            margin-left: 290px;
            z-index: 1;
            transition: margin-left 0.3s ease;
        }

        footer p {
            margin: 0;
            font-size: 14px;
        }

        .footer-links a {
            color: #d7b15c;
            text-decoration: none;
            margin: 0 10px;
            font-size: 14px;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        .dark-theme footer {
            background-color: #1a1a1a;
        }

        @media (max-width: 1024px) {
            .sidebar {
                width: 250px;
            }

            .content {
                margin-left: 250px;
                padding: 50px 30px;
            }

            footer {
                margin-left: 250px;
            }

            .game-section h1 {
                font-size: 40px;
            }

            .game-section p {
                font-size: 16px;
            }

            .puzzle-cell {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
                padding: 10px;
            }

            .content {
                margin-left: 200px;
                padding: 40px 20px;
            }

            footer {
                margin-left: 200px;
            }

            .game-section {
                padding: 30px;
            }

            .difficulty-selection {
                flex-direction: column;
                gap: 15px;
            }

            .difficulty-btn {
                padding: 12px 25px;
                font-size: 16px;
            }

            .puzzle-cell {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }

            .word-list {
                gap: 8px;
            }

            .word-item {
                font-size: 14px;
                padding: 6px 12px;
            }
        }

        @media (max-width: 480px) {
            .container {
                flex-direction: column;
            }

            .mobile-nav {
                display: block;
            }

            .sidebar {
                width: 100%;
                height: auto;
                position: fixed;
                padding: 10px;
                transform: translateX(-100%);
                z-index: 2999;
                top: 60px;
                height: calc(100vh - 60px);
                overflow-y: auto;
            }

            .sidebar.active {
                transform: translateX(0);
                z-index: 3000;
            }

            .sidebar h1 {
                display: none;
            }

            .sidebar ul li {
                margin: 20px 0;
            }

            .content {
                margin-left: 0;
                padding: 80px 15px;
            }

            footer {
                margin-left: 0;
                padding: 10px 20px;
            }

            .game-section {
                padding: 20px;
            }

            .game-section h1 {
                font-size: 32px;
            }

            .game-section p {
                font-size: 14px;
            }

            .puzzle-area {
                padding: 5px;
            }

            .puzzle-cell {
                width: 30px;
                height: 30px;
                font-size: 14px;
            }

            .word-item {
                font-size: 12px;
                padding: 5px 10px;
            }

            .clue-area {
                font-size: 14px;
                padding: 10px;
            }

            .control-btn {
                padding: 10px 20px;
                font-size: 14px;
            }

            .modal-content {
                padding: 20px;
                width: 95%;
            }

            .modal-content h2 {
                font-size: 28px;
            }

            .modal-content p,
            .instructions-list li {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="loader-overlay" id="loaderOverlay">
        <div class="loader"></div>
    </div>
    <div class="mobile-nav">
        <a href="HomePage.html" class="logo">Contra E-Crime</a>
        <div class="menu-icon" id="mobileMenuIcon">
            <i class="fas fa-bars"></i>
        </div>
    </div>

    <div class="container">
        <nav class="sidebar" id="sidebar">
            <h1>Contra E-Crime</h1>
            <ul>
                <li><a href="HomePage.html"><img src="https://i.imgur.com/OAHusQp.png" alt="Home">Home</a></li>
                <li><a href="News.html" target="_self" onclick="return true;"><img src="https://i.imgur.com/FNALwXX.png" alt="News & Insights">News & Insights</a></li>
                <li><a href="SavedLaws.html"><img src="https://i.imgur.com/VChoqhD.png" alt="Saved Laws">Saved Laws</a></li>
                <li><a href="History.html"><img src="https://i.imgur.com/cnaDfEq.png" alt="Search History">Search History</a></li>
                <li><a href="ContactUs.html"><img src="https://i.imgur.com/T7bI4RJ.png" alt="Contact Us">Contact Us</a></li>
                <li><a href="AboutUs.html"><img src="https://i.imgur.com/lktrzpa.png" alt="About Us">About Us</a></li>
                <li><a href="index.html"><img src="https://i.imgur.com/2jjsgOq.png" alt="Logout">Logout</a></li>
            </ul>
            <div class="dark-theme-container">
                <div class="dark-theme-label">
                    <img src="https://i.imgur.com/vEKpOsq.png" alt="Dark Theme">
                    <span>Dark Theme</span>
                </div>
                <div class="toggle-switch">
                    <label class="switch-label">
                        <input type="checkbox" class="checkbox" id="themeToggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </nav>
        <main class="content">
            <header class="header">
                <div class="account-customization">
                    <div class="avatar-container">
                        <img class="profile-pic" id="profilePic" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/wcAAwAB/4L1mGQAAAAASUVORK5CYII=" alt="User Avatar">
                        <div class="avatar-loading" id="avatarLoading">
                            <div class="loader"></div>
                        </div>
                        <div class="customization-options" id="customizationMenu">
                            <div class="user-info" id="userInfo">
                                <p id="usernameDisplay" data-label="Username:">Loading...</p>
                                <p id="emailDisplay" data-label="Email:">Loading...</p>
                                <p id="createdAtDisplay" data-label="Account Created:">Loading...</p>
                            </div>
                            <label class="file-input-label" for="avatarInput">Change Avatar</label>
                            <input type="file" id="avatarInput" accept="image/jpeg,image/png,image/jpg">
                            <label for="avatarBgColorPicker">Avatar Background Color</label>
                            <input type="color" id="avatarBgColorPicker" value="#cccccc">
                            <label for="borderColorPicker">Border Color</label>
                            <input type="color" id="borderColorPicker" value="#000000">
                            <label for="borderTypeSelect">Border Type</label>
                            <select id="borderTypeSelect">
                                <option value="solid">Solid</option>
                                <option value="dashed">Dashed</option>
                                <option value="dotted">Dotted</option>
                                <option value="double">Double</option>
                            </select>
                        </div>
                    </div>
                </div>
            </header>
            <section class="game-section">
                <h1>CyberSmart Trivia</h1>
                <p>Step into the shoes of a cyber detective and uncover hidden cybercrime terms in a thrilling word search puzzle!</p>
                <div class="difficulty-selection" id="difficultySelection">
                    <button class="difficulty-btn" data-level="easy">Easy</button>
                    <button class="difficulty-btn" data-level="medium">Medium</button>
                    <button class="difficulty-btn" data-level="hard">Hard</button>
                </div>
                <div class="game-container" id="gameContainer">
                    <div class="game-header">
                        <h2 id="caseTitle">Case: The Digital Conspiracy</h2>
                        <div class="score-board">
                            <span>Score: <span id="score">0</span></span>
                            <span>Time: <span id="timer">00:00</span></span>
                            <span>Hints: <span id="hints">3</span></span>
                        </div>
                    </div>
                    <div class="puzzle-area" id="puzzleArea"></div>
                    <div class="word-list" id="wordList"></div>
                    <div class="clue-area" id="clueArea"><span>Click a cell to start selecting letters!</span></div>
                    <div class="control-buttons">
                        <button class="control-btn" id="hintBtn">Use Hint</button>
                        <button class="control-btn" id="resetBtn">Reset Puzzle</button>
                        <button class="control-btn" id="submitBtn">Submit Case</button>
                    </div>
                </div>
            </section>
            <div class="modal" id="instructionsModal">
                <div class="modal-content">
                    <h2>Welcome, Detective!</h2>
                    <p>Your mission is to solve cybercrime cases by finding hidden terms in the word search puzzle. Each case tests your knowledge of cybercrime laws.</p>
                    <ul class="instructions-list">
                        <li><strong>Choose a Difficulty:</strong> Easy (10x10 grid, 5 words), Medium (12x12 grid, 7 words), or Hard (15x15 grid, 10 words).</li>
                        <li><strong>Find Words:</strong> Click and drag to select letters forming cybercrime terms. Words can be horizontal, vertical, or diagonal.</li>
                        <li><strong>Scoring:</strong> Earn 100 points per word found. Bonus 50 points for quick finds (under 30 seconds per word). Penalty of -20 points for incorrect selections.</li>
                        <li><strong>Hints:</strong> Use up to 3 hints per game to reveal a word's starting position. Each hint costs 50 points.</li>
                        <li><strong>Time Limit:</strong> Easy: 5 min, Medium: 7 min, Hard: 10 min. Bonus points for early completion.</li>
                        <li><strong>Win Condition:</strong> Find all words before time runs out to crack the case!</li>
                    </ul>
                    <button id="startGameBtn">Start Investigation</button>
                </div>
            </div>
            <div class="modal" id="gameOverModal">
                <div class="modal-content">
                    <h2>Case Closed!</h2>
                    <p id="gameOverMessage"></p>
                    <div class="leaderboard" id="leaderboard">
                        <h3>Top Detectives</h3>
                        <ul id="leaderboardList"></ul>
                    </div>
                    <button id="playAgainBtn">New Case</button>
                </div>
            </div>
        </main>
        <footer>
            <p>Â© 2025 Contra E-Crime. All rights reserved.</p>
            <div class="footer-links">
                <a href="ContactUs.html">Contact Us</a>
                <a href="AboutUs.html">About Us</a>
            </div>
        </footer>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCDNmxNOV7rr_qfM_mTeYTaUIkkLvRaf80",
            authDomain: "contra-e-crime.firebaseapp.com",
            projectId: "contra-e-crime",
            storageBucket: "contra-e-crime.firebasestorage.app",
            messagingSenderId: "198995444405",
            appId: "1:198995444405:web:5f8c6eed561461b36034fc",
            measurementId: "G-7Y2E24DD42",
            databaseURL: "https://contra-e-crime-default-rtdb.firebaseio.com"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const db = firebase.firestore();

        const CLOUDINARY_CLOUD_NAME = 'dkxtbukta';
        const CLOUDINARY_UPLOAD_PRESET = 'contraecrime';

        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        const mobileMenuIcon = document.getElementById('mobileMenuIcon');
        const sidebar = document.getElementById('sidebar');
        const loaderOverlay = document.getElementById('loaderOverlay');
        const profilePic = document.getElementById('profilePic');
        const customizationMenu = document.getElementById('customizationMenu');
        const avatarInput = document.getElementById('avatarInput');
        const avatarLoading = document.getElementById('avatarLoading');
        const avatarBgColorPicker = document.getElementById('avatarBgColorPicker');
        const borderColorPicker = document.getElementById('borderColorPicker');
        const borderTypeSelect = document.getElementById('borderTypeSelect');
        const usernameDisplay = document.getElementById('usernameDisplay');
        const emailDisplay = document.getElementById('emailDisplay');
        const createdAtDisplay = document.getElementById('createdAtDisplay');

        const difficultySelection = document.getElementById('difficultySelection');
        const gameContainer = document.getElementById('gameContainer');
        const puzzleArea = document.getElementById('puzzleArea');
        const wordList = document.getElementById('wordList');
        const clueArea = document.getElementById('clueArea');
        const scoreDisplay = document.getElementById('score');
        const timerDisplay = document.getElementById('timer');
        const hintsDisplay = document.getElementById('hints');
        const hintBtn = document.getElementById('hintBtn');
        const resetBtn = document.getElementById('resetBtn');
        const submitBtn = document.getElementById('submitBtn');
        const instructionsModal = document.getElementById('instructionsModal');
        const gameOverModal = document.getElementById('gameOverModal');
        const startGameBtn = document.getElementById('startGameBtn');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const gameOverMessage = document.getElementById('gameOverMessage');
        const leaderboardList = document.getElementById('leaderboardList');

        const terms = [
            { term: "Cybercrime", definition: "Criminal activities carried out by means of computers or the internet." },
            { term: "Hacking", definition: "Gaining unauthorized access to computer systems or networks." },
            { term: "Phishing", definition: "Fraudulent attempt to obtain sensitive information by disguising as trustworthy." },
            { term: "Fraud", definition: "Wrongful deception for financial or personal gain." },
            { term: "IdentityTheft", definition: "Using someone else's identity for financial advantage." },
            { term: "DataBreach", definition: "Unauthorized access or disclosure of sensitive data." },
            { term: "ChildPornography", definition: "Illegal material depicting minors in sexual acts." },
            { term: "MoneyLaundering", definition: "Concealing origins of illegally obtained money." },
            { term: "CyberSquatting", definition: "Using a domain name to profit from another's trademark." },
            { term: "UnauthorizedAccess", definition: "Gaining entry to a system without permission." },
            { term: "ElectronicTransaction", definition: "Transactions conducted through electronic means." },
            { term: "CreditCardSkimming", definition: "Theft of credit card information using illegal devices." },
            { term: "MoneyMuling", definition: "Using individuals to transfer illegally obtained money." },
            { term: "SocialEngineering", definition: "Manipulating individuals to divulge confidential information." },
            { term: "EconomicSabotage", definition: "Large-scale financial crimes undermining the economy." },
            { term: "Cybersex", definition: "Illegal sexual activities through digital platforms." },
            { term: "DataInterference", definition: "Intentional alteration or deletion of computer data." },
            { term: "SystemInterference", definition: "Disrupting normal operation of a computer system." },
            { term: "MisuseOfDevices", definition: "Using tools or software to commit cybercrimes." },
            { term: "ComputerForgery", definition: "Creating or altering digital data to deceive." },
            { term: "Voyeurism", definition: "Secretly observing or recording someone in private." },
            { term: "HumanTrafficking", definition: "Illegal trade of humans for exploitation." },
            { term: "SIMSpoofing", definition: "Impersonating a SIM card to commit fraud." },
            { term: "OnlineSexualAbuse", definition: "Exploiting individuals through digital platforms." },
            { term: "Grooming", definition: "Manipulating a child into sexual activity online." },
            { term: "IntellectualProperty", definition: "Creations of the mind protected by law." },
            { term: "TerrorismFinancing", definition: "Funding terrorist activities or organizations." },
            { term: "AssetFreezing", definition: "Restricting access to financial assets." },
            { term: "PhishingAttack", definition: "Targeted attempt to steal information via fraudulent messages." },
            { term: "NumberPortability", definition: "Retaining a mobile number when switching providers." },
            { term: "GenderHarassment", definition: "Unwanted behavior targeting someone based on gender." },
            { term: "Wiretapping", definition: "Secretly intercepting private communications." },
            { term: "Terrorism", definition: "Using violence to intimidate for political purposes." },
            { term: "Bullying", definition: "Repeated aggressive behavior to harm or intimidate." },
            { term: "Cybersecurity", definition: "Protecting systems and networks from cyber threats." },
            { term: "StrategicGoods", definition: "Items with civilian and military uses, regulated." },
            { term: "ConsumerProtection", definition: "Laws safeguarding consumers from unfair practices." },
            { term: "Piracy", definition: "Unauthorized reproduction of copyrighted material." },
            { term: "OperationalRisk", definition: "Risk of loss due to inadequate processes." },
            { term: "BusinessContinuity", definition: "Ensuring operations continue during disruptions." },
            { term: "OutsourcingRisk", definition: "Risks from delegating operations to third parties." },
            { term: "CriticalInfrastructure", definition: "Essential systems impacting society if disrupted." },
            { term: "CloudComputing", definition: "Delivering computing services over the internet." },
            { term: "ValueAddedServices", definition: "Enhanced telecom services beyond basic offerings." },
            { term: "BroadcastMessaging", definition: "Sending messages to a large group of subscribers." },
            { term: "PrepaidLoad", definition: "Monetary amount added to a mobile account." },
            { term: "DeepFake", definition: "AI-generated media falsely depicting a person." },
            { term: "OnlinePharmacy", definition: "Digital platform selling pharmaceutical products." },
            { term: "ECommerce", definition: "Buying and selling goods over the internet." },
            { term: "CybercrimeWarrant", definition: "Legal authorization for cybercrime investigations." },
            { term: "ElectronicEvidence", definition: "Digital information admissible in court." }
        ];

        let currentDifficulty = null;
        let puzzleGrid = [];
        let selectedCells = [];
        let foundWords = [];
        let score = 0;
        let hints = 3;
        let timerInterval = null;
        let timeLeft = 0;
        let startTime = null;
        let wordsToFind = [];
        let wordPositions = [];
        let user = null;

        const difficultySettings = {
            easy: { gridSize: 10, wordCount: 5, timeLimit: 300 },
            medium: { gridSize: 12, wordCount: 7, timeLimit: 420 },
            hard: { gridSize: 15, wordCount: 10, timeLimit: 600 }
        };

        function initializeGame() {
            instructionsModal.classList.add('active');
            gameContainer.classList.remove('active');
            difficultySelection.style.display = 'flex';
            score = 0;
            hints = 3;
            foundWords = [];
            selectedCells = [];
            scoreDisplay.textContent = score;
            hintsDisplay.textContent = hints;
            timerDisplay.textContent = '00:00';
            clueArea.innerHTML = '<span>Click a cell to start selecting letters!</span>';
            if (timerInterval) clearInterval(timerInterval);
        }

        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                timeLeft = difficultySettings[currentDifficulty].timeLimit - elapsed;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    endGame(false);
                } else {
                    const minutes = Math.floor(timeLeft / 60);
                    const seconds = timeLeft % 60;
                    timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }

        function generatePuzzle() {
            const { gridSize, wordCount } = difficultySettings[currentDifficulty];
            puzzleGrid = Array(gridSize).fill().map(() => Array(gridSize).fill(''));
            wordsToFind = [];
            wordPositions = [];

            // Select random words
            const shuffledTerms = terms.sort(() => Math.random() - 0.5);
            for (let i = 0; i < wordCount && i < shuffledTerms.length; i++) {
                wordsToFind.push(shuffledTerms[i].term.replace(/\s/g, ''));
            }

            // Place words in grid
            wordsToFind.forEach(word => {
                let placed = false;
                let attempts = 0;
                const maxAttempts = 100;

                while (!placed && attempts < maxAttempts) {
                    const direction = ['horizontal', 'vertical', 'diagonal'][Math.floor(Math.random() * 3)];
                    const row = Math.floor(Math.random() * gridSize);
                    const col = Math.floor(Math.random() * gridSize);
                    const canPlace = checkWordPlacement(word, row, col, direction, gridSize);
                    if (canPlace) {
                        placeWord(word, row, col, direction);
                        wordPositions.push({ word, row, col, direction });
                        placed = true;
                    }
                    attempts++;
                }
            });

            // Fill remaining cells with random letters
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    if (!puzzleGrid[i][j]) {
                        puzzleGrid[i][j] = String.fromCharCode(65 + Math.floor(Math.random() * 26));
                    }
                }
            }

            renderPuzzle();
            renderWordList();
        }

        function checkWordPlacement(word, row, col, direction, gridSize) {
            const len = word.length;
            if (direction === 'horizontal' && col + len > gridSize) return false;
            if (direction === 'vertical' && row + len > gridSize) return false;
            if (direction === 'diagonal' && (row + len > gridSize || col + len > gridSize)) return false;

            for (let i = 0; i < len; i++) {
                const r = direction === 'vertical' ? row + i : direction === 'diagonal' ? row + i : row;
                const c = direction === 'horizontal' ? col + i : direction === 'diagonal' ? col + i : col;
                if (puzzleGrid[r][c] && puzzleGrid[r][c] !== word[i]) {
                    return false;
                }
            }
            return true;
        }

        function placeWord(word, row, col, direction) {
            for (let i = 0; i < word.length; i++) {
                const r = direction === 'vertical' ? row + i : direction === 'diagonal' ? row + i : row;
                const c = direction === 'horizontal' ? col + i : direction === 'diagonal' ? col + i : col;
                puzzleGrid[r][c] = word[i];
            }
        }

        function renderPuzzle() {
            puzzleArea.innerHTML = '';
            puzzleArea.style.gridTemplateColumns = `repeat(${difficultySettings[currentDifficulty].gridSize}, 1fr)`;
            puzzleGrid.forEach((row, i) => {
                row.forEach((letter, j) => {
                    const cell = document.createElement('div');
                    cell.classList.add('puzzle-cell');
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    cell.textContent = letter;
                    puzzleArea.appendChild(cell);
                });
            });
            addPuzzleListeners();
        }

        function renderWordList() {
            wordList.innerHTML = '';
            wordsToFind.forEach(word => {
                const wordItem = document.createElement('div');
                wordItem.classList.add('word-item');
                wordItem.textContent = word.replace(/([A-Z])/g, ' $1').trim();
                wordList.appendChild(wordItem);
            });
        }

        function addPuzzleListeners() {
            let isSelecting = false;
            let startCell = null;

            puzzleArea.addEventListener('mousedown', (e) => {
                if (e.target.classList.contains('puzzle-cell')) {
                    isSelecting = true;
                    startCell = e.target;
                    selectedCells = [startCell];
                    startCell.classList.add('selected');
                }
            });

            puzzleArea.addEventListener('mousemove', (e) => {
                if (isSelecting && e.target.classList.contains('puzzle-cell')) {
                    const endCell = e.target;
                    clearSelection();
                    selectedCells = getCellsInPath(startCell, endCell);
                    selectedCells.forEach(cell => cell.classList.add('selected'));
                }
            });

            puzzleArea.addEventListener('mouseup', () => {
                if (isSelecting) {
                    isSelecting = false;
                    checkSelection();
                }
            });

            puzzleArea.addEventListener('mouseleave', () => {
                if (isSelecting) {
                    isSelecting = false;
                    checkSelection();
                }
            });
        }

        function getCellsInPath(start, end) {
            const startRow = parseInt(start.dataset.row);
            const startCol = parseInt(start.dataset.col);
            const endRow = parseInt(end.dataset.row);
            const endCol = parseInt(end.dataset.col);
            const cells = [];

            const deltaRow = endRow - startRow;
            const deltaCol = endCol - startCol;
            const steps = Math.max(Math.abs(deltaRow), Math.abs(deltaCol));

            if (steps === 0) return [start];

            const rowStep = deltaRow / steps;
            const colStep = deltaCol / steps;

            for (let i = 0; i <= steps; i++) {
                const r = Math.round(startRow + i * rowStep);
                const c = Math.round(startCol + i * colStep);
                if (r >= 0 && r < puzzleGrid.length && c >= 0 && c < puzzleGrid[0].length) {
                    const cell = puzzleArea.querySelector(`[data-row="${r}"][data-col="${c}"]`);
                    if (cell) cells.push(cell);
                }
            }

            return cells;
        }

        function checkSelection() {
            const selectedWord = selectedCells.map(cell => cell.textContent).join('');
            const reverseWord = selectedCells.map(cell => cell.textContent).reverse().join('');
            let isCorrect = false;
            let foundWord = null;

            wordsToFind.forEach(word => {
                if ((selectedWord === word || reverseWord === word) && !foundWords.includes(word)) {
                    isCorrect = true;
                    foundWord = word;
                }
            });

            if (isCorrect) {
                selectedCells.forEach(cell => {
                    cell.classList.remove('selected');
                    cell.classList.add('correct');
                });
                foundWords.push(foundWord);
                const wordIndex = wordsToFind.indexOf(foundWord);
                wordList.children[wordIndex].classList.add('found');
                const timeTaken = (Date.now() - startTime) / 1000;
                score += 100;
                if (timeTaken < 30 * (foundWords.length)) {
                    score += 50;
                }
                scoreDisplay.textContent = score;
                const term = terms.find(t => t.term.replace(/\s/g, '') === foundWord);
                clueArea.innerHTML = `<span>Great work! "${foundWord.replace(/([A-Z])/g, ' $1').trim()}" found: ${term.definition}</span>`;
                if (foundWords.length === wordsToFind.length) {
                    endGame(true);
                }
            } else {
                selectedCells.forEach(cell => {
                    cell.classList.remove('selected');
                    cell.classList.add('incorrect');
                    setTimeout(() => cell.classList.remove('incorrect'), 300);
                });
                score = Math.max(0, score - 20);
                scoreDisplay.textContent = score;
                clueArea.innerHTML = '<span>Incorrect selection. Try again!</span>';
            }
            selectedCells = [];
        }

        function clearSelection() {
            document.querySelectorAll('.puzzle-cell.selected').forEach(cell => {
                cell.classList.remove('selected');
            });
            selectedCells = [];
        }

        function useHint() {
            if (hints > 0 && foundWords.length < wordsToFind.length) {
                const remainingWords = wordsToFind.filter(word => !foundWords.includes(word));
                if (remainingWords.length > 0) {
                    const word = remainingWords[0];
                    const position = wordPositions.find(pos => pos.word === word);
                    if (position) {
                        const cell = puzzleArea.querySelector(`[data-row="${position.row}"][data-col="${position.col}"]`);
                        cell.classList.add('correct');
                        setTimeout(() => cell.classList.remove('correct'), 1000);
                        clueArea.innerHTML = `<span>Hint: "${word.replace(/([A-Z])/g, ' $1').trim()}" starts at (${position.row + 1}, ${position.col + 1})</span>`;
                        hints--;
                        hintsDisplay.textContent = hints;
                        score = Math.max(0, score - 50);
                        scoreDisplay.textContent = score;
                        hintBtn.disabled = hints === 0;
                    }
                }
            }
        }

        function resetPuzzle() {
            generatePuzzle();
            score = 0;
            hints = 3;
            foundWords = [];
            selectedCells = [];
            scoreDisplay.textContent = score;
            hintsDisplay.textContent = hints;
            clueArea.innerHTML = '<span>Click a cell to start selecting letters!</span>';
            if (timerInterval) clearInterval(timerInterval);
            startTimer();
            hintBtn.disabled = false;
        }

        function endGame(success) {
            clearInterval(timerInterval);
            let bonus = 0;
            if (success) {
                const timeUsed = difficultySettings[currentDifficulty].timeLimit - timeLeft;
                if (timeUsed < difficultySettings[currentDifficulty].timeLimit * 0.5) {
                    bonus = 200;
                } else if (timeUsed < difficultySettings[currentDifficulty].timeLimit * 0.75) {
                    bonus = 100;
                }
                score += bonus;
            }
            scoreDisplay.textContent = score;
            gameOverMessage.innerHTML = success
                ? `Congratulations, Detective! You cracked the case with a score of ${score}! ${bonus > 0 ? `(+${bonus} time bonus)` : ''}`
                : `Time's up, Detective! Case unsolved. Final score: ${score}.`;
            updateLeaderboard();
            gameOverModal.classList.add('active');
            gameContainer.classList.remove('active');
        }

        async function updateLeaderboard() {
            if (!user) return;
            try {
                const leaderboardRef = db.collection('leaderboard').doc(currentDifficulty);
                const doc = await leaderboardRef.get();
                let scores = doc.exists ? doc.data().scores : [];
                scores.push({ username: user.displayName || 'Anonymous', score, timestamp: Date.now() });
                scores.sort((a, b) => b.score - a.score);
                scores = scores.slice(0, 5);
                await leaderboardRef.set({ scores });
                renderLeaderboard(scores);
            } catch (error) {
                console.error('Error updating leaderboard:', error);
            }
        }

        function renderLeaderboard(scores) {
            leaderboardList.innerHTML = '';
            scores.forEach((entry, index) => {
                const li = document.createElement('li');
                li.innerHTML = `<span>${index + 1}. ${entry.username}</span><span>${entry.score}</span>`;
                leaderboardList.appendChild(li);
            });
        }

        auth.onAuthStateChanged((currentUser) => {
            user = currentUser;
            if (user) {
                const currentUserData = {
                    username: user.displayName || 'User',
                    email: user.email,
                    createdAt: user.metadata.creationTime
                };
                localStorage.setItem('currentUser', JSON.stringify(currentUserData));
                usernameDisplay.textContent = currentUserData.username;
                emailDisplay.textContent = currentUserData.email;
                createdAtDisplay.textContent = new Date(currentUserData.createdAt).toLocaleString();

                const sanitizedEmail = currentUserData.email.replace(/\./g, ',');
                const userRef = database.ref(`users/${sanitizedEmail}`);
                userRef.once('value', (snapshot) => {
                    const userData = snapshot.val();
                    if (userData) {
                        profilePic.src = userData.avatarUrl || 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/wcAAwAB/4L1mGQAAAAASUVORK5CYII=';
                        if (userData.avatarBgColor) {
                            profilePic.style.backgroundColor = userData.avatarBgColor;
                            avatarBgColorPicker.value = userData.avatarBgColor;
                        }
                        if (userData.borderColor) {
                            profilePic.style.borderColor = userData.borderColor;
                            borderColorPicker.value = userData.borderColor;
                        }
                        if (userData.borderType) {
                            profilePic.style.borderStyle = userData.borderType;
                            borderTypeSelect.value = userData.borderType;
                        }
                    }
                }, (error) => {
                    console.error('Error loading user customization:', error);
                    alert('Failed to load user customization: ' + error.message);
                });
            } else {
                localStorage.removeItem('currentUser');
                window.location.href = 'index.html';
            }
        });

        profilePic.addEventListener('click', () => {
            customizationMenu.classList.toggle('active');
        });

        document.addEventListener('click', (e) => {
            if (!customizationMenu.contains(e.target) && e.target !== profilePic) {
                customizationMenu.classList.remove('active');
            }
        });

        avatarInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const validTypes = ['image/jpeg', 'image/png', 'image/jpg'];
            const maxSize = 2 * 1024 * 1024;
            if (!validTypes.includes(file.type)) {
                alert('Please upload a valid image (JPG, JPEG, PNG).');
                return;
            }
            if (file.size > maxSize) {
                alert('Image size must be less than 2MB.');
                return;
            }

            if (!user) {
                alert('You must be logged in to upload an avatar.');
                avatarLoading.classList.remove('active');
                return;
            }

            avatarLoading.classList.add('active');

            const img = new Image();
            const reader = new FileReader();
            reader.onload = (e) => {
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);

            img.onload = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const maxDimension = 300;
                let width = img.width;
                let height = img.height;

                if (width > height) {
                    if (width > maxDimension) {
                        height = Math.round((height * maxDimension) / width);
                        width = maxDimension;
                    }
                } else {
                    if (height > maxDimension) {
                        width = Math.round((width * maxDimension) / height);
                        height = maxDimension;
                    }
                }

                canvas.width = width;
                canvas.height = height;
                ctx.drawImage(img, 0, 0, width, height);

                canvas.toBlob((blob) => {
                    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                    if (!currentUser || !currentUser.email) {
                        alert('User not logged in.');
                        avatarLoading.classList.remove('active');
                        return;
                    }

                    const formData = new FormData();
                    formData.append('file', blob);
                    formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
                    formData.append('folder', `avatars/${currentUser.email}`);

                    fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) throw new Error(data.error.message);
                        const avatarUrl = data.secure_url;
                        const sanitizedEmail = currentUser.email.replace(/\./g, ',');

                        database.ref(`users/${sanitizedEmail}`).update({
                            avatarUrl: avatarUrl,
                            updatedAt: firebase.database.ServerValue.TIMESTAMP
                        })
                        .then(() => {
                            profilePic.src = avatarUrl;
                            avatarLoading.classList.remove('active');
                        })
                        .catch(error => {
                            console.error('Error saving avatar URL:', error);
                            alert('Failed to save avatar: ' + error.message);
                            avatarLoading.classList.remove('active');
                        });
                    })
                    .catch(error => {
                        console.error('Error uploading avatar:', error);
                        alert('Failed to upload avatar: ' + error.message);
                        avatarLoading.classList.remove('active');
                    });
                }, file.type, 0.6);
            };
        });

        avatarBgColorPicker.addEventListener('change', () => {
            const color = avatarBgColorPicker.value;
            profilePic.style.backgroundColor = color;
            if (user) {
                const sanitizedEmail = user.email.replace(/\./g, ',');
                database.ref(`users/${sanitizedEmail}`).update({ avatarBgColor: color });
            }
        });

        borderColorPicker.addEventListener('change', () => {
            const color = borderColorPicker.value;
            profilePic.style.borderColor = color;
            if (user) {
                const sanitizedEmail = user.email.replace(/\./g, ',');
                database.ref(`users/${sanitizedEmail}`).update({ borderColor: color });
            }
        });

        borderTypeSelect.addEventListener('change', () => {
            const borderType = borderTypeSelect.value;
            profilePic.style.borderStyle = borderType;
            if (user) {
                const sanitizedEmail = user.email.replace(/\./g, ',');
                database.ref(`users/${sanitizedEmail}`).update({ borderType: borderType });
            }
        });

        if (localStorage.getItem('darkTheme') === 'enabled') {
            body.classList.add('dark-theme');
            themeToggle.checked = true;
        }

        themeToggle.addEventListener('change', () => {
            body.classList.toggle('dark-theme');
            localStorage.setItem('darkTheme', body.classList.contains('dark-theme') ? 'enabled' : 'disabled');
        });

        mobileMenuIcon.addEventListener('click', () => {
            sidebar.classList.toggle('active');
            const icon = mobileMenuIcon.querySelector('i');
            icon.classList.toggle('fa-bars');
            icon.classList.toggle('fa-times');
        });

        document.querySelectorAll('a[href]').forEach(link => {
            if (link.href && !link.href.startsWith('javascript:') && !link.href.startsWith('#')) {
                link.addEventListener('click', (e) => {
                    if (!link.href.includes(window.location.hostname)) return;
                    e.preventDefault();
                    loaderOverlay.classList.add('active');
                    setTimeout(() => {
                        window.location.href = link.href;
                    }, 150);
                });
            }
        });

        difficultySelection.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                currentDifficulty = btn.dataset.level;
                difficultySelection.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                instructionsModal.classList.add('active');
            });
        });

        startGameBtn.addEventListener('click', () => {
            instructionsModal.classList.remove('active');
            gameContainer.classList.add('active');
            difficultySelection.style.display = 'none';
            generatePuzzle();
            startTimer();
        });

        hintBtn.addEventListener('click', useHint);
        resetBtn.addEventListener('click', resetPuzzle);
        submitBtn.addEventListener('click', () => endGame(foundWords.length === wordsToFind.length));
        playAgainBtn.addEventListener('click', () => {
            gameOverModal.classList.remove('active');
            initializeGame();
        });

        document.addEventListener('DOMContentLoaded', initializeGame);
    </script>
</body>
</html>