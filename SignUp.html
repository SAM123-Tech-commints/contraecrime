<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contra E-Crime - Sign Up</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/Dccn8pc.png">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            display: flex;
            min-height: 100vh;
            background-color: #f4f4f4;
            position: relative;
            overflow-y: auto;
        }

        .container {
            display: flex;
            width: 100%;
            min-height: 100vh;
            flex-direction: column;
        }

        .background-image {
            background-image: url('https://i.imgur.com/UgM66T3.png');
            background-size: cover;
            background-position: center;
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            min-height: 30vh;
        }

        .background-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(88, 1, 0, 0.4), rgba(0, 0, 0, 0.3));
            z-index: 1;
        }

        .text-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            background-color: transparent;
            z-index: 2;
            max-width: 90%;
        }

        .text-typewriter {
            font-size: 2vw;
            font-weight: 500;
            color: #fff;
            font-family: 'Montserrat', sans-serif;
            overflow: hidden;
            white-space: normal;
            overflow-wrap: break-word;
            margin: 0 auto;
            letter-spacing: .05em;
            border-right: .15em solid rgb(255, 0, 0);
            animation: blink-caret .75s step-end infinite;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: rgb(255, 0, 0); }
        }

        .website-logo {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 275px;
            height: auto;
            z-index: 2;
        }

        .form-container {
            background: #ffffff;
            flex: 1;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            max-width: 500px;
            position: relative;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            opacity: 0;
            animation: fadeIn 1s ease-in forwards;
            overflow-y: auto;
            min-height: 70vh;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .halftone-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://i.imgur.com/MR5VoVn.png');
            background-size: cover;
            background-position: center;
            opacity: 0.3;
            z-index: 0;
        }

        .logoname {
            font-size: 36px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
            color: #580100;
            position: relative;
            z-index: 1;
        }

        h2 {
            text-align: center;
            margin-bottom: 25px;
            color: #333;
            font-size: 24px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        label {
            display: block;
            margin-top: 15px;
            font-weight: 500;
            color: #333;
            font-size: 14px;
            position: relative;
            z-index: 1;
        }

        .input-container {
            position: relative;
            width: 100%;
            margin-top: 5px;
            z-index: 1;
        }

        input[type="text"],
        input[type="password"],
        input[type="email"] {
            width: 100%;
            padding: 12px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="password"]:focus,
        input[type="email"]:focus {
            border-color: #580100;
            box-shadow: 0 0 5px rgba(88, 1, 0, 0.3);
            outline: none;
        }

        .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #580100;
            transition: color 0.3s ease;
        }

        .toggle-password:hover {
            color: #8B0000;
        }

        .checkbox-container {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            margin: 15px 0;
            position: relative;
            z-index: 1;
        }

        .checkbox {
            display: flex;
            align-items: center;
        }

        .checkbox input {
            margin-right: 10px;
            margin-top: 9px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox label {
            color: #580100;
            font-size: 14px;
            font-weight: 500;
            margin-left: 5px;
            margin-top: 10px;
            line-height: 18px;
            cursor: pointer;
        }

        .login-prompt {
            text-align: center;
            margin: 20px 0;
            font-size: 14px;
            color: #580100;
            position: relative;
            z-index: 1;
        }

        .login-prompt a {
            color: #8B0000;
            text-decoration: none;
            font-weight: 600;
        }

        .login-prompt a:hover {
            text-decoration: underline;
        }

        .buttons-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            position: relative;
            z-index: 1;
        }

        .action-btn {
            padding: 12px 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-size: 16px;
            font-weight: 600;
            background: linear-gradient(135deg, #580100, #8B0000);
            color: white;
            position: relative;
            transition: transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }

        .action-btn.loading {
            pointer-events: none;
            background: linear-gradient(135deg, #8B0000, #580100);
        }

        .action-btn.loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            border: 3px solid #fff;
            border-top: 3px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: translateY(-50%) rotate(0deg); }
            100% { transform: translateY(-50%) rotate(360deg); }
        }

        .error-message {
            color: #ff0000;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            display: none;
            position: relative;
            z-index: 1;
        }

        .error-message.show {
            display: block;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: #fff;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 10px;
            position: relative;
        }

        .modal-content h2 {
            font-size: 20px;
            margin-bottom: 15px;
        }

        .modal-content p {
            font-size: 14px;
            line-height: 1.6;
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 36px; /* Increased from 28px for better visibility */
            font-weight: bold;
            cursor: pointer;
            padding: 10px; /* Added padding for larger touch area */
            line-height: 1; /* Ensure the "X" is centered vertically */
            margin: -10px -10px 0 0; /* Adjust position to account for padding */
        }

        .close-btn:hover,
        .close-btn:focus {
            color: #000;
            text-decoration: none;
        }

        @media (min-width: 769px) {
            .container {
                flex-direction: row;
            }

            .background-image {
                min-height: 100vh;
            }

            .form-container {
                min-height: 100vh;
            }

            .text-typewriter {
                font-size: 2vw;
            }
        }

        @media (max-width: 1024px) {
            .text-typewriter {
                font-size: 2.5vw;
            }

            .website-logo {
                width: 200px;
            }

            .form-container {
                padding: 30px;
            }

            .logoname {
                font-size: 28px;
            }

            h2 {
                font-size: 22px;
            }
        }

        @media (max-width: 768px) {
            .background-image {
                min-height: 40vh;
            }

            .form-container {
                max-width: 100%;
                padding: 20px;
                box-shadow: none;
            }

            .text-typewriter {
                font-size: 1.8rem;
            }

            .website-logo {
                width: 150px;
                top: 10px;
                left: 10px;
            }

            .text-container {
                padding: 10px;
            }
        }

        @media (min-width: 320px) and (max-width: 480px) {
            .background-image {
                min-height: 50vh;
            }

            .text-typewriter {
                font-size: 1.2rem;
            }

            .website-logo {
                width: 120px;
            }

            .logoname {
                font-size: 24px;
            }

            h2 {
                font-size: 20px;
            }

            .action-btn {
                padding: 10px 30px;
                font-size: 14px;
            }

            .form-container {
                padding: 15px;
            }

            .modal-content {
                width: 90%;
                margin: 20% auto;
            }

            .text-container {
                padding: 5px;
            }

            .close-btn {
                font-size: 40px; /* Larger on mobile for better tap target */
                padding: 12px; /* Larger touch area */
                margin: -12px -12px 0 0; /* Adjust position */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="background-image">
            <img src="https://i.imgur.com/st5cY6l.png" alt="Website Logo" class="website-logo">
            <div class="text-container">
                <div class="text-typewriter" id="typewriterText"></div>
            </div>
        </div>
        <div class="form-container">
            <div class="halftone-background"></div>
            <div class="logoname">
                Contra E-Crime
            </div>
            <form id="signupForm">
                <h2>Sign Up</h2>
                <label for="signup-email">Email Address</label>
                <input type="email" id="signup-email" placeholder="Your email address" required>
                
                <label for="signup-username">Username</label>
                <input type="text" id="signup-username" placeholder="Your username" required>
                
                <label for="signup-password">Password</label>
                <div class="input-container">
                    <input type="password" id="signup-password" placeholder="********" required>
                    <i class="fas fa-eye toggle-password" id="toggleSignupPassword"></i>
                </div>
                
                <div class="checkbox-container">
                    <div class="checkbox">
                        <input type="checkbox" id="terms" required>
                        <label for="terms" id="termsLabel">I agree to the Terms & Conditions</label>
                    </div>
                </div>
                
                <div class="login-prompt">
                    Already have an account? <a href="index.html">Log In</a>
                </div>
                
                <div class="buttons-container">
                    <button type="submit" class="action-btn">Create Account</button>
                </div>
                <div class="error-message" id="signupErrorMessage"></div>
            </form>
        </div>
    </div>

    <div id="termsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">×</span>
            <h2>Terms & Conditions</h2>
            <p>
                By using Contra E-Crime, you agree to the following terms and conditions:
                <br><br>
                1. <strong>User Responsibility</strong>: You are responsible for maintaining the confidentiality of your account and password and for restricting access to your computer to prevent unauthorized access to your account.
                <br><br>
                2. <strong>Prohibited Activities</strong>: You agree not to use the service for any unlawful purpose or in any way that interrupts, damages, or impairs the service.
                <br><br>
                3. <strong>Data Privacy</strong>: We collect and store your personal information as outlined in our Privacy Policy. Your data will be used solely for the purpose of providing and improving the service.
                <br><br>
                4. <strong>Limitation of Liability</strong>: Contra E-Crime is not liable for any damages resulting from the use of this service, including but not limited to direct, indirect, incidental, or consequential damages.
                <br><br>
                5. <strong>Termination</strong>: We reserve the right to terminate or suspend your account at our sole discretion, without notice, for conduct that we believe violates these Terms or is harmful to other users.
                <br><br>
                Please read these terms carefully. By checking the box, you agree to be bound by these Terms & Conditions.
            </p>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCDNmxNOV7rr_qfM_mTeYTaUIkkLvRaf80",
            authDomain: "contra-e-crime.firebaseapp.com",
            projectId: "contra-e-crime",
            storageBucket: "contra-e-crime.firebasestorage.app",
            messagingSenderId: "198995444405",
            appId: "1:198995444405:web:5f8c6eed561461b36034fc",
            measurementId: "G-7Y2E24DD42"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function logLoginEvent(userEmail) {
            try {
                const timestamp = firebase.firestore.FieldValue.serverTimestamp();
                await db.collection('loginEvents').add({
                    userEmail: userEmail,
                    timestamp: timestamp
                });
                console.log('Login event logged for:', userEmail);
            } catch (error) {
                console.error('Error logging login event:', error);
                throw error;
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            try {
                const toggleSignupPassword = document.querySelector('#toggleSignupPassword');
                const signupPassword = document.querySelector('#signup-password');

                if (toggleSignupPassword && signupPassword) {
                    toggleSignupPassword.addEventListener('click', function () {
                        const type = signupPassword.getAttribute('type') === 'password' ? 'text' : 'password';
                        signupPassword.setAttribute('type', type);
                        this.classList.toggle('fa-eye-slash');
                    });
                } else {
                    console.error('Toggle password elements not found.');
                }

                const termsModal = document.getElementById('termsModal');
                const termsLabel = document.getElementById('termsLabel');
                const closeBtn = document.querySelector('.close-btn');

                if (termsLabel && termsModal) {
                    termsLabel.addEventListener('click', function () {
                        termsModal.style.display = 'block';
                    });
                } else {
                    console.error('Terms label or modal not found.');
                }

                if (closeBtn && termsModal) {
                    closeBtn.addEventListener('click', function () {
                        termsModal.style.display = 'none';
                    });

                    window.addEventListener('click', function (event) {
                        if (event.target === termsModal) {
                            termsModal.style.display = 'none';
                        }
                    });
                } else {
                    console.error('Close button or modal not found.');
                }

                const signupForm = document.getElementById('signupForm');
                const signupErrorMessage = document.getElementById('signupErrorMessage');

                if (signupForm) {
                    signupForm.addEventListener('submit', async (event) => {
                        event.preventDefault();

                        const submitButton = signupForm.querySelector('.action-btn');
                        submitButton.classList.add('loading');
                        submitButton.disabled = true;

                        try {
                            const email = document.getElementById('signup-email').value.trim();
                            const username = document.getElementById('signup-username').value.trim();
                            const passwordValue = signupPassword.value.trim();

                            if (passwordValue.length < 6) {
                                signupErrorMessage.style.display = 'block';
                                signupErrorMessage.classList.add('show');
                                signupErrorMessage.textContent = 'Password must be at least 6 characters long.';
                                submitButton.classList.remove('loading');
                                submitButton.disabled = false;
                                return;
                            }

                            const userDoc = await db.collection('users').doc(email).get();
                            if (userDoc.exists) {
                                signupErrorMessage.style.display = 'block';
                                signupErrorMessage.classList.add('show');
                                signupErrorMessage.textContent = 'Email already exists. Please use a different email.';
                                submitButton.classList.remove('loading');
                                submitButton.disabled = false;
                                return;
                            }

                            await db.collection('users').doc(email).set({
                                email: email,
                                username: username,
                                password: passwordValue,
                                createdAt: firebase.firestore.FieldValue.serverTimestamp()
                            });

                            let users = JSON.parse(localStorage.getItem('users')) || [];
                            users.push({ email, username, password: passwordValue });
                            localStorage.setItem('users', JSON.stringify(users));

                            await logLoginEvent(email);

                            localStorage.setItem('currentUser', JSON.stringify({ email, username }));
                            localStorage.setItem('rememberMe', 'true');

                            submitButton.classList.remove('loading');
                            submitButton.disabled = false;
                            signupErrorMessage.style.display = 'none';

                            window.location.href = "HomePage.html";
                        } catch (error) {
                            console.error('Sign-up error:', error);
                            signupErrorMessage.style.display = 'block';
                            signupErrorMessage.classList.add('show');
                            signupErrorMessage.textContent = 'An error occurred during sign-up. Please try again.';
                            submitButton.classList.remove('loading');
                            submitButton.disabled = false;
                        }
                    });
                } else {
                    console.error('Signup form not found.');
                }

                const phrases = [
                    "Protect yourself from cybercrime today.",
                    "Contra E-Crime: Your shield online.",
                    "Stay safe, stay informed, stay secure.",
                    "A righteous one deserves a precise outcome.",
                    "Empowering you against digital threats.",
                    "I’m here to help you navigate cybercrime laws.",
                    "Let’s find the legal answers you need, fast.",
                    "Your trusted guide to cybercrime justice.",
                    "Uncover the law, defeat the threat.",
                    "Defending your digital rights, step by step."
                ];
                const typewriterText = document.getElementById('typewriterText');
                let currentPhraseIndex = 0;
                let charIndex = 0;
                let isDeleting = false;

                function typeWriter() {
                    const currentPhrase = phrases[currentPhraseIndex];

                    if (!isDeleting) {
                        if (charIndex < currentPhrase.length) {
                            typewriterText.innerHTML = currentPhrase.substring(0, charIndex + 1);
                            charIndex++;
                            setTimeout(typeWriter, 100);
                        } else {
                            setTimeout(() => {
                                isDeleting = true;
                                typeWriter();
                            }, 2000);
                        }
                    } else {
                        if (charIndex > 0) {
                            typewriterText.innerHTML = currentPhrase.substring(0, charIndex - 1);
                            charIndex--;
                            setTimeout(typeWriter, 50);
                        } else {
                            isDeleting = false;
                            currentPhraseIndex = (currentPhraseIndex + 1) % phrases.length;
                            setTimeout(typeWriter, 500);
                        }
                    }
                }

                if (typewriterText) {
                    typeWriter();
                } else {
                    console.error('Typewriter text element not found.');
                }
            } catch (error) {
                console.error('An error occurred in the script:', error);
            }
        });
    </script>
</body>
</html>